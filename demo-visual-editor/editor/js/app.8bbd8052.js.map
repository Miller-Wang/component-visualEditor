{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/App.vue?ba8d","webpack:///./src/App.vue","webpack:///./src/packages/plugins/event.ts","webpack:///./src/packages/utils/defer.ts","webpack:///./src/packages/utils/dialog-service.tsx","webpack:///./src/packages/utils/useModel.tsx","webpack:///./src/packages/plugins/keyboard-code.ts","webpack:///./src/packages/plugins/command.plugin.ts","webpack:///./src/packages/utils/visual.command.tsx","webpack:///./src/packages/visual-editor.utils.ts","webpack:///./src/packages/components/block-resizer/index.tsx","webpack:///./src/packages/visual-editor.props.tsx","webpack:///./src/packages/visual-editor-block.tsx","webpack:///./src/packages/utils/dropdown-service.tsx","webpack:///./src/packages/components/table-prop-editor/service.tsx","webpack:///./src/packages/components/table-prop-editor/index.tsx","webpack:///./src/packages/visual-editor-operator.tsx","webpack:///./src/packages/visual-editor.tsx","webpack:///./src/packages/components/number-range/index.tsx","webpack:///./src/packages/visual.config.tsx","webpack:///./src/App.vue?1d14","webpack:///./src/App.vue?97f5","webpack:///./src/main.ts"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","class","jsonData","config","visualConfig","formData","customProps","food","JSON","stringify","createEvent","listeners","on","cb","off","index","indexOf","emit","args","forEach","item","DialogServiceEditType","defer","dfd","promise","Promise","resolve","reject","Dialog","keyGenerator","count","ServiceComponent","props","option","type","required","setup","ctx","state","editValue","showFlag","methods","service","show","hide","handler","onConfirm","onCancel","assign","proxy","title","default","editType","textarea","rows","footer","onClick","DialogService","ins","el","document","createElement","body","append","mount","$$dialog","input","initValue","opt","useModel","emitter","val","modelValue","String","emits","model","KeyboardCode","16","17","18","8","9","13","27","32","37","38","39","40","46","189","187","48","49","50","51","52","53","54","55","56","57","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","112","113","114","115","116","117","118","119","120","121","122","123","useCommander","current","queue","commands","destroyList","commandArray","registry","command","execute","undo","redo","followQueue","keyboardEvent","onKeydown","e","activeElement","keyCode","shiftKey","altKey","ctrlKey","metaKey","keyStr","keyNames","join","keyboard","keys","Array","isArray","includes","stopPropagation","preventDefault","init","addEventListener","removeEventListener","queueItem","console","log","useVisualCommand","focusData","updateBlocks","dataModel","dragstart","dragend","commander","before","blocks","after","unfocus","this","drag","focus","maxZIndex","reduce","prev","block","Math","max","zIndex","Infinity","minZIndex","min","abs","newVal","oldVal","delete","clear","placeTop","placeBottom","updateBlock","updateModelValue","createNewBlock","componentKey","component","top","left","adjustPosition","width","height","hasResize","createVisualEditorConfig","componentList","componentMap","comp","Direction","VisualDragProvider","VISUAL_DRAG_PROVIDER","provide","inject","VisualEditorPropsType","BlockResizer","dragStart","dragEnd","resize","startX","startY","startWidth","startHeight","startLeft","startTop","direction","dragging","mousemove","moveX","clientX","moveY","clientY","horizontal","center","vertical","durX","durY","start","mouseup","mousedown","end","VisualEditorBlock","slots","styles","classes","offsetWidth","offsetHeight","render","slotName","size","propName","modelName","custom","DropdownServiceProvider","DROPDOWN_SERVICE_PROVIDER","SerivceComponent","mounted","reference","getBoundingClientRect","style","onMousedownDocument","contains","target","content","DropdownOption","label","icon","click","dropdownClickHandler","$$dropdown","appendChild","app","Table","TableColumn","Button","editorData","add","reset","onDelete","table","options","map","row","field","$index","$$tablePropEditor","ElTag","TablePropEditor","propConfig","showKey","createEditorInputProps","createEditorColorProps","color","createEditorSelectProps","select","createEditorTableProp","VisualOperatorEditor","Function","editData","newBlock","container","immediate","renderEditor","entries","labelPosition","step","VisualEditor","require","containerStyles","containerRef","filter","v","selectIndex","selectBlock","preview","editing","clearFocus","importBlockData","text","parse","Error","alert","showBlockData","openEdit","menuDragger","containerHandler","dragenter","dataTransfer","dropEffect","dragover","dragleave","drop","offsetY","offsetX","blockHandler","blockDragger","mark","x","y","dragState","startPos","markLines","currentLeft","currentTop","currentMark","showTop","showLeft","lines","w","h","onContextmenuBlock","focusHandler","onMousedown","currentTarget","handleImport","handleExport","buttons","tip","excuteFun","fn","btn","onContextmenu","NumberRange","startModel","endModel","ElInput","fontSize","undefined","random","onChange","url","components","username","subBtn","$notify","message","mySelect","App","use"],"mappings":"aACE,SAASA,EAAqBC,GAQ7B,IAPA,IAMIC,EAAUC,EANVC,EAAWH,EAAK,GAChBI,EAAcJ,EAAK,GACnBK,EAAiBL,EAAK,GAIHM,EAAI,EAAGC,EAAW,GACpCD,EAAIH,EAASK,OAAQF,IACzBJ,EAAUC,EAASG,GAChBG,OAAOC,UAAUC,eAAeC,KAAKC,EAAiBX,IAAYW,EAAgBX,IACpFK,EAASO,KAAKD,EAAgBX,GAAS,IAExCW,EAAgBX,GAAW,EAE5B,IAAID,KAAYG,EACZK,OAAOC,UAAUC,eAAeC,KAAKR,EAAaH,KACpDc,EAAQd,GAAYG,EAAYH,IAG/Be,GAAqBA,EAAoBhB,GAE5C,MAAMO,EAASC,OACdD,EAASU,OAATV,GAOD,OAHAW,EAAgBJ,KAAKK,MAAMD,EAAiBb,GAAkB,IAGvDe,IAER,SAASA,IAER,IADA,IAAIC,EACIf,EAAI,EAAGA,EAAIY,EAAgBV,OAAQF,IAAK,CAG/C,IAFA,IAAIgB,EAAiBJ,EAAgBZ,GACjCiB,GAAY,EACRC,EAAI,EAAGA,EAAIF,EAAed,OAAQgB,IAAK,CAC9C,IAAIC,EAAQH,EAAeE,GACG,IAA3BX,EAAgBY,KAAcF,GAAY,GAE3CA,IACFL,EAAgBQ,OAAOpB,IAAK,GAC5Be,EAASM,EAAoBA,EAAoBC,EAAIN,EAAe,KAItE,OAAOD,EAIR,IAAIQ,EAAmB,GAKnBhB,EAAkB,CACrB,IAAO,GAGJK,EAAkB,GAGtB,SAASS,EAAoB1B,GAG5B,GAAG4B,EAAiB5B,GACnB,OAAO4B,EAAiB5B,GAAU6B,QAGnC,IAAIC,EAASF,EAAiB5B,GAAY,CACzCK,EAAGL,EACH+B,GAAG,EACHF,QAAS,IAUV,OANAf,EAAQd,GAAUW,KAAKmB,EAAOD,QAASC,EAAQA,EAAOD,QAASH,GAG/DI,EAAOC,GAAI,EAGJD,EAAOD,QAKfH,EAAoBM,EAAIlB,EAGxBY,EAAoBO,EAAIL,EAGxBF,EAAoBQ,EAAI,SAASL,EAASM,EAAMC,GAC3CV,EAAoBW,EAAER,EAASM,IAClC3B,OAAO8B,eAAeT,EAASM,EAAM,CAAEI,YAAY,EAAMC,IAAKJ,KAKhEV,EAAoBe,EAAI,SAASZ,GACX,qBAAXa,QAA0BA,OAAOC,aAC1CnC,OAAO8B,eAAeT,EAASa,OAAOC,YAAa,CAAEC,MAAO,WAE7DpC,OAAO8B,eAAeT,EAAS,aAAc,CAAEe,OAAO,KAQvDlB,EAAoBmB,EAAI,SAASD,EAAOE,GAEvC,GADU,EAAPA,IAAUF,EAAQlB,EAAoBkB,IAC/B,EAAPE,EAAU,OAAOF,EACpB,GAAW,EAAPE,GAA8B,kBAAVF,GAAsBA,GAASA,EAAMG,WAAY,OAAOH,EAChF,IAAII,EAAKxC,OAAOyC,OAAO,MAGvB,GAFAvB,EAAoBe,EAAEO,GACtBxC,OAAO8B,eAAeU,EAAI,UAAW,CAAET,YAAY,EAAMK,MAAOA,IACtD,EAAPE,GAA4B,iBAATF,EAAmB,IAAI,IAAIM,KAAON,EAAOlB,EAAoBQ,EAAEc,EAAIE,EAAK,SAASA,GAAO,OAAON,EAAMM,IAAQC,KAAK,KAAMD,IAC9I,OAAOF,GAIRtB,EAAoB0B,EAAI,SAAStB,GAChC,IAAIM,EAASN,GAAUA,EAAOiB,WAC7B,WAAwB,OAAOjB,EAAO,YACtC,WAA8B,OAAOA,GAEtC,OADAJ,EAAoBQ,EAAEE,EAAQ,IAAKA,GAC5BA,GAIRV,EAAoBW,EAAI,SAASgB,EAAQC,GAAY,OAAO9C,OAAOC,UAAUC,eAAeC,KAAK0C,EAAQC,IAGzG5B,EAAoB6B,EAAI,2BAExB,IAAIC,EAAaC,OAAO,gBAAkBA,OAAO,iBAAmB,GAChEC,EAAmBF,EAAW3C,KAAKsC,KAAKK,GAC5CA,EAAW3C,KAAOf,EAClB0D,EAAaA,EAAWG,QACxB,IAAI,IAAItD,EAAI,EAAGA,EAAImD,EAAWjD,OAAQF,IAAKP,EAAqB0D,EAAWnD,IAC3E,IAAIU,EAAsB2C,EAI1BzC,EAAgBJ,KAAK,CAAC,EAAE,kBAEjBM,K,sGCvJT,W,6yCCCOyC,MAAM,O,iBASwC,Q,iBAC9B,Q,GAGdA,MAAM,a,+IAbb,eAgBM,MAhBN,EAgBM,CAfJ,eAWgB,G,WAVL,EAAAC,S,qDAAA,EAAAA,SAAQ,IAChBC,OAAQ,EAAAC,aACRC,SAAU,EAAAA,SACVC,YAAa,EAAAA,a,sBAEU,EAAAD,SAASE,K,MAAtB,S,oBAET,iBAA6D,CAA/B,WAAb,EAAAF,SAASE,M,iBAA1B,eAA6D,W,yBAAhB,iBAAI,C,+BACjD,eAA4B,W,yBAAb,iBAAI,C,kFAGvB,eAEM,MAFN,EAEM,eADDC,KAAKC,UAAU,EAAAJ,WAAQ,K,0JCd1B,SAAUK,IACd,IAAMC,EAA8B,GACpC,MAAO,CACLC,GAAI,SAACC,GACHF,EAAUzD,KAAK2D,IAEjBC,IAAK,SAACD,GACJ,IAAME,EAAQJ,EAAUK,QAAQH,GAC5BE,GAAS,GACXJ,EAAUX,MAAMe,EAAO,IAG3BE,KAAM,WAAmB,2BAAfC,EAAe,yBAAfA,EAAe,gBACvBP,EAAUQ,SAAQ,SAACC,GAAD,OAAUA,EAAI,WAAJ,EAAQF,QCDnC,ICDFG,EDCQC,EAAe,WAC1B,IAAMC,EAAM,GAKZ,OAJAA,EAAIC,QAAU,IAAIC,SAAQ,SAACC,EAASC,GAClCJ,EAAIG,QAAUA,EACdH,EAAII,OAASA,KAERJ,G,YCTHK,EAAS,QAEf,SAAKP,GACH,yBACA,oBAFF,CAAKA,MAAqB,KAa1B,IAAMQ,EAAgB,WACpB,IAAIC,EAAQ,EACZ,OAAO,oCAAkBA,MAFL,GAKhBC,EAAmB,eAAgB,CACvCC,MAAO,CACLC,OAAQ,CAAEC,KAAMrF,OAAyCsF,UAAU,IAErEC,MAJuC,SAIjCJ,GACJ,IAAMK,EAAM,iBACNC,EAAQ,eAAS,CACrBL,OAAQD,EAAMC,OACdM,UAAW,KACXC,UAAU,EACVjD,IAAKsC,MAEDY,EAAU,CACdC,QAAS,SAACT,GACRK,EAAML,OAASA,EACfK,EAAMC,UAAYN,EAAOM,UACzBD,EAAM/C,IAAMsC,IACZY,EAAQE,QAEVA,KAAM,kBAAOL,EAAME,UAAW,GAC9BI,KAAM,kBAAON,EAAME,UAAW,IAG1BK,EAAU,CACdC,UAAW,WACTR,EAAML,OAAOa,UAAWR,EAAMC,WAC9BE,EAAQG,QAEVG,SAAU,WACRN,EAAQG,SAOZ,OAFA/F,OAAOmG,OAAOX,EAAIY,MAAOR,GAElB,kBACL,6BACWH,EAAME,SADjB,yCACWF,EAAME,SADjB,SAESF,EAAML,OAAOiB,MAFtB,IAGOZ,EAAM/C,KAHb,CAMI4D,QAAS,kBACP,2BACGb,EAAML,OAAOmB,WAAa/B,EAAsBgC,SAC/C,2CACO,YADP,CAEQC,KAAM,IAFd,YAGWhB,EAAMC,UAHjB,yCAGWD,EAAMC,UAHjB,WAMA,kCAAkBD,EAAMC,UAAxB,yCAAkBD,EAAMC,UAAxB,aAINgB,OAAQ,kBACN,2BACE,uBAAiBC,QAASX,EAAQE,UAAlC,oDAGA,uBAAiBS,QAASX,EAAQC,WAAlC,6DAWRW,EAAiB,WACrB,IAAIC,EACJ,OAAO,SAACzB,GACN,IAAKyB,EAAK,CACR,IAAMC,EAAKC,SAASC,cAAc,OAClCD,SAASE,KAAKC,OAAOJ,GACrBD,EAAM,eAAU3B,EAAkB,CAAEE,WAAU+B,MAAML,GAEtDD,EAAIhB,QAAQT,IARO,GAYVgC,EAAWpH,OAAOmG,OAAOS,EAAe,CACnDS,MAAO,SAACC,EAAoBlC,GAC1B,IAAMV,EAAMD,IACN8C,EAAG,iCACJnC,GADI,IAEPmB,SAAU/B,EAAsB6C,MAChCpB,UAAWvB,EAAIG,QACfa,UAAW4B,IAGb,OADAV,EAAcW,GACP7C,EAAIC,SAEb6B,SAAU,SAACc,EAAoBlC,GAC7B,IAAMV,EAAMD,IACN8C,EAAG,iCACJnC,GADI,IAEPmB,SAAU/B,EAAsBgC,SAChCP,UAAWvB,EAAIG,QACfa,UAAW4B,IAGb,OADAV,EAAcW,GACP7C,EAAIC,WCpIT,SAAU6C,EAAY5F,EAAiB6F,GAC3C,IAAMhC,EAAQ,eAAI7D,KAQlB,OANA,eAAMA,GAAQ,SAAC8F,GACTA,IAAQjC,EAAMrD,QAChBqD,EAAMrD,MAAQsF,MAIX,CACL,YACE,OAAOjC,EAAMrD,OAEf,UAAUsF,GACJjC,EAAMrD,QAAUsF,IAClBjC,EAAMrD,MAAQsF,EACdD,EAAQC,MAOY,eAAgB,CAC1CvC,MAAO,CACLwC,WAAY,CAAEtC,KAAMuC,SAEtBC,MAAO,CACL,oBAAqB,SAACH,GAAD,OAAkB,IAEzCnC,MAP0C,SAOpCJ,EAAOK,GACX,IAAMsC,EAAQN,GACZ,kBAAMrC,EAAMwC,cACZ,SAACD,GAAD,OAASlC,EAAIpB,KAAK,oBAAqBsD,MAEzC,OAAO,kBACL,oDAEE,6CAAY,OAAZ,yCAA4BI,EAAM1F,MAAlC,mBAA4B0F,EAAM1F,e,6DAfnC,IC1BM2F,EAAe,CACxBC,GAAI,QACJC,GAAI,OACJC,GAAI,MAEJC,EAAG,YACHC,EAAG,MACHC,GAAI,QACJC,GAAI,MACJC,GAAI,QAEJC,GAAI,OACJC,GAAI,KACJC,GAAI,QACJC,GAAI,OACJC,GAAI,SACJC,IAAK,IACLC,IAAK,IAELC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IAEJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IAEJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IAEJC,IAAK,KACLC,IAAK,KACLC,IAAK,KACLC,IAAK,KACLC,IAAK,KACLC,IAAK,KACLC,IAAK,KACLC,IAAK,KACLC,IAAK,KACLC,IAAK,MACLC,IAAK,MACLC,IAAK,OChDH,SAAUC,IACd,IAAMtG,EAAQ,eAAS,CACrBuG,SAAU,EACVC,MAAO,GACPC,SAAU,GACVC,YAAa,GACbC,aAAc,KAEVC,EAAW,SAACC,GAWhB7G,EAAM2G,aAAa/L,KAAKiM,GACxB7G,EAAMyG,SAASI,EAAQ3K,MAAQ,WAAY,MAClB2K,EAAQC,QAAR,MAAAD,EAAO,WAAtBE,EADiC,EACjCA,KAAMC,EAD2B,EAC3BA,KAGd,GAFAA,KAE4B,IAAxBH,EAAQI,YAAZ,CAJyC,IAQnCT,EAAUxG,EAAVwG,MACED,EAAYvG,EAAZuG,QACJC,EAAMlM,OAAS,IACjBkM,EAAQA,EAAM9I,MAAM,EAAG6I,EAAU,GACjCvG,EAAMwG,MAAQA,GAGhBA,EAAM5L,KAAK,CAAEmM,OAAMC,SAEnBhH,EAAMuG,QAAUA,EAAU,KAIxBW,EAAiB,WACrB,IAAMC,EAAY,SAACC,GACjB,GAAI9F,SAAS+F,gBAAkB/F,SAASE,KAAxC,CADqC,IAI7B8F,EAAgDF,EAAhDE,QAASC,EAAuCH,EAAvCG,SAAUC,EAA6BJ,EAA7BI,OAAQC,EAAqBL,EAArBK,QAASC,EAAYN,EAAZM,QACtCC,EAAmB,IACrBF,GAAWC,IACbC,EAAO/M,KAAK,QAEV2M,GAAUI,EAAO/M,KAAK,SACtB4M,GAAQG,EAAO/M,KAAK,OACxB+M,EAAO/M,KAAK0H,EAAagF,IACzB,IAAMM,EAAWD,EAAOE,KAAK,KAC7B7H,EAAM2G,aAAa9H,SAAQ,YAAuB,IAApBiJ,EAAoB,EAApBA,SAAU5L,EAAU,EAAVA,KACtC,GAAK4L,EAAL,CACA,IAAMC,EAAQC,MAAMC,QAAQH,GAAyBA,EAAb,CAACA,GACrCC,EAAKG,SAASN,KAEhB5H,EAAMyG,SAASvK,KACfkL,EAAEe,kBACFf,EAAEgB,wBAKFC,EAAO,WAEX,OADA7K,OAAO8K,iBAAiB,UAAWnB,GAC5B,WACL3J,OAAO+K,oBAAoB,UAAWpB,KAG1C,OAAOkB,EAhCc,GAmCjBA,EAAO,WAKXrI,EAAM2G,aAAa9H,SACjB,SAACgI,GAAD,QAAeA,EAAQwB,MAAQrI,EAAM0G,YAAY9L,KAAKiM,EAAQwB,WAEhErI,EAAM0G,YAAY9L,KAAKsM,MAkDzB,OA5CAN,EAAS,CACP1K,KAAM,OACN4L,SAAU,SACVb,aAAa,EACbH,QAAS,WAEP,MAAO,CACLE,KAAM,WAAK,IAEDT,EAAYvG,EAAZuG,QACR,IAAiB,IAAbA,EAAJ,CACA,IAAMiC,EAAYxI,EAAMwG,MAAMD,GAC1BiC,IACFA,EAAUzB,MAAQyB,EAAUzB,OAC5B/G,EAAMuG,aAGVQ,KAAM,iBAOZH,EAAS,CACP1K,KAAM,OACN4L,SAAU,CAAC,SAAU,gBACrBb,aAAa,EACbH,QAAS,WACP,MAAO,CACLE,KAAM,WACJ,IAAMwB,EAAYxI,EAAMwG,MAAMxG,EAAMuG,QAAU,GAC1CiC,IACFA,EAAUxB,OACVhH,EAAMuG,YAGVQ,KAAM,WACJ0B,QAAQC,IAAI,aAMb,CACL1I,QACA4G,WACAyB,Q,yBCvJE,SAAUM,EAAV,GAcL,IAbCC,EAaD,EAbCA,UACAC,EAYD,EAZCA,aACAC,EAWD,EAXCA,UACAC,EAUD,EAVCA,UACAC,EASD,EATCA,QAUMC,EAAY3C,IA0OlB,OAvOA2C,EAAUrC,SAAS,CACjB1K,KAAM,SACN4L,SAAU,CAAC,YAAa,SAAU,UAClChB,QAAS,WAAK,MACZ2B,QAAQC,IAAI,UACZ,IAAM5O,EAAO,CACXoP,QAAQ,UAAAJ,EAAUnM,aAAV,eAAiBwM,SAAU,GACnCC,MAAOR,EAAUjM,MAAM0M,SAEzB,MAAO,CACLrC,KAAM,WACJyB,QAAQC,IAAI,UACZG,EAAa/O,EAAKsP,QAEpBrC,KAAM,WACJ0B,QAAQC,IAAI,UACZG,EAAa/O,EAAKoP,aAM1BD,EAAUrC,SAAS,CACjB1K,KAAM,eACN4K,QAAS,SAACqC,GAAmC,MAC3CV,QAAQC,IAAI,UACZ,IAAM5O,EAAO,CACXoP,QAAQ,UAAAJ,EAAUnM,aAAV,eAAiBwM,SAAU,GACnCC,MAAOR,EAAUjM,MAAM0M,SAEzB,MAAO,CACLrC,KAAM,WACJyB,QAAQC,IAAI,UACZG,EAAa/O,EAAKsP,QAEpBrC,KAAM,WACJ0B,QAAQC,IAAI,UACZG,EAAa/O,EAAKoP,aAY1BD,EAAUrC,SAAS,CACjB1K,KAAM,OACNmM,KAFiB,WAEb,WACFiB,KAAKxP,KAAO,CACVoP,OAAQ,MAEV,IAAM3I,EAAU,CACdwI,UAAW,WAAK,MACd,EAAKjP,KAAKoP,OAAS,KAAS,UAAAJ,EAAUnM,aAAV,eAAiBwM,SAAU,KAEzDH,QAAS,WACPC,EAAUjJ,MAAMyG,SAAS8C,SAM7B,OAHAR,EAAUzK,GAAGiC,EAAQwI,WACrBC,EAAQ1K,GAAGiC,EAAQyI,SAEZ,WACLD,EAAUvK,IAAI+B,EAAQwI,WACtBC,EAAQxK,IAAI+B,EAAQyI,WAGxBlC,QAtBiB,WAsBV,MACCoC,EAAS,IAASI,KAAKxP,KAAKoP,QAC5BE,EAAQ,KAAS,UAAAN,EAAUnM,aAAV,eAAiBwM,SAAU,IAClD,MAAO,CACLnC,KAAM,WACJ6B,EAAa,IAASO,KAExBrC,KAAM,WACJ8B,EAAa,IAASK,SAM9BD,EAAUrC,SAAS,CACjB1K,KAAM,QACN4K,QAAS,WAAK,MACNhN,EAAO,CACXoP,OAAQ,IAAQ,UAACJ,EAAUnM,aAAX,aAAC,EAAiBwM,QAClCC,MAAO,IAAS,KAElB,MAAO,CACLpC,KAAM,WACJ6B,EAAa,IAAS/O,EAAKsP,SAE7BrC,KAAM,WACJ8B,EAAa,IAAS/O,EAAKoP,QAAU,UAM7CD,EAAUrC,SAAS,CACjB1K,KAAM,WACN4L,SAAU,UACVhB,QAAS,WAAK,MACNhN,EAAO,CACXoP,OAAQ,IAAQ,UAACJ,EAAUnM,aAAX,aAAC,EAAiBwM,QAClCC,MAAO,IACJ,WAAK,QACuBR,EAAUjM,MAA7B6M,EADJ,EACIA,MAAOH,EADX,EACWA,QACTI,EAAYJ,EAAQK,QAAO,SAACC,EAAMC,GACtC,OAAOC,KAAKC,IAAIH,EAAMC,EAAMG,WAC1BC,KAEJ,OADAR,EAAM3K,SAAQ,SAAC+K,GAAD,OAAYA,EAAMG,OAASN,EAAY,KAC9C,IAAQ,UAACX,EAAUnM,aAAX,aAAC,EAAiBwM,QANlC,KAUL,MAAO,CACLnC,KAAM,WACJ6B,EAAa,IAAS/O,EAAKsP,OAAS,MAEtCrC,KAAM,WACJ8B,EAAa,IAAS/O,EAAKoP,QAAU,UAM7CD,EAAUrC,SAAS,CACjB1K,KAAM,cACN4L,SAAU,YACVhB,QAAS,WAAK,MACNhN,EAAO,CACXoP,OAAQ,IAAQ,UAACJ,EAAUnM,aAAX,aAAC,EAAiBwM,QAClCC,MAAO,IACJ,WAAK,QACuBR,EAAUjM,MAA7B6M,EADJ,EACIA,MAAOH,EADX,EACWA,QACXY,EAAYZ,EAAQK,QAAO,SAACC,EAAMC,GACpC,OAAOC,KAAKK,IAAIP,EAAMC,EAAMG,UAC3BC,KAUH,OARIC,GAAa,IACfZ,EAAQxK,SACN,SAAC+K,GAAD,OACGA,EAAMG,OAAS,EAAIH,EAAMG,OAASF,KAAKM,IAAIF,MAEhDA,EAAY,GAEdT,EAAM3K,SAAQ,SAAC+K,GAAD,OAAYA,EAAMG,OAASE,EAAY,KAC9C,IAAQ,UAACnB,EAAUnM,aAAX,aAAC,EAAiBwM,QAdlC,KAkBL,MAAO,CACLnC,KAAM,WACJ6B,EAAa,IAAS/O,EAAKsP,OAAS,MAEtCrC,KAAM,WACJ8B,EAAa,IAAS/O,EAAKoP,QAAU,UAM7CD,EAAUrC,SAAS,CACjB1K,KAAM,cACN4K,QAAS,SAACsD,EAA+BC,GAAiC,QACpElB,EAAS,KAAS,UAAAL,EAAUnM,aAAV,eAAiBwM,SAAU,IAC7CrP,EAAO,CACToP,OAAQ,IAAQ,UAACJ,EAAUnM,aAAX,aAAC,EAAiBwM,QAClCC,MAAQ,WACND,EAAS,eAAIA,GACb,IAAM1K,EAAQqK,EAAUnM,MAAOwM,OAAOzK,QAAQ2L,GAI9C,OAHI5L,GAAS,GACX0K,EAAO3N,OAAOiD,EAAO,EAAG2L,GAEnB,IAASjB,GANV,IASV,MAAO,CACLnC,KAAM,WACJ6B,EAAa,IAAS/O,EAAKsP,OAAS,MAEtCrC,KAAM,WACJ8B,EAAa,IAAS/O,EAAKoP,QAAU,UAM7CD,EAAUrC,SAAS,CACjB1K,KAAM,mBACN4K,QAAS,SAAC7E,GACR,IAAMnI,EAAO,CACXoP,OAAQ,IAASJ,EAAUnM,OAC3ByM,MAAO,IAASnH,IAElB,MAAO,CACL+E,KAAM,WACJ8B,EAAUnM,MAAQ7C,EAAKsP,OAEzBrC,KAAM,WACJ+B,EAAUnM,MAAQ7C,EAAKoP,YAM/BD,EAAUrC,SAAS,CACjB1K,KAAM,YACN+K,aAAa,EACba,SAAU,SACVhB,QAAS,WACP,MAAO,CACLE,KAAM,WAAK,QACR,UAAA8B,EAAUnM,aAAV,eAAiBwM,SAAU,IAAItK,SAC9B,SAAC+K,GAAD,OAAYA,EAAMJ,OAAQ,MAG9BzC,KAAM,WACJ0B,QAAQC,IAAI,SAMpBO,EAAUZ,OAEH,CACLtB,KAAM,kBAAMkC,EAAUjJ,MAAMyG,SAASM,QACrCC,KAAM,kBAAMiC,EAAUjJ,MAAMyG,SAASO,QACrCsD,OAAQ,kBAAMrB,EAAUjJ,MAAMyG,SAAS6D,UACvCC,MAAO,kBAAMtB,EAAUjJ,MAAMyG,SAAS8D,SACtCC,SAAU,kBAAMvB,EAAUjJ,MAAMyG,SAAS+D,YACzCC,YAAa,kBAAMxB,EAAUjJ,MAAMyG,SAASgE,eAC5CC,YAAa,SACXN,EACAC,GAFW,OAGRpB,EAAUjJ,MAAMyG,SAASiE,YAAYN,EAAQC,IAClDM,iBAAkB,SAAC1I,GAAD,OAChBgH,EAAUjJ,MAAMyG,SAASkE,iBAAiB1I,K,0BCpO1C,SAAU2I,EAAe9Q,GAK7B,MAAO,CACL+Q,aAAc/Q,EAAKgR,UAAW7N,IAC9B8N,IAAKjR,EAAKiR,IACVC,KAAMlR,EAAKkR,KACXC,gBAAgB,EAChBzB,OAAO,EACPO,OAAQ,EACRmB,MAAO,EACPC,OAAQ,EACRC,WAAW,EACX1L,MAAO,GACP2C,MAAO,IAIL,SAAUgJ,IACd,IAAMC,EAAyC,GACzCC,EAAsD,GAE5D,MAAO,CACLD,gBACAC,eACA3E,SAAU,SAIR3J,EACA6N,GAcA,IAAMU,EAAO,iCAAKV,GAAR,IAAmB7N,QAC7BqO,EAAc1Q,KAAK4Q,GACnBD,EAAatO,GAAOuO,IA0BnB,ICzGFC,EDyGQC,EAAsB,WACjC,IAAMC,EAAuB,yBAC7B,MAAO,CACLC,QAAS,SAAC9R,GACR,eAAQ6R,EAAsB7R,IAEhC+R,OAAQ,WACN,OAAO,eAAOF,KAPe,G,WCzGnC,SAAKF,GACH,mBACA,qBACA,gBAHF,CAAKA,MAAS,KAMP,ICfKK,EDeCC,EAAe,eAAgB,CAC1CrM,MAAO,CACLkK,MAAO,CAAEhK,KAAMrF,OAA2CsF,UAAU,GACpEiL,UAAW,CACTlL,KAAMrF,OACNsF,UAAU,IAGduC,MAAO,CACL4J,UAAW,kBAAM,GACjBC,QAAS,kBAAM,IAEjBnM,MAZ0C,SAYpCJ,GAAK,MACiBA,EAAMoL,UAAUoB,QAAU,GAA5ChB,EADC,EACDA,MAAOC,EADN,EACMA,OADN,EAEsBO,EAAmBG,SAA1C9C,EAFC,EAEDA,UAAWC,EAFV,EAEUA,QAEb,EAAe,WACnB,IAAIlP,EAAO,CACTqS,OAAQ,EACRC,OAAQ,EACRC,WAAY,EACZC,YAAa,EACbC,UAAW,EACXC,SAAU,EACVC,UAAW,GACXC,UAAU,GAGNC,EAAY,SAACvF,GAAiB,MAU9BtN,EARFqS,EAFgC,EAEhCA,OACAC,EAHgC,EAGhCA,OACAC,EAJgC,EAIhCA,WACAC,EALgC,EAKhCA,YACAG,EANgC,EAMhCA,UACAF,EAPgC,EAOhCA,UACAC,EARgC,EAQhCA,SACAE,EATgC,EAShCA,SAEGA,IACH5S,EAAK4S,UAAW,EAChB3D,EAAUpK,QAbsB,IAgBnBiO,EAA0BxF,EAAnCyF,QAAyBC,EAAU1F,EAAnB2F,QAClBN,EAAUO,aAAevB,EAAUwB,SACrCL,EAAQT,GAENM,EAAUS,WAAazB,EAAUwB,SACnCH,EAAQV,GAGV,IAAIe,EAAOP,EAAQT,EACfiB,EAAON,EAAQV,EACbxC,EAAQlK,EAAMkK,MAEhB6C,EAAUS,WAAazB,EAAU4B,QACnCD,GAAQA,EACRxD,EAAMmB,IAAMyB,EAAWY,GAErBX,EAAUO,aAAevB,EAAU4B,QACrCF,GAAQA,EACRvD,EAAMoB,KAAOuB,EAAYY,GAG3B,IAAMjC,EAAQmB,EAAac,EACrBhC,EAASmB,EAAcc,EAE7BxD,EAAMsB,MAAQA,EACdtB,EAAMuB,OAASA,EACfvB,EAAMwB,WAAY,GAGdkC,EAAU,SAAVA,EAAWlG,GACfqB,QAAQC,IAAItB,GACZ9F,SAASE,KAAK+G,oBAAoB,YAAaoE,GAC/CrL,SAASE,KAAK+G,oBAAoB,UAAW+E,GACzCxT,EAAK4S,UACP1D,EAAQrK,QAIN4O,EAAY,SAChBnG,EACAqF,GAEArF,EAAEe,kBACF7G,SAASE,KAAK8G,iBAAiB,YAAaqE,GAC5CrL,SAASE,KAAK8G,iBAAiB,UAAWgF,GAC1CxT,EAAO,CACLqS,OAAQ/E,EAAEyF,QACVT,OAAQhF,EAAE2F,QACVN,YACAJ,WAAY3M,EAAMkK,MAAMsB,MACxBoB,YAAa5M,EAAMkK,MAAMuB,OACzBoB,UAAW7M,EAAMkK,MAAMoB,KACvBwB,SAAU9M,EAAMkK,MAAMmB,IACtB2B,UAAU,IAId,OAAOa,EArFY,GAwFrB,OAAO,kBACL,4BACGpC,GACC,4BACE,4BACQ,gCADR,YAEe,SAAC/D,GAAD,OACX,EAAYA,EAAG,CACb4F,WAAYvB,EAAUwB,OACtBC,SAAUzB,EAAU4B,UAL1B,MASA,4BACQ,mCADR,YAEe,SAACjG,GAAD,OACX,EAAYA,EAAG,CACb4F,WAAYvB,EAAUwB,OACtBC,SAAUzB,EAAU+B,QAL1B,QAYHtC,GACC,4BACE,4BACQ,iCADR,YAEe,SAAC9D,GAAD,OACX,EAAYA,EAAG,CACb4F,WAAYvB,EAAU4B,MACtBH,SAAUzB,EAAUwB,WAL1B,MASA,4BACQ,kCADR,YAEe,SAAC7F,GAAD,OACX,EAAYA,EAAG,CACb4F,WAAYvB,EAAU+B,IACtBN,SAAUzB,EAAUwB,WAL1B,QAYH/B,GAASC,GACR,4BACE,4BACQ,qCADR,YAEe,SAAC/D,GAAD,OACX,EAAYA,EAAG,CACb4F,WAAYvB,EAAU4B,MACtBH,SAAUzB,EAAU4B,UAL1B,MASA,4BACQ,sCADR,YAEe,SAACjG,GAAD,OACX,EAAYA,EAAG,CACb4F,WAAYvB,EAAU+B,IACtBN,SAAUzB,EAAU4B,UAL1B,MAUA,4BACQ,wCADR,YAEe,SAACjG,GAAD,OACX,EAAYA,EAAG,CACb4F,WAAYvB,EAAU4B,MACtBH,SAAUzB,EAAU+B,QAL1B,MASA,4BACQ,yCADR,YAEe,SAACpG,GAAD,OACX,EAAYA,EAAG,CACb4F,WAAYvB,EAAU+B,IACtBN,SAAUzB,EAAU+B,QAL1B,cE9LCC,EAAoB,eAAgB,CAC/C/N,MAAO,CACLkK,MAAO,CACLhK,KAAMrF,QAERsD,OAAQ,CACN+B,KAAMrF,QAERwD,SAAU,CAAE6B,KAAMrF,OAAyCsF,UAAU,GACrE6N,MAAO,CACL9N,KAAMrF,OACNsF,UAAU,GAEZ7B,YAAa,CAAE4B,KAAMrF,SAEvBuF,MAf+C,SAezCJ,GACJ,IAAM2B,EAAK,eAAI,IACTsM,EAAS,gBAAS,2BAAO,CAC7B5C,IAAK,GAAF,iBAAKrL,EAAMkK,aAAX,aAAK,EAAamB,IAAlB,MACHC,KAAM,GAAF,iBAAKtL,EAAMkK,aAAX,aAAK,EAAaoB,KAAlB,MACJjB,OAAM,UAAErK,EAAMkK,aAAR,aAAE,EAAaG,WAGjB6D,EAAU,gBAAS,uBAAM,CAC7B,sBACA,CACE,sCAA6BlO,EAAMkK,aAAnC,aAA6B,EAAaJ,WAiB9C,OAbA,gBAAU,WAER,IAAMI,EAAQlK,EAAMkK,MACpB,UAAIA,QAAJ,IAAIA,KAAOqB,eAAgB,OACa5J,EAAG1E,MAAjCkR,EADiB,EACjBA,YAAaC,EADI,EACJA,aACrBlE,EAAMoB,MAAQ6C,EAAc,EAC5BjE,EAAMmB,KAAO+C,EAAe,EAC5BlE,EAAMuB,OAAS2C,EACflE,EAAMsB,MAAQ2C,EACdjE,EAAMqB,gBAAiB,MAIpB,WAAK,UAGN8C,EAIG,QANDjD,EAAS,UAAGpL,EAAM7B,cAAT,aAAG,EAAc0N,aAAa7L,EAAMkK,MAAOiB,cACpD9M,EAAW2B,EAAM3B,SAGnB,UAAA2B,EAAMkK,aAAN,SAAaoE,UAAYtO,EAAMgO,MAAMhO,EAAMkK,MAAMoE,UACnDD,EAASrO,EAAMgO,MAAMhO,EAAMkK,MAAMoE,YAEjCD,EAAM,OAAGjD,QAAH,IAAGA,OAAH,EAAGA,EAAWiD,OAAO,CACzBE,KAAM,UAAAvO,EAAMkK,aAAN,SAAawB,UACf,CACEF,MAAOxL,EAAMkK,MAAMsB,MACnBC,OAAQzL,EAAMkK,MAAMuB,QAEtB,GACJzL,OAAO,UAAAA,EAAMkK,aAAN,eAAalK,QAAS,GAE7B2C,MAAO9H,OAAOwN,KAAK+C,EAAUzI,OAAS,IAAIqH,QAAO,SAACC,EAAMuE,GAAY,UAC5DC,EAAY,UAACzO,EAAMkK,aAAP,OAAC,EAAavH,MAAd,UAEd3C,EAAMkK,aAFQ,aAEd,EAAavH,MAAM6L,GADnB,KASJ,OAPAvE,EAAKuE,IAAL,sBACgB,YAAbA,EAAyB,aAAeA,EAAWxO,EACjD3B,SAASoQ,IAFd,iBAGgB,YAAbD,EAAyB,sBAAwB,YAAa,SAC7DjM,GAD6D,OAEzDlE,EAASoQ,GAAalM,KAL9B,GAOO0H,IACN,IACHyE,OACE,UAAC1O,EAAMkK,aAAP,OAAC,EAAaoE,UAAatO,EAAM1B,aAE7B0B,EAAM1B,YAAN,UAAkB0B,EAAMkK,aAAxB,aAAkB,EAAaoE,WAD/B,KAhCA,OAqCyB,OAATlD,QAAS,IAATA,OAAA,EAAAA,EAAWoB,SAAU,GAAvChB,EArCE,EAqCFA,MAAOC,EArCL,EAqCKA,OACf,OACE,4BAAYyC,EAAQjR,MAApB,MAAkCgR,EAAOhR,MAAzC,IAAqD0E,GAArD,CACG0M,GACA,UAAArO,EAAMkK,aAAN,eAAaJ,SAAU0B,GAASC,IAC/B,wBACSzL,EAAMkK,MADf,UAEakB,GAFb,YCvENuD,G,oBAA2B,WAC/B,IAAMC,EAA4B,8BAClC,MAAO,CACL1C,QAAS,SAACrL,GACR,eAAQ+N,EAA2B/N,IAErCsL,OAAQ,WACN,OAAO,eAAOyC,KAPa,IAY3BC,EAAmB,eAAgB,CACvC7O,MAAO,CAAEC,OAAQ,CAAEC,KAAMrF,SAEzBuF,MAHuC,SAGjCJ,GACJ,IAAMK,EAAM,iBACNsB,EAAK,eAAI,IAETrB,EAAQ,eAAS,CACrBL,OAAQD,EAAMC,OACdO,UAAU,EACV6K,IAAK,EACLC,KAAM,EACNwD,QAAU,WACR,IAAMvP,EAAMD,IAEZ,OADA,eAAUC,EAAIG,SACPH,EAAIC,QAHH,KAONiB,EAAU,CACdE,KAAM,WAAF,8CAAE,8GACEL,EAAMwO,QADR,OAEJxO,EAAME,UAAW,EAFb,2CAAF,qDAAE,GAINI,KAAM,WAAF,8CAAE,8FACJN,EAAME,UAAW,EADb,2CAAF,qDAAE,IAKFE,EAAU,SAACT,GAGf,GAFAK,EAAML,OAASA,EACfK,EAAME,UAAW,EACb,qBAAsBP,EAAO8O,UAAW,CAC1ChG,QAAQC,IAAI/I,EAAO8O,WADuB,MAEZ9O,EAAO8O,UAAUC,wBAAvC3D,EAFkC,EAElCA,IAAKC,EAF6B,EAE7BA,KAAMG,EAFuB,EAEvBA,OACnBnL,EAAM+K,IAAMA,EAAMI,EAClBnL,EAAMgL,KAAOA,MACR,OACwBrL,EAAO8O,UAA5B5B,EADH,EACGA,QAASE,EADZ,EACYA,QACjB/M,EAAMgL,KAAO6B,EACb7M,EAAM+K,IAAMgC,EAEd5M,EAAQE,QAGJuN,EAAU,gBAAS,iBAAM,CAC7B,mBACA,CACE,wBAAyB5N,EAAME,cAG7ByO,EAAQ,gBAAS,iBAAO,CAC5B5D,IAAK,GAAF,OAAK/K,EAAM+K,IAAX,MACHC,KAAM,GAAF,OAAKhL,EAAMgL,KAAX,UAGNzQ,OAAOmG,OAAOX,EAAIY,MAAO,CAAEP,YAE3B,IAAMwO,EAAsB,SAACxH,GACtB/F,EAAG1E,MAAMkS,SAASzH,EAAE0H,SACvB3O,EAAQG,QAaZ,OAVA,gBAAU,kBACRgB,SAASE,KAAK8G,iBAAiB,YAAasG,GAAqB,MAGnE,gBAAgB,kBACdtN,SAASE,KAAK+G,oBAAoB,YAAaqG,GAAqB,MAGtEP,EAAwBzC,QAAQ,CAAE1K,QAASf,EAAQG,OAE5C,wBACL,4BAAYsN,EAAQjR,MAApB,MAAkCgS,EAAMhS,MAAxC,IAAoD0E,GAApD,WACGrB,EAAML,cADT,aACG,EAAcoP,gBAMVC,EAAiB,eAAgB,CAC5CtP,MAAO,CACLuP,MAAO,CAAErP,KAAMuC,QACf+M,KAAM,CAAEtP,KAAMuC,SAEhBC,MAAO,CACL+M,MAAO,SAAC/H,GAAD,OAAmB,IAE5BtH,MAR4C,SAQtCJ,EAAOK,GAAG,MAC4BsO,EAAwBxC,SAAjDuD,EADH,EACNlO,QACFX,EAAU,CACdW,QAAS,SAACkG,GACRrH,EAAIpB,KAAK,QAASyI,GAClBgI,MAGJ,OAAO,kBACL,4BAAW,kBAAX,QAAsC7O,EAAQW,SAA9C,CACE,6CAAsBxB,EAAMwP,OAA5B,MACA,4BAAOxP,EAAMuP,cAMRI,EAAc,WACzB,IAAIjO,EACJ,OAAO,SAACzB,GACN,IAAKyB,EAAK,CACR,IAAMC,EAAKC,SAASC,cAAc,OAClCD,SAASE,KAAK8N,YAAYjO,GAC1B,IAAMkO,EAAM,eAAUhB,EAAkB,CAAE5O,WAC1CyB,EAAMmO,EAAI7N,MAAML,GAElBD,EAAIhB,QAAQT,IATW,G,wBCxHpB,G,UACL,QADa6P,EAEb,OAFoBC,EAGpB,OAHiCC,EAIjC,OASI,EAAmB,eAAgB,CACvChQ,MAAO,CACLC,OAAQ,CACNC,KAAMrF,OACNsF,UAAU,IAIdC,MARuC,SAQjCJ,GACJ,IAAMK,EAAM,iBACNC,EAAQ,eAAS,CACrBL,OAAQD,EAAMC,OACdO,UAAU,EACVsO,QAAU,WACR,IAAMvP,EAAMD,IAEZ,OADA,eAAUC,EAAIG,SACPH,EAAIC,QAHH,GAKVyQ,WAAY,KAGRxP,EAAU,CACdC,QAAS,SAACT,GACRK,EAAML,OAASA,EACfK,EAAM2P,WAAa,IAAShQ,EAAO7F,MAAQ,IAC3CqG,EAAQE,QAEVA,KAAM,WAAF,8CAAE,8GACEL,EAAMwO,QADR,OAEJxO,EAAME,UAAW,EAFb,2CAAF,qDAAE,GAINI,KAAM,WAAF,8CAAE,8FACJN,EAAME,UAAW,EADb,2CAAF,qDAAE,GAGN0P,IAAK,WACH5P,EAAM2P,WAAW/U,KAAK,KAExBiV,MAAO,WACL7P,EAAM2P,WAAa,IAAS3P,EAAML,OAAO7F,QAIvCyG,EAAU,CACdC,UAAW,WACTR,EAAML,OAAOa,UAAUR,EAAM2P,YAC7BxP,EAAQG,QAEVG,SAAU,WACRN,EAAQG,QAEVwP,SAAU,SAACrR,GACTuB,EAAM2P,WAAWnU,OAAOiD,EAAO,KAMnC,OAFAlE,OAAOmG,OAAOX,EAAIY,MAAQR,GAEnB,kBACL,6BAAiBH,EAAME,SAAvB,yCAAiBF,EAAME,SAAvB,KAEIW,QAAS,wBACP,2BACE,2BACE,0BAAiBV,EAAQyP,KAAzB,oDACA,0BAAiBzP,EAAQ0P,OAAzB,sDAEF,uBAAa7P,EAAM2P,YAAnB,2BACE,uBAAkB,SAAlB,MADF,UAEG3P,EAAML,OAAO9B,OAAOkS,aAFvB,aAEG,EAA2BC,QAAQC,KAAI,SAACnR,EAAML,GAAP,OACtC,wBAAoBK,EAAKmQ,OAAzB,CAEIpO,QAAS,gBAAGqP,EAAH,EAAGA,IAAH,OACP,kCAAkBA,EAAIpR,EAAKqR,OAA3B,yCAAkBD,EAAIpR,EAAKqR,OAA3B,gBAKR,wBAAmB,OAAnB,CAEItP,QAAS,gBAAGuP,EAAH,EAAGA,OAAH,OACP,uBACO,SADP,QAEW,kBAAM7P,EAAQuP,SAASM,KAFlC,8DAYZnP,OAAQ,kBACN,4BACE,0BAAiBV,EAAQE,UAAzB,qDACA,0BAAiBF,EAAQC,UAAzB,KAAyC,WAAzC,6DAWD6P,EAAqB,WAChC,IAAIjP,EACJ,OAAO,SAACzB,GACN,IAAKyB,EAAK,CACR,IAAMC,EAAKC,SAASC,cAAc,OAClCD,SAASE,KAAK8N,YAAYjO,GAC1B,IAAMkO,EAAM,eAAU,EAAkB,CAAE5P,WAC1CyB,EAAMmO,EAAI7N,MAAML,GAElB,IAAMpC,EAAMD,IAMZ,OALAoC,EAAIhB,QAAJ,iCACKT,GADL,IAEEa,UAAWvB,EAAIG,WAGVH,EAAIC,SAfmB,GCnI3B,EAAyB,OAAjBoR,EAA2B,OAE7BC,EAAkB,eAAgB,CAC7C7Q,MAAO,CACLwC,WAAY,CAAEtC,KAAMoI,OACpBwI,WAAY,CAAE5Q,KAAMrF,OAAuCsF,UAAU,IAEvEuC,MAAO,CACL,oBAAqB,SAACH,GAAD,OAAiB,IAExCnC,MAR6C,SAQvCJ,EAAOK,GACX,IAAMsC,EAAQN,GACZ,kBAAMrC,EAAMwC,cACZ,SAACD,GAAD,OAASlC,EAAIpB,KAAK,oBAAqBsD,MAGnCf,EAAO,yDAAG,oHACKmP,EAAkB,CACnCxS,OAAQ6B,EAAM8Q,WACd1W,KAAM4F,EAAMwC,YAAc,KAHd,OACRpI,EADQ,OAKd2O,QAAQC,IAAI5O,GACZuI,EAAM1F,MAAQ7C,EANA,2CAAH,qDAUb,OAAO,kBACL,6BACKuI,EAAM1F,OAAgC,IAAvB0F,EAAM1F,MAAMrC,SAC5B,0BAAiB4G,EAAjB,KAA+B,WAA/B,qDAIAmB,EAAM1F,OAAS,IAAIsT,KAAI,SAACnR,GAAD,aACvB,0BAAgBoC,GAAhB,2BACGpC,GAAK,UAAAY,EAAM8Q,WAAWT,aAAjB,eAAwBU,UAAW,iBJ1B/C,SAAUC,EAAuBzB,GACrC,MAAO,CACLrP,KAAMkM,EAAsBlK,MAC5BqN,SAME,SAAU0B,EAAuB1B,GACrC,MAAO,CACLrP,KAAMkM,EAAsB8E,MAC5B3B,SAWE,SAAU4B,EACd5B,EACAe,GAEA,MAAO,CACLpQ,KAAMkM,EAAsBgF,OAC5B7B,QACAe,WAcE,SAAUe,EACd9B,EACAe,GAEA,MAAO,CACLpQ,KAAMkM,EAAsBiE,MAC5Bd,QACAc,MAAOC,G,uHAnEX,SAAYlE,GACV,mBACA,mBACA,qBACA,oBAJF,CAAYA,MAAqB,KKuB1B,IAAMkF,GAAuB,eAAgB,CAClDtR,MAAO,CACLkK,MAAO,CAAEhK,KAAMrF,QACfsD,OAAQ,CAAE+B,KAAMrF,QAChBuO,UAAW,CACTlJ,KAAMrF,OACNsF,UAAU,GAEZ6K,YAAa,CACX9K,KAAMqR,SAMNpR,UAAU,GAEZ8K,iBAAkB,CAChB/K,KAAMqR,SACNpR,UAAU,IAIdC,MAvBkD,SAuB5CJ,GACJ,IAAMM,EAAQ,eAAS,CACrBkR,SAAU,KAGN/Q,EAAU,CACdlF,MAAO,WACL,GAAKyE,EAAMkK,MAMJ,CAEL,IAAMuH,EAAWnR,EAAMkR,SACvBxR,EAAMgL,YAAYyG,EAAUzR,EAAMkK,YAPlClK,EAAMiL,iBAAN,iCACMjL,EAAMoJ,UAAkBnM,OAD9B,IAEEyU,UAAWpR,EAAMkR,aAQvBrB,MAAO,WACAnQ,EAAMkK,MAGT5J,EAAMkR,SAAW,IAASxR,EAAMkK,OAFhC5J,EAAMkR,SAAW,IAAUxR,EAAMoJ,UAAkBnM,MAAMyU,aAO/D,gBACE,kBAAM1R,EAAMkK,SACZ,WACEzJ,EAAQ0P,UAEV,CACEwB,WAAW,IAIf,IAAMC,EAAe,SAACpD,EAAkBsC,GAAiC,MACvE,OAAO,sBACJ1E,EAAsBlK,OAAQ,kBAC7B,kCAAkB5B,EAAMkR,SAASxR,MAAMwO,GAAvC,yCAAkBlO,EAAMkR,SAASxR,MAAMwO,GAAvC,aAFG,iBAIJpC,EAAsB8E,OAAQ,kBAC7B,kCAAwB5Q,EAAMkR,SAASxR,MAAMwO,GAA7C,yCAAwBlO,EAAMkR,SAASxR,MAAMwO,GAA7C,aALG,iBAOJpC,EAAsBgF,QAAS,wBAC9B,mCACc,MADd,WAEW9Q,EAAMkR,SAASxR,MAAMwO,GAFhC,yCAEWlO,EAAMkR,SAASxR,MAAMwO,GAFhC,SAII,WACA,OAAOsC,EAAWR,QAASC,KAAI,SAACnO,EAAK1H,GAAN,OAC7B,2BAAeA,EAAf,MAAyB0H,EAAImN,MAA7B,MAA2CnN,EAAIG,KAA/C,SAFF,IAJJ,sCARG,iBAmBJ6J,EAAsBiE,OAAQ,kBAC7B,6BACW/P,EAAMkR,SAASxR,MAAMwO,GADhC,yCACWlO,EAAMkR,SAASxR,MAAMwO,GADhC,cAEcsC,GAFd,SApBG,GAyBLA,EAAW5Q,SAGf,OAAO,WACL,IAAImP,EAAyB,GAC7B,GAAKrP,EAAMkK,MAiBJ,OAIU,EAHPiB,EAAiBnL,EAAMkK,MAAvBiB,aACFC,EAAS,UAAGpL,EAAM7B,cAAT,aAAG,EAAc0N,aAAaV,GAE7C,GAAIC,EACFiE,EAAQnU,KACN,6BAAkB,QAAlB,KACE,kCAAkBoF,EAAMkR,SAASlD,SAAjC,yCAAkBhO,EAAMkR,SAASlD,SAAjC,WADF,oCAIElD,EAAUpL,OACZqP,EAAQnU,KACN,4BACGL,OAAOgX,QAAQzG,EAAUpL,OAAOuQ,KAC/B,wCAAE/B,EAAF,KAAYsC,EAAZ,YACE,sCACQgB,cAAe,OADvB,OAEShB,EAAWvB,MAFpB,IAGOf,IAHP,KAKGoD,EAAapD,EAAUsC,IAL1B,yCAYN1F,EAAUzI,OACZ0M,EAAQnU,KACN,4BACGL,OAAOgX,QAAQzG,EAAUzI,OAAO4N,KAC/B,WAAqB7V,GAArB,4BAAE+T,EAAF,KAAac,EAAb,YACE,sCACQuC,cAAe,OADvB,OAESvC,EAFT,IAGO7U,IAHP,KAKE,kCAAkB4F,EAAMkR,SAAS7O,MAAM8L,GAAvC,yCAAkBnO,EAAMkR,SAAS7O,MAAM8L,GAAvC,WALF,6CAjDI,SAChBY,EAAQnU,KACN,4BACE,6BAAkB,QAAlB,KACE,iDACWoF,EAAMkR,SAAShG,MAD1B,yCACWlL,EAAMkR,SAAShG,MAD1B,KAEQuG,KAAM,MAFd,OADF,mCAMA,6BAAkB,QAAlB,KACE,iDACWzR,EAAMkR,SAAS/F,OAD1B,yCACWnL,EAAMkR,SAAS/F,OAD1B,KAEQsG,KAAM,MAFd,OADF,sCAsDN,OACE,4BAAW,YAAX,CACE,sDACG1C,EAAQkB,KAAI,SAAC5O,GAAD,OAAQA,KACrB,sDACE,2CAAe,WAAf,CAAgCH,QAASf,EAAQlF,QAAjD,oDAGA,uBAAiBiG,QAASf,EAAQ0P,OAAlC,kE,sHClKd,IAAM,GAAiB,EAEV6B,GAAe,eAAgB,CAC1ChS,MAAO,CACLwC,WAAY,CACVtC,KAAMrF,OACNoX,SAAS,GAEX9T,OAAQ,CACN+B,KAAMrF,OACNoX,SAAS,GAEX5T,SAAU,CAAE6B,KAAMrF,OAAyCsF,UAAU,GAErE7B,YAAa,CAAE4B,KAAMrF,SAEvB6H,MAAO,CACL,oBAAqB,SAACH,GAAD,OAAkC,IAEzDnC,MAjB0C,SAiBpCJ,EAAOK,GAEX,IAkCIkJ,EAlCEH,EAAY/G,GAChB,kBAAMrC,EAAMwC,cACZ,SAACD,GAAD,OAASlC,EAAIpB,KAAK,oBAAqBsD,MAGnC2P,EAAkB,gBAAS,yBAAO,CACtC1G,MAAO,GAAF,iBAAKxL,EAAMwC,kBAAX,aAAK,EAAkBkP,UAAUlG,MAAjC,MACLC,OAAQ,GAAF,iBAAKzL,EAAMwC,kBAAX,aAAK,EAAkBkP,UAAUjG,OAAjC,UAGF0G,EAAe,eAAI,IAGnBjJ,EAAY,gBAAS,WAAK,QACxBY,GACJ,UAAAV,EAAUnM,aAAV,eAAiBwM,OAAO2I,QAAO,SAACC,GAAD,OAAOA,EAAEvI,WAAU,GAC9CH,GACJ,UAAAP,EAAUnM,aAAV,eAAiBwM,OAAO2I,QAAO,SAACC,GAAD,OAAQA,EAAEvI,WAAU,GACrD,MAAO,CACLA,QACAH,cAIE2I,EAAc,gBAAK,GACnBhS,EAAQ,eAAS,CAErBiS,YAAa,gBACX,yBAAO,UAAAnJ,EAAUnM,aAAV,eAAiBwM,SAAU,IAAI6I,EAAYrV,UAEpDuV,SAAS,EACTC,SAAS,IAKLvE,EAAU,gBAAS,iBAAM,CAC7B,gBACA,CACEuE,SAAUnS,EAAMkS,aAId,EAAY9T,IACZ4K,EAAU5K,IAEhBsN,EAAmBE,QAAQ,CAAE7C,UAAA,EAAWC,YAGxC,IAAM7I,EAAU,CACdiS,WAAY,SAACxI,GAAiC,MACxCT,GAAS,UAAAL,EAAUnM,aAAV,eAAiBwM,SAAU,GAClB,IAAlBA,EAAO7O,SAEPsP,IACFT,EAASA,EAAO2I,QAAO,SAACC,GAAD,OAAOA,IAAMnI,MAEtCT,EAAOtK,SAAQ,SAAC+K,GAAD,OAAYA,EAAMJ,OAAQ,OAE3CX,aAAc,SAACM,GACbL,EAAUnM,MAAOwM,OAASA,GAG5BkJ,gBAAiB,WAAF,8CAAE,WAAOzI,GAAP,yGACIjI,EAASZ,SAAS,GAAI,CACvCH,MAAO,iBAFM,UACT0R,EADS,gBAKPxY,EAAOoE,KAAKqU,MAAMD,GAAQ,IACZ,WAAhB,eAAOxY,GANE,sBAOL,IAAI0Y,MAPC,OASbvJ,EAAUyB,YAAY5Q,EAAM8P,GATf,qDAWb,OAAa6I,MAAM,eAXN,0DAAF,sDAAE,GAcjBC,cAAe,SAAC9I,GACdjI,EAASZ,SAAS7C,KAAKC,UAAUyL,GAAQ,CAAEhJ,MAAO,UAEpD+R,SAAU,WACR3S,EAAMmS,SAAU,IAKdS,EAAe,WACnB,IAAI9H,EAAY,KAEV+H,EAAmB,CAIvBC,UAAW,SAAC1L,GACVA,EAAE2L,aAAcC,WAAa,QAE/BC,SAAU,SAAC7L,GACTA,EAAEgB,kBAKJ8K,UAAW,SAAC9L,GACVA,EAAE2L,aAAcC,WAAa,QAK/BG,KAAM,SAAC/L,GAAgB,MACrBqB,QAAQC,IAAI,OAAQoC,GACpB,IAAM3B,GAAS,UAAAL,EAAUnM,aAAV,eAAiBwM,SAAU,GAC1CA,EAAOvO,KACLgQ,EAAe,CACbE,UAAWA,EACXC,IAAK3D,EAAEgM,QACPpI,KAAM5D,EAAEiM,WAGZ5K,QAAQC,IAAI,IAAKtB,EAAEiM,SACnB5K,QAAQC,IAAI,IAAKtB,EAAEgM,SACnBtK,EAAUnM,MAAV,iCACKmM,EAAUnM,OADf,IAEEwM,WAEFH,EAAQrK,SAIN2U,EAAe,CACnBvK,UAAW,SAAC3B,EAAcb,GACxBsL,EAAalV,MAAM2L,iBACjB,YACAuK,EAAiBC,WAEnBjB,EAAalV,MAAM2L,iBACjB,WACAuK,EAAiBI,UAEnBpB,EAAalV,MAAM2L,iBACjB,YACAuK,EAAiBK,WAEnBrB,EAAalV,MAAM2L,iBAAiB,OAAQuK,EAAiBM,MAC7DrI,EAAYvE,EACZ,EAAU5H,QAEZqK,QAAS,SAAC5B,GACRyK,EAAalV,MAAM4L,oBACjB,YACAsK,EAAiBC,WAEnBjB,EAAalV,MAAM4L,oBACjB,WACAsK,EAAiBI,UAEnBpB,EAAalV,MAAM4L,oBACjB,YACAsK,EAAiBK,WAEnBrB,EAAalV,MAAM4L,oBAAoB,OAAQsK,EAAiBM,MAChErI,EAAY,OAIhB,OAAOwI,EA9EY,GAkFfC,EAAgB,WACpB,IAAMC,EAAO,eAAS,CACpBC,EAAG,KACHC,EAAG,OAEDC,EAAY,CACdxH,OAAQ,EACRC,OAAQ,EACRG,UAAW,EACXC,SAAU,EACVoH,SAAU,GACVlH,UAAU,EACVmH,UAAW,IAGPlH,EAAY,SAACvF,GACZuM,EAAUjH,WACbiH,EAAUjH,UAAW,EACrB,EAAU/N,QAHsB,IAMnBiO,EAA0BxF,EAAnCyF,QAAyBC,EAAU1F,EAAnB2F,QANY,EAQP4G,EAAnBxH,EAR0B,EAQ1BA,OAAQC,EARkB,EAQlBA,OAGZhF,EAAEG,WACAsC,KAAKM,IAAI/C,EAAEyF,QAAUV,GAAUtC,KAAKM,IAAI/C,EAAE2F,QAAUX,GACtDU,EAAQV,EAERQ,EAAQT,GAWZ,IAPA,IAAM2H,EAAcH,EAAUpH,UAAYK,EAAQT,EAC5C4H,EAAaJ,EAAUnH,SAAWM,EAAQV,EAC1C4H,EAAc,CAClBP,EAAG,KACHC,EAAG,MAGItZ,EAAI,EAAGA,EAAIuZ,EAAUE,UAAUH,EAAEpZ,OAAQF,IAAK,OAC5BuZ,EAAUE,UAAUH,EAAEtZ,GAAvC2Q,EAD6C,EAC7CA,IAAKkJ,EADwC,EACxCA,QACb,GAAIpK,KAAKM,IAAIY,EAAMgJ,GAAc,EAAG,CAClCjH,EAAQ/B,EAAMqB,EAASuH,EAAUnH,SACjCwH,EAAYN,EAAIO,EAChB,OAIJ,IAAK,IAAI,EAAI,EAAG,EAAIN,EAAUE,UAAUJ,EAAEnZ,OAAQ,IAAK,OAC1BqZ,EAAUE,UAAUJ,EAAE,GAAzCzI,EAD6C,EAC7CA,KAAMkJ,EADuC,EACvCA,SACd,GAAIrK,KAAKM,IAAIa,EAAO8I,GAAe,EAAG,CACpClH,EAAQ5B,EAAOmB,EAASwH,EAAUpH,UAClCyH,EAAYP,EAAIS,EAChB,OAIJ,IAAM9G,EAAON,EAAQV,EACfe,EAAOP,EAAQT,EACrBvD,EAAUjM,MAAM6M,MAAM3K,SAAQ,SAAC+K,EAAOxP,GACpCwP,EAAMmB,IAAM4I,EAAUC,SAASxZ,GAAG2Q,IAAMqC,EACxCxD,EAAMoB,KAAO2I,EAAUC,SAASxZ,GAAG4Q,KAAOmC,KAG5CqG,EAAKC,EAAIO,EAAYP,EACrBD,EAAKE,EAAIM,EAAYN,GAEjBpG,EAAU,SAAVA,EAAWlG,GACf9F,SAASiH,oBAAoB,YAAaoE,GAC1CrL,SAASiH,oBAAoB,UAAW+E,GACxCkG,EAAKC,EAAI,KACTD,EAAKE,EAAI,KACLC,EAAUjH,UACZ1D,EAAQrK,QAIN4O,EAAY,SAACnG,GACjBuM,EAAY,CACVxH,OAAQ/E,EAAEyF,QACVT,OAAQhF,EAAE2F,QACVP,SAAUxM,EAAMiS,YAAalH,IAC7BwB,UAAWvM,EAAMiS,YAAajH,KAC9B4I,SAAUhL,EAAUjM,MAAM6M,MAAMyG,KAAI,gBAAGlF,EAAH,EAAGA,IAAKC,EAAR,EAAQA,KAAR,MAAoB,CACtDD,MACAC,WAEF0B,UAAU,EACVmH,UAAY,WAAK,MACYjL,EAAUjM,MAAtB0M,GADA,EACPG,MADO,EACAH,SADA,EAGsBrJ,EAAMiS,YAAxB/G,GAHJ,EAGPH,IAHO,EAGFC,KAHE,EAGIE,OAAOC,EAHX,EAGWA,OACpBgJ,EAAQ,CAAEV,EAAG,GAAIC,EAAG,IA8B1B,MA7BA,yBACKrK,GADL,CAEE,CACE0B,IAAK,EACLC,KAAM,EACNE,MAAOpC,EAAUnM,MAAOyU,UAAUlG,MAClCC,OAAQrC,EAAUnM,MAAOyU,UAAUjG,UAErCtM,SAAQ,SAAC+K,GAAS,IACLhN,EAAoCgN,EAAzCmB,IAAcjP,EAA2B8N,EAAjCoB,KAAgBoJ,EAAiBxK,EAAxBsB,MAAkBmJ,EAAMzK,EAAduB,OAEnCgJ,EAAMT,EAAE9Y,KAAK,CAAEmQ,IAAKnO,EAAGqX,QAASrX,IAChCuX,EAAMT,EAAE9Y,KAAK,CAAEmQ,IAAKnO,EAAIyX,EAAGJ,QAASrX,EAAIyX,IACxCF,EAAMT,EAAE9Y,KAAK,CAAEmQ,IAAKnO,EAAIyX,EAAI,EAAIlJ,EAAS,EAAG8I,QAASrX,EAAIyX,EAAI,IAC7DF,EAAMT,EAAE9Y,KAAK,CAAEmQ,IAAKnO,EAAIuO,EAAQ8I,QAASrX,IACzCuX,EAAMT,EAAE9Y,KAAK,CAAEmQ,IAAKnO,EAAIyX,EAAIlJ,EAAQ8I,QAASrX,EAAIyX,IAIjDF,EAAMV,EAAE7Y,KAAK,CAAEoQ,KAAMlP,EAAGoY,SAAUpY,IAClCqY,EAAMV,EAAE7Y,KAAK,CAAEoQ,KAAMlP,EAAIsY,EAAGF,SAAUpY,EAAIsY,IAC1CD,EAAMV,EAAE7Y,KAAK,CACXoQ,KAAMlP,EAAIsY,EAAI,EAAIlJ,EAAQ,EAC1BgJ,SAAUpY,EAAIsY,EAAI,IAEpBD,EAAMV,EAAE7Y,KAAK,CAAEoQ,KAAMlP,EAAIoP,EAAOgJ,SAAUpY,IAC1CqY,EAAMV,EAAE7Y,KAAK,CAAEoQ,KAAMlP,EAAIsY,EAAIlJ,EAAOgJ,SAAUpY,EAAIsY,OAG7CD,EAlCG,IAqCd7S,SAASgH,iBAAiB,YAAaqE,GACvCrL,SAASgH,iBAAiB,UAAWgF,IAGvC,MAAO,CAAEC,YAAWiG,QAnIA,GAuIhBjT,EAAU,CACd+T,mBAAoB,SAAClN,EAAewC,GAC9B5J,EAAMkS,UACV9K,EAAEgB,iBACFhB,EAAEe,kBAEFkH,EAAW,CACTZ,UAAWrH,EACX2H,QAAS,kBACP,4BACE,yBACQ,OADR,KAEO,iBAFP,QAGW9F,EAAUuB,UAHrB,MAKA,yBACQ,OADR,KAEO,oBAFP,QAGWvB,EAAUwB,aAHrB,MAKA,yBACQ,OADR,KAEO,cAFP,QAGWxB,EAAUqB,QAHrB,MAKA,yBACQ,OADR,KAEO,cAFP,QAGW,kBAAMnK,EAAQuS,cAAc9I,KAHvC,MAKA,yBACQ,OADR,KAEO,cAFP,QAGW,kBAAMzJ,EAAQkS,gBAAgBzI,KAHzC,cAYJ2K,EAAgB,WACpB,MAAO,CACLnD,UAAW,CACToD,YAAa,SAACpN,GACZpH,EAAMmS,SAAW/K,EAAEgB,iBACfhB,EAAEqN,gBAAkBrN,EAAE0H,SAI1B3O,EAAQiS,aAERJ,EAAYrV,OAAS,KAGzBiN,MAAO,CACL4K,YAAa,SACXpN,EACAwC,EACAnL,GAEIuB,EAAMkS,UAEV9K,GAAKA,EAAEgB,iBAEFwB,EAAMJ,QACJpC,EAAEG,SAILqC,EAAMJ,OAAQ,GAHdI,EAAMJ,OAASI,EAAMJ,MACrBrJ,EAAQiS,WAAWxI,KAMvBoI,EAAYrV,MAAQ8B,EAEpB8U,EAAahG,UAAUnG,OAnCT,GAwCtB6B,EAAYN,EAAiB,CAC3BC,UAAWA,EACXC,aAAc1I,EAAQ0I,aACtBC,YACAC,UAAA,EACAC,YAGF,IAAM0L,EAAY,yDAAG,6GACnBjM,QAAQC,IAAI,gBADO,SAEA/G,EAASZ,SAAS,GAAI,CACvCH,MAAO,mBAHU,UAEb0R,EAFa,OAKnB7J,QAAQC,IAAI,OAAQ4J,GALD,SAOXxY,EAAOoE,KAAKqU,MAAMD,GAAQ,IACZ,WAAhB,eAAOxY,GARM,sBAST,IAAI0Y,MATK,OAWjB1J,EAAUnM,MAAQ7C,EAXD,qDAajB,OAAa2Y,MAAM,eAbF,0DAAH,qDAiBZkC,EAAY,yDAAG,2GACnBlM,QAAQC,IAAI,gBADO,SAEA/G,EAASZ,SAAS7C,KAAKC,UAAU2K,EAAUnM,OAAQ,CACpEiE,MAAO,SAHU,OAEb0R,EAFa,OAKnB7J,QAAQC,IAAI,OAAQ4J,GALD,2CAAH,qDAQZsC,EAAU,CACd,CACE3F,MAAO,KACPC,KAAM,YACN3O,QAAS0I,EAAUlC,KACnB8N,IAAK,UAEP,CACE5F,MAAO,KACPC,KAAM,eACN3O,QAAS0I,EAAUjC,KACnB6N,IAAK,wBAEP,CACE5F,MAAO,kBAAOjP,EAAMkS,QAAU,KAAO,MACrChD,KAAM,kBAAOlP,EAAMkS,QAAU,YAAc,eAC3C3R,QAAS,WACPP,EAAMkS,SAAWlS,EAAMkS,QACnBlS,EAAMkS,SACR/R,EAAQiS,eAId,CACEnD,MAAO,KACPC,KAAM,cACN3O,QAASmU,GAGX,CACEzF,MAAO,KACPC,KAAM,cACN3O,QAASoU,GAEX,CACE1F,MAAO,KACPC,KAAM,iBACN3O,QAAS,kBAAM0I,EAAUuB,aAE3B,CACEyE,MAAO,KACPC,KAAM,oBACN3O,QAAS,kBAAM0I,EAAUwB,gBAG3B,CACEwE,MAAO,KACPC,KAAM,cACN3O,QAAS,kBAAM0I,EAAUqB,UACzBuK,IAAK,+BAEP,CACE5F,MAAO,KACPC,KAAM,aACN3O,QAAS,kBAAM0I,EAAUsB,UAE3B,CACE0E,MAAO,KACPC,KAAM,aACN3O,QAAS,WACPJ,EAAQiS,aACRpS,EAAMmS,SAAU,KAKhB2C,EAAY,SAACC,GACjB,MAAqB,oBAAPA,EAAoBA,IAAOA,GAG3C,OAAO,WAAK,UAEV,OADAtM,QAAQC,IAAI,cAAe1I,EAAMiS,aAE/B,4BACE,4CACQ,0BADR,MAESL,EAAgBjV,OAFzB,GAKI,UAAAmM,EAAUnM,aAAV,eAAiBwM,SAAU,IAAI8G,KAAI,SAACrG,EAAOnL,GAAR,OACnC,wBACSmL,EADT,IAEOnL,EAFP,OAGUiB,EAAM7B,OAHhB,SAIY6B,EAAM3B,SAJlB,MAKSgC,EAAI2N,MALb,YAMehO,EAAM1B,aANrB,SASF,4BAAW,wBAAX,QAA4CmC,EAAQwS,UAApD,CACE,0BAAS,sBAAT,MACA,yDAjBJ,UAGW3S,EAAMmS,WAkBjB,4CAAYvE,EAAQjR,OAApB,CACE,4BAAW,QAAX,WACG+C,EAAM7B,cADT,aACG,EAAcyN,cAAc2E,KAAI,SAACnF,GAAD,OAC/B,4BACQ,YADR,uBAGa8H,EAAY5J,QAHzB,YAIe,SAAC5B,GAAD,OAAOwL,EAAY7J,UAAU3B,EAAG0D,KAJ/C,CAME,6BAAY,mBAAZ,CAA+BA,EAAUmE,QACxCnE,EAAUoH,iBAIjB,4BAAW,QAAX,CACG0C,EAAQ3E,KAAI,SAAC+E,EAAKvW,GACjB,IAAMsQ,EACJ,0BAAUtQ,EAAV,MAAuB,WAAvB,QAA2CuW,EAAIzU,SAA/C,CACE,6CAAsBuU,EAAUE,EAAI9F,QAApC,MACA,4BAAO4F,EAAUE,EAAI/F,WAGzB,OAAK+F,EAAIH,IAEP,oDACS,OADT,QAEWG,EAAIH,IAFf,UAGY,UAHZ,GAKG9F,KALH,2BAKGA,MAPgBA,OAazB,4BAAW,QAAX,CACE,4BAAW,WAAX,CACE,2CACQ,0BADR,IAEO8C,EAFP,MAGSD,EAAgBjV,OACnB4X,EAAanD,WAJnB,GAMI,UAAAtI,EAAUnM,aAAV,eAAiBwM,SAAU,IAAI8G,KAC/B,SAACrG,EAAOnL,GAAR,OACE,uCACSmL,EADT,IAEOnL,EAFP,OAGUiB,EAAM7B,OAHhB,SAIY6B,EAAM3B,SAJlB,MAKSgC,EAAI2N,MALb,YAMehO,EAAM1B,aANrB,CAQIwW,YAAa,SAACpN,GAAD,OACXmN,EAAa3K,MAAM4K,YAAYpN,EAAGwC,EAAOnL,IAC3CwW,cAAe,SAAC7N,GAAD,OACb7G,EAAQ+T,mBAAmBlN,EAAGwC,MAXpC,SAgBH2J,EAAaC,KAAKC,GACjB,4BACQ,cADR,MAES,CAAEzI,KAAM,GAAF,OAAKuI,EAAaC,KAAKC,EAAvB,QAFf,MAKDF,EAAaC,KAAKE,GACjB,4BACQ,cADR,MAES,CAAE3I,IAAK,GAAF,OAAKwI,EAAaC,KAAKE,EAAvB,QAFd,YASR,yBACS1T,EAAMiS,YADf,OAEUvS,EAAM7B,OAFhB,UAGaiL,EAHb,YAIeG,EAAUyB,YAJzB,iBAKoBzB,EAAU0B,kBAL9B,QA7EF,SAAmC3K,EAAMmS,iBC3iBtC+C,I,UAAc,eAAgB,CACzCxV,MAAO,CACL2N,MAAO,CAAEzN,KAAMuC,QACfqL,IAAK,CAAE5N,KAAMuC,SAEfC,MAAO,CACL,eAAgB,SAACH,GAAD,OAAkB,GAClC,aAAc,SAACA,GAAD,OAAkB,IAElCnC,MATyC,SASnCJ,EAAOK,GACX,IAAMoV,EAAapT,GACjB,kBAAMrC,EAAM2N,SACZ,SAACpL,GAAD,OAASlC,EAAIpB,KAAK,eAAgBsD,MAE9BmT,EAAWrT,GACf,kBAAMrC,EAAM2N,SACZ,SAACpL,GAAD,OAASlC,EAAIpB,KAAK,aAAcsD,MAGlC,OAAO,kBACL,4BAAW,gBAAX,CACE,2BACE,6CAAY,OAAZ,yCAA4BkT,EAAWxY,MAAvC,mBAA4BwY,EAAWxY,WAGzC,kDACA,2BACE,6CAAY,OAAZ,yCAA4ByY,EAASzY,MAArC,mBAA4ByY,EAASzY,kB,oICnBxC0Y,GAAmB,OAEpBvX,GAAeuN,IAErBvN,GAAa8I,SAAS,OAAQ,CAC5BqI,MAAO,KACPiD,QAAS,iBAAM,QACfnE,OAAQ,gBAAGrO,EAAH,EAAGA,MAAH,OACN,6BAAa,CAAEkR,MAAOlR,EAAMkR,MAAO0E,SAAU5V,EAAMuO,OAAnD,CACGvO,EAAM4S,MAAQ,UAGnB5S,MAAO,CACL4S,KAAM5B,EAAuB,QAC7BE,MAAOD,EAAuB,QAC9B1C,KAAM4C,EAAwB,OAAQ,CACpC,CAAE5B,MAAO,OAAQhN,IAAK,QACtB,CAAEgN,MAAO,OAAQhN,IAAK,QACtB,CAAEgN,MAAO,OAAQhN,IAAK,aAK5BnE,GAAa8I,SAAS,SAAU,CAC9BqI,MAAO,KACPiD,QAAS,kBAAM,gFACfnE,OAAQ,gBAAGrO,EAAH,EAAGA,MAAOuO,EAAV,EAAUA,KAAMG,EAAhB,EAAgBA,OAAhB,OACN,qCACMA,EADN,MAEQ1O,EAAME,KAFd,KAGQF,EAAMuO,KAHd,MAIS,CACL/C,MAAO+C,EAAK/C,MAAL,UAAgB+C,EAAK/C,MAArB,WAAiCqK,EACxCpK,OAAQ8C,EAAK9C,OAAL,UAAiB8C,EAAK9C,OAAtB,WAAmCoK,KAN/C,2BASG7V,EAAM4S,MAAQ,UAGnBpG,OAAQ,CAAEhB,OAAO,EAAMC,QAAQ,GAC/BzL,MAAO,CACL4S,KAAM5B,EAAuB,QAC7B9Q,KAAMiR,EAAwB,OAAQ,CACpC,CAAE5B,MAAO,KAAMhN,IAAK,WACpB,CAAEgN,MAAO,KAAMhN,IAAK,WACpB,CAAEgN,MAAO,KAAMhN,IAAK,WACpB,CAAEgN,MAAO,KAAMhN,IAAK,UACpB,CAAEgN,MAAO,KAAMhN,IAAK,QACpB,CAAEgN,MAAO,KAAMhN,IAAK,UAEtBgM,KAAM4C,EAAwB,OAAQ,CACpC,CAAE5B,MAAO,KAAMhN,IAAK,IACpB,CAAEgN,MAAO,KAAMhN,IAAK,UACpB,CAAEgN,MAAO,IAAKhN,IAAK,SACnB,CAAEgN,MAAO,KAAMhN,IAAK,aAK1BnE,GAAa8I,SAAS,QAAS,CAC7BqI,MAAO,MACPiD,QAAS,kBAAM,8BAAqB,IAArB,OACfnE,OAAQ,YAA4B,IAAzB1L,EAAyB,EAAzBA,MAAO4L,EAAkB,EAAlBA,KAAMG,EAAY,EAAZA,OACtB,OACE,iCACMA,EACA/L,EAAMxB,QAFZ,OAGS,CAAEqK,MAAO+C,EAAK/C,MAAL,UAAgB+C,EAAK/C,MAArB,WAAiCqK,KAHnD,OAOJrJ,OAAQ,CAAEhB,OAAO,GACjB7I,MAAO,CACLxB,QAAS,QAEXnB,MAAO,CACLuO,KAAM4C,EAAwB,QAAS,CACrC,CAAE5B,MAAO,KAAMhN,IAAK,IACpB,CAAEgN,MAAO,KAAMhN,IAAK,UACpB,CAAEgN,MAAO,IAAKhN,IAAK,SACnB,CAAEgN,MAAO,KAAMhN,IAAK,aAK1BnE,GAAa8I,SAAS,SAAU,CAC9BqI,MAAO,MACPiD,QAAS,kBAAM,kCACfnE,OAAQ,kBAAGrO,EAAH,EAAGA,MAAO2C,EAAV,EAAUA,MAAO+L,EAAjB,EAAiBA,OAAjB,OACN,0CAAevE,KAAK2L,UAAcpH,EAAY/L,EAAMxB,SAApD,MACInB,EAAMsQ,SAAW,IAAIC,KACrB,SACEnO,EAIArD,GALF,OAOE,6BAAiBqD,EAAImN,MAArB,MAAmCnN,EAAInF,MAAvC,IAAmD8B,GAAnD,UATN,oCAcFiB,MAAO,CACLsQ,QAASe,EAAsB,OAAQ,CACrCf,QAAS,CACP,CAAEf,MAAO,MAAOkB,MAAO,SACvB,CAAElB,MAAO,MAAOkB,MAAO,SACvB,CAAElB,MAAO,KAAMkB,MAAO,WAExBM,QAAS,WAGbpO,MAAO,CACLxB,QAAS,UAIb/C,GAAa8I,SAAS,eAAgB,CACpCqI,MAAO,UACP/C,OAAQ,CAAEhB,OAAO,GACjBgH,QAAS,kBAAM,8BACfnE,OAAQ,gBAAG1L,EAAH,EAAGA,MAAO4L,EAAV,EAAUA,KAAV,OACN,wCACS,CAAE/C,MAAO+C,EAAK/C,MAAL,UAAgB+C,EAAK/C,MAArB,WAAiCqK,IADnD,CAGIlI,MAAOhL,EAAMgL,MAAM1Q,MACnB,iBAAkB0F,EAAMgL,MAAMoI,SAC9BjI,IAAKnL,EAAMmL,IAAI7Q,MACf,eAAgB0F,EAAMmL,IAAIiI,WAN9B,OAWFpT,MAAO,CACLgL,MAAO,SACPG,IAAK,YAIT1P,GAAa8I,SAAS,QAAS,CAC7BqI,MAAO,KACP/C,OAAQ,CAAEhB,OAAO,EAAMC,QAAQ,GAC/B+G,QAAS,kBACP,4BAAW,qBAAX,CACE,4BAAW,sFAAX,CACE,0BAAS,mBAAT,WAINnE,OAAQ,gBAAGrO,EAAH,EAAGA,MAAOuO,EAAV,EAAUA,KAAV,OACN,4BACS,CACL9C,OAAQ8C,EAAK9C,OAAL,UAAiB8C,EAAK9C,OAAtB,WAAmCoK,EAC3CrK,MAAO+C,EAAK/C,MAAL,UAAgB+C,EAAK/C,MAArB,WAAiCqK,GAH5C,MAKQ,sBALR,CAOE,0BAAU7V,EAAMgW,KAAO,wCAAvB,SAGJhW,MAAO,CACLgW,IAAKhF,EAAuB,SAIjB,U,aC1KA,kBAAgB,CAC7BxU,KAAM,MACNyZ,WAAY,CAAEjE,iBACd5X,KAH6B,WAGzB,WACF,MAAO,CACLgE,aAAA,GACAF,SAAUA,GACVG,SAAU,CACR6X,SAAU,SAEZ5X,YAAa,CAEX6X,OAAQ,CACN3U,QAAS,WACP,EAAK4U,QAAQ,CAAEC,QAAS,wBAG5BC,SAAU,CACRP,SAAU,SAACxT,GACT,EAAK6T,QAAQ,CAAEC,QAAS,WAAF,OAAa9T,Y,UCrB/C,GAAO8L,OAAS,EAED,UCFT,I,UAAM,eAAUkI,KACtB,GAAIC,IAAI,QACR,GAAIxU,MAAM,S","file":"js/app.8bbd8052.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/zhufeng-vue-drops-2101/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./App.vue?vue&type=style&index=0&id=17b8bfe6&lang=scss\"","<template>\n  <div class=\"app\">\n    <visual-editor\n      v-model=\"jsonData\"\n      :config=\"visualConfig\"\n      :formData=\"formData\"\n      :customProps=\"customProps\"\n    >\n      <template #subBtn v-if=\"formData.food\">\n        <!-- 通过组件标识来自定义组件内容 -->\n        <el-button v-if=\"formData.food === 'dangao'\">显示蛋糕</el-button>\n        <el-tag v-else>其他食物</el-tag>\n      </template>\n    </visual-editor>\n    <div class=\"show-text\">\n      {{ JSON.stringify(formData) }}\n    </div>\n  </div>\n</template>\n<script lang=\"ts\">\nimport { defineComponent } from \"vue\";\nimport { VisualEditor } from \"../src/packages/visual-editor\";\n// import { TestUseModel } from \"../src/packages/utils/useModel\";\nimport visualConfig from \"./packages/visual.config\";\nimport jsonData from \"./jsonData.json\";\n\nexport default defineComponent({\n  name: \"App\",\n  components: { VisualEditor },\n  data() {\n    return {\n      visualConfig,\n      jsonData: jsonData,\n      formData: {\n        username: \"admin\",\n      },\n      customProps: {\n        // subBtn是组件标识\n        subBtn: {\n          onClick: () => {\n            this.$notify({ message: \"执行表单数据校验及提交服务器的动作\" });\n          },\n        },\n        mySelect: {\n          onChange: (val: string) => {\n            this.$notify({ message: `食物发生变化: ${val}` });\n          },\n        },\n      },\n    };\n  },\n});\n</script>\n\n<style lang=\"scss\">\nhtml,\nbody {\n  margin: 0;\n  padding: 0;\n}\n.show-text {\n  position: absolute;\n  text-align: center;\n  width: 100%;\n  bottom: 200px;\n}\n</style>\n","type SimplyListener = (...args: any[]) => void;\nexport function createEvent() {\n  const listeners: SimplyListener[] = [];\n  return {\n    on: (cb: SimplyListener) => {\n      listeners.push(cb);\n    },\n    off: (cb: SimplyListener) => {\n      const index = listeners.indexOf(cb);\n      if (index > -1) {\n        listeners.slice(index, 1);\n      }\n    },\n    emit: (...args: any[]) => {\n      listeners.forEach((item) => item(...args));\n    },\n  };\n}\n","interface Defer {\n  (): {\n    resolve: () => void;\n    reject: () => void;\n    promise: Promise<void>;\n  };\n  <T>(): {\n    resolve: (val: T) => void;\n    reject: () => void;\n    promise: Promise<T>;\n  };\n}\n\nexport const defer: Defer = () => {\n  const dfd = {} as any;\n  dfd.promise = new Promise((resolve, reject) => {\n    dfd.resolve = resolve as any;\n    dfd.reject = reject;\n  });\n  return dfd;\n};\n","import {\n  defineComponent,\n  PropType,\n  reactive,\n  createApp,\n  getCurrentInstance,\n} from \"vue\";\nimport { defer } from \"./defer\";\nimport { ElDialog, ElButton, ElInput } from \"element-plus\";\n\nconst Dialog = ElDialog as any;\n\nenum DialogServiceEditType {\n  textarea = \"textarea\",\n  input = \"input\",\n}\n\ninterface DialogServiceOption {\n  title?: string;\n  editType?: DialogServiceEditType;\n  editReadonly?: boolean;\n  editValue?: string | null;\n  onConfirm?: (val?: string | null) => void;\n}\n\nconst keyGenerator = (() => {\n  let count = 0;\n  return () => `auto_key_${count++}`;\n})();\n\nconst ServiceComponent = defineComponent({\n  props: {\n    option: { type: Object as PropType<DialogServiceOption>, required: true },\n  },\n  setup(props) {\n    const ctx = getCurrentInstance()!;\n    const state = reactive({\n      option: props.option,\n      editValue: null as undefined | null | string,\n      showFlag: false,\n      key: keyGenerator(),\n    });\n    const methods = {\n      service: (option: DialogServiceOption) => {\n        state.option = option;\n        state.editValue = option.editValue;\n        state.key = keyGenerator();\n        methods.show();\n      },\n      show: () => (state.showFlag = true),\n      hide: () => (state.showFlag = false),\n    };\n\n    const handler = {\n      onConfirm: () => {\n        state.option.onConfirm!(state.editValue);\n        methods.hide();\n      },\n      onCancel: () => {\n        methods.hide();\n      },\n    };\n\n    // 很重要 把methods给组件的实例\n    Object.assign(ctx.proxy, methods);\n\n    return () => (\n      <Dialog\n        v-model={state.showFlag}\n        title={state.option.title}\n        key={state.key}\n      >\n        {{\n          default: () => (\n            <div>\n              {state.option.editType === DialogServiceEditType.textarea ? (\n                <ElInput\n                  type=\"textarea\"\n                  {...{ rows: 10 }}\n                  v-model={state.editValue}\n                />\n              ) : (\n                <ElInput v-model={state.editValue} />\n              )}\n            </div>\n          ),\n          footer: () => (\n            <div>\n              <ElButton {...({ onClick: handler.onCancel } as any)}>\n                取消\n              </ElButton>\n              <ElButton {...({ onClick: handler.onConfirm } as any)}>\n                确定\n              </ElButton>\n            </div>\n          ),\n        }}\n      </Dialog>\n    );\n  },\n});\n\nconst DialogService = (() => {\n  let ins: any;\n  return (option: DialogServiceOption) => {\n    if (!ins) {\n      const el = document.createElement(\"div\");\n      document.body.append(el);\n      ins = createApp(ServiceComponent, { option }).mount(el);\n    }\n    ins.service(option);\n  };\n})();\n\nexport const $$dialog = Object.assign(DialogService, {\n  input: (initValue?: string, option?: DialogServiceOption) => {\n    const dfd = defer<string | undefined | null>();\n    const opt: DialogServiceOption = {\n      ...option!,\n      editType: DialogServiceEditType.input,\n      onConfirm: dfd.resolve,\n      editValue: initValue,\n    };\n    DialogService(opt);\n    return dfd.promise;\n  },\n  textarea: (initValue?: string, option?: DialogServiceOption) => {\n    const dfd = defer<string | undefined | null>();\n    const opt: DialogServiceOption = {\n      ...option,\n      editType: DialogServiceEditType.textarea,\n      onConfirm: dfd.resolve,\n      editValue: initValue,\n    };\n    DialogService(opt);\n    return dfd.promise;\n  },\n});\n","import { computed, defineComponent, ref, watch } from \"vue\";\n\n// 用jsx封装组件的时候，实现双向数据绑定\nexport function useModel<T>(getter: () => T, emitter: (val: T) => void) {\n  const state = ref(getter()) as { value: T };\n\n  watch(getter, (val) => {\n    if (val !== state.value) {\n      state.value = val;\n    }\n  });\n\n  return {\n    get value() {\n      return state.value;\n    },\n    set value(val: T) {\n      if (state.value !== val) {\n        state.value = val;\n        emitter(val);\n      }\n    },\n  };\n}\n\n// modelValue 外部可以用v-model绑定\nexport const TestUseModel = defineComponent({\n  props: {\n    modelValue: { type: String },\n  },\n  emits: {\n    \"update:modelValue\": (val?: string) => true,\n  },\n  setup(props, ctx) {\n    const model = useModel(\n      () => props.modelValue,\n      (val) => ctx.emit(\"update:modelValue\", val)\n    );\n    return () => (\n      <div>\n        自定义输入框\n        <input type=\"text\" v-model={model.value} />\n      </div>\n    );\n  },\n});\n","export const KeyboardCode = {\n    16: 'shift',\n    17: 'ctrl',\n    18: 'alt',\n\n    8: 'backspace',\n    9: 'tab',\n    13: 'enter',\n    27: 'esc',\n    32: 'space',\n\n    37: 'left',\n    38: 'up',\n    39: 'right',\n    40: 'down',\n    46: 'delete',\n    189: '-',\n    187: '=',\n\n    48: '0',\n    49: '1',\n    50: '2',\n    51: '3',\n    52: '4',\n    53: '5',\n    54: '6',\n    55: '7',\n    56: '8',\n    57: '9',\n\n    65: 'a',\n    66: 'b',\n    67: 'c',\n    68: 'd',\n    69: 'e',\n    70: 'f',\n    71: 'g',\n    72: 'h',\n    73: 'i',\n    74: 'j',\n    75: 'k',\n\n    76: 'l',\n    77: 'm',\n    78: 'n',\n    79: 'o',\n    80: 'p',\n    81: 'q',\n    82: 'r',\n    83: 's',\n    84: 't',\n    85: 'u',\n    86: 'v',\n    87: 'w',\n    88: 'x',\n    89: 'y',\n    90: 'z',\n\n    112: 'F1',\n    113: 'F2',\n    114: 'F3',\n    115: 'F4',\n    116: 'F5',\n    117: 'F6',\n    118: 'F7',\n    119: 'F8',\n    120: 'F9',\n    121: 'F10',\n    122: 'F11',\n    123: 'F12',\n} as Record<number, string>","import { reactive } from \"vue\";\nimport { KeyboardCode } from \"./keyboard-code\";\nexport interface CommondExecute {\n  undo: () => void;\n  redo: () => void;\n}\n\nexport interface Command {\n  name: string; // 命令唯一标识\n  keyboard?: string | string[]; // 命令监听的快捷键\n  execute: (...args: any[]) => CommondExecute; // 命令被执行的时候，做的内容\n  followQueue?: boolean; // 命令执行完之后，是否将命令执行得到的undo, redo存入命令队列\n  init?: () => () => void | undefined;\n  data?: any;\n}\n\nexport interface CommandManager {\n  queue: CommondExecute[];\n  current: number;\n}\n\nexport function useCommander() {\n  const state = reactive({\n    current: -1,\n    queue: [] as CommondExecute[],\n    commands: {} as Record<string, (...args: any[]) => void>,\n    destroyList: [] as (() => void | undefined)[],\n    commandArray: [] as Command[],\n  });\n  const registry = (command: Command) => {\n    // state.commandArray.push(command);\n    // state.commands[command.name] = (...args) => {\n    //   const { undo, redo } = command.execute(...args);\n    //   if (command.followQueue !== false) {\n    //     state.queue.push({ undo, redo });\n    //     state.current += 1;\n    //   }\n    //   redo();\n    // };\n\n    state.commandArray.push(command);\n    state.commands[command.name] = (...args) => {\n      const { undo, redo } = command.execute(...args);\n      redo();\n      /*如果命令执行之后，不需要进入命令队列，则直接结束*/\n      if (command.followQueue === false) {\n        return;\n      }\n      /*否则，将命令队列中剩余的命令去除，保留current及其之前的命令*/\n      let { queue } = state;\n      const { current } = state;\n      if (queue.length > 0) {\n        queue = queue.slice(0, current + 1);\n        state.queue = queue;\n      }\n      /*设置命令队列中最后一个命令为当前执行的命令*/\n      queue.push({ undo, redo });\n      /*索引+1，指向队列中的最后一个命令*/\n      state.current = current + 1;\n    };\n  };\n\n  const keyboardEvent = (() => {\n    const onKeydown = (e: KeyboardEvent) => {\n      if (document.activeElement !== document.body) {\n        return;\n      }\n      const { keyCode, shiftKey, altKey, ctrlKey, metaKey } = e;\n      const keyStr: string[] = [];\n      if (ctrlKey || metaKey) {\n        keyStr.push(\"ctrl\");\n      }\n      if (shiftKey) keyStr.push(\"shift\");\n      if (altKey) keyStr.push(\"alt\");\n      keyStr.push(KeyboardCode[keyCode]);\n      const keyNames = keyStr.join(\"+\");\n      state.commandArray.forEach(({ keyboard, name }) => {\n        if (!keyboard) return;\n        const keys = !Array.isArray(keyboard) ? [keyboard] : keyboard;\n        if (keys.includes(keyNames)) {\n          // 执行命令\n          state.commands[name]();\n          e.stopPropagation();\n          e.preventDefault();\n        }\n      });\n    };\n\n    const init = () => {\n      window.addEventListener(\"keydown\", onKeydown);\n      return () => {\n        window.removeEventListener(\"keydown\", onKeydown);\n      };\n    };\n    return init;\n  })();\n\n  const init = () => {\n    // const onKeydown = (e: KeyboardEvent) => {\n    //   console.log(\"监听到键盘事件\");\n    // };\n    // window.addEventListener(\"keydown\", onKeydown);\n    state.commandArray.forEach(\n      (command) => !!command.init && state.destroyList.push(command.init())\n    );\n    state.destroyList.push(keyboardEvent());\n    // state.destroyList.push(() =>\n    //   window.removeEventListener(\"keydown\", onKeydown)\n    // );\n  };\n\n  registry({\n    name: \"undo\",\n    keyboard: \"ctrl+z\",\n    followQueue: false,\n    execute: () => {\n      // 命令被执行的时候，要做的事情\n      return {\n        redo: () => {\n          // 重新做一遍，要做的事情\n          const { current } = state;\n          if (current === -1) return;\n          const queueItem = state.queue[current];\n          if (queueItem) {\n            queueItem.undo && queueItem.undo();\n            state.current--;\n          }\n        },\n        undo: () => {\n          // 将做的事情还原\n        },\n      };\n    },\n  });\n\n  registry({\n    name: \"redo\",\n    keyboard: [\"ctrl+y\", \"ctrl+shift+z\"],\n    followQueue: false,\n    execute: () => {\n      return {\n        redo: () => {\n          const queueItem = state.queue[state.current + 1];\n          if (queueItem) {\n            queueItem.redo();\n            state.current++;\n          }\n        },\n        undo: () => {\n          console.log(\"undo\");\n        },\n      };\n    },\n  });\n\n  return {\n    state,\n    registry,\n    init,\n  };\n}\n","import { useCommander } from \"../plugins/command.plugin\";\nimport {\n  VisualEditorBlockData,\n  VisualEditorModelValue,\n} from \"../visual-editor.utils\";\nimport deepcopy from \"deepcopy\";\n\nexport function useVisualCommand({\n  focusData,\n  updateBlocks,\n  dataModel,\n  dragstart,\n  dragend,\n}: {\n  focusData: {\n    value: { focus: VisualEditorBlockData[]; unfocus: VisualEditorBlockData[] };\n  };\n  updateBlocks: (blocks: VisualEditorBlockData[]) => void;\n  dataModel: { value: VisualEditorModelValue | undefined };\n  dragstart: { on: (cb: () => void) => void; off: (cb: () => void) => void };\n  dragend: { on: (cb: () => void) => void; off: (cb: () => void) => void };\n}) {\n  const commander = useCommander();\n\n  // 删除命令\n  commander.registry({\n    name: \"delete\",\n    keyboard: [\"backspace\", \"delete\", \"ctrl+d\"],\n    execute: () => {\n      console.log(\"执行删除命令\");\n      const data = {\n        before: dataModel.value?.blocks || [],\n        after: focusData.value.unfocus,\n      };\n      return {\n        redo: () => {\n          console.log(\"重做删除命令\");\n          updateBlocks(data.after);\n        },\n        undo: () => {\n          console.log(\"撤回删除命令\");\n          updateBlocks(data.before);\n        },\n      };\n    },\n  });\n\n  commander.registry({\n    name: \"updateBlocks\",\n    execute: (blocks: VisualEditorBlockData[]) => {\n      console.log(\"执行删除命令\");\n      const data = {\n        before: dataModel.value?.blocks || [],\n        after: focusData.value.unfocus,\n      };\n      return {\n        redo: () => {\n          console.log(\"重做删除命令\");\n          updateBlocks(data.after);\n        },\n        undo: () => {\n          console.log(\"撤回删除命令\");\n          updateBlocks(data.before);\n        },\n      };\n    },\n  });\n\n  /**\n   * 拖拽命令\n   * - 从菜单拖拽组件到容器画布；\n   * - 在容器中拖拽组件调整位置\n   * - 拖拽调整组件的宽度和高度；\n   */\n  commander.registry({\n    name: \"drag\",\n    init() {\n      this.data = {\n        before: null as null | VisualEditorBlockData[],\n      };\n      const handler = {\n        dragstart: () => {\n          this.data.before = deepcopy(dataModel.value?.blocks || []);\n        },\n        dragend: () => {\n          commander.state.commands.drag();\n        },\n      };\n      dragstart.on(handler.dragstart);\n      dragend.on(handler.dragend);\n\n      return () => {\n        dragstart.off(handler.dragstart);\n        dragend.off(handler.dragend);\n      };\n    },\n    execute() {\n      const before = deepcopy(this.data.before);\n      const after = deepcopy(dataModel.value?.blocks || []);\n      return {\n        redo: () => {\n          updateBlocks(deepcopy(after));\n        },\n        undo: () => {\n          updateBlocks(deepcopy(before));\n        },\n      };\n    },\n  });\n\n  commander.registry({\n    name: \"clear\",\n    execute: () => {\n      const data = {\n        before: deepcopy(dataModel.value?.blocks),\n        after: deepcopy([]),\n      };\n      return {\n        redo: () => {\n          updateBlocks(deepcopy(data.after));\n        },\n        undo: () => {\n          updateBlocks(deepcopy(data.before || []));\n        },\n      };\n    },\n  });\n\n  commander.registry({\n    name: \"placeTop\",\n    keyboard: \"ctrl+up\",\n    execute: () => {\n      const data = {\n        before: deepcopy(dataModel.value?.blocks),\n        after: deepcopy(\n          (() => {\n            const { focus, unfocus } = focusData.value;\n            const maxZIndex = unfocus.reduce((prev, block) => {\n              return Math.max(prev, block.zIndex);\n            }, -Infinity);\n            focus.forEach((block) => (block.zIndex = maxZIndex + 1));\n            return deepcopy(dataModel.value?.blocks);\n          })()\n        ),\n      };\n      return {\n        redo: () => {\n          updateBlocks(deepcopy(data.after || []));\n        },\n        undo: () => {\n          updateBlocks(deepcopy(data.before || []));\n        },\n      };\n    },\n  });\n\n  commander.registry({\n    name: \"placeBottom\",\n    keyboard: \"ctrl+down\",\n    execute: () => {\n      const data = {\n        before: deepcopy(dataModel.value?.blocks),\n        after: deepcopy(\n          (() => {\n            const { focus, unfocus } = focusData.value;\n            let minZIndex = unfocus.reduce((prev, block) => {\n              return Math.min(prev, block.zIndex);\n            }, Infinity);\n\n            if (minZIndex <= 0) {\n              unfocus.forEach(\n                (block) =>\n                  (block.zIndex = 1 + block.zIndex + Math.abs(minZIndex))\n              );\n              minZIndex = 1;\n            }\n            focus.forEach((block) => (block.zIndex = minZIndex - 1));\n            return deepcopy(dataModel.value?.blocks);\n          })()\n        ),\n      };\n      return {\n        redo: () => {\n          updateBlocks(deepcopy(data.after || []));\n        },\n        undo: () => {\n          updateBlocks(deepcopy(data.before || []));\n        },\n      };\n    },\n  });\n\n  commander.registry({\n    name: \"updateBlock\",\n    execute: (newVal: VisualEditorBlockData, oldVal: VisualEditorBlockData) => {\n      let blocks = deepcopy(dataModel.value?.blocks || []);\n      let data = {\n        before: deepcopy(dataModel.value?.blocks),\n        after: (() => {\n          blocks = [...blocks];\n          const index = dataModel.value!.blocks.indexOf(oldVal);\n          if (index > -1) {\n            blocks.splice(index, 1, newVal);\n          }\n          return deepcopy(blocks);\n        })(),\n      };\n      return {\n        redo: () => {\n          updateBlocks(deepcopy(data.after || []));\n        },\n        undo: () => {\n          updateBlocks(deepcopy(data.before || []));\n        },\n      };\n    },\n  });\n\n  commander.registry({\n    name: \"updateModelValue\",\n    execute: (val: VisualEditorModelValue) => {\n      const data = {\n        before: deepcopy(dataModel.value),\n        after: deepcopy(val),\n      };\n      return {\n        redo: () => {\n          dataModel.value = data.after;\n        },\n        undo: () => {\n          dataModel.value = data.before;\n        },\n      };\n    },\n  });\n\n  commander.registry({\n    name: \"selectAll\",\n    followQueue: false,\n    keyboard: \"ctrl+a\",\n    execute: () => {\n      return {\n        redo: () => {\n          (dataModel.value?.blocks || []).forEach(\n            (block) => (block.focus = true)\n          );\n        },\n        undo: () => {\n          console.log(\"\");\n        },\n      };\n    },\n  });\n\n  commander.init();\n\n  return {\n    undo: () => commander.state.commands.undo(),\n    redo: () => commander.state.commands.redo(),\n    delete: () => commander.state.commands.delete(),\n    clear: () => commander.state.commands.clear(),\n    placeTop: () => commander.state.commands.placeTop(),\n    placeBottom: () => commander.state.commands.placeBottom(),\n    updateBlock: (\n      newVal: VisualEditorBlockData,\n      oldVal: VisualEditorBlockData\n    ) => commander.state.commands.updateBlock(newVal, oldVal),\n    updateModelValue: (val: VisualEditorModelValue) =>\n      commander.state.commands.updateModelValue(val),\n  };\n}\n","import { VisualEditorProps } from \"./visual-editor.props\";\nimport { provide, inject } from \"vue\";\nexport interface VisualEditorBlockData {\n  top: number;\n  left: number;\n  componentKey: string;\n  adjustPosition: boolean; // 是否需要调整位置\n  focus: boolean; // 是否是选中状态\n  zIndex: number; // z-index值\n  width: number;\n  height: number;\n  hasResize: boolean; // 是否调整过宽高\n  props: Record<string, any>; // 组件的设计属性\n  model: Record<string, any>; // 绑定的字段\n  slotName?: string; // 组件唯一标识\n}\n\nexport interface VisualEditorModelValue {\n  container: {\n    width: number;\n    height: number;\n  };\n  blocks: VisualEditorBlockData[];\n}\n\nexport interface VisualEditorComponent {\n  key: string;\n  label: string;\n  preview: () => JSX.Element;\n  render: (data: {\n    props: any;\n    model: any;\n    size: { width?: number; height?: number };\n    custom: Record<string, any>;\n  }) => JSX.Element;\n  props?: Record<string, VisualEditorProps>;\n  model?: Record<string, string>; // 绑定的字段\n  resize?: { width?: boolean; height?: boolean };\n}\n\nexport function createNewBlock(data: {\n  component: VisualEditorComponent;\n  top: number;\n  left: number;\n}): VisualEditorBlockData {\n  return {\n    componentKey: data.component!.key,\n    top: data.top,\n    left: data.left,\n    adjustPosition: true,\n    focus: false,\n    zIndex: 0,\n    width: 0,\n    height: 0,\n    hasResize: false,\n    props: {},\n    model: {},\n  };\n}\n\nexport function createVisualEditorConfig() {\n  const componentList: VisualEditorComponent[] = [];\n  const componentMap: Record<string, VisualEditorComponent> = {};\n\n  return {\n    componentList,\n    componentMap,\n    registry: <\n      Props extends Record<string, VisualEditorProps>,\n      Model extends Record<string, string> = {}\n    >(\n      key: string,\n      component: {\n        label: string;\n        preview: () => JSX.Element;\n        render: (data: {\n          props: { [k in keyof Props]: any };\n          model: Partial<{ [key in keyof Model]: any }>;\n          size: { width?: number; height?: number };\n          custom: Record<string, any>;\n        }) => JSX.Element;\n        props?: Props;\n        model?: Model;\n        resize?: { width?: boolean; height?: boolean };\n      }\n    ) => {\n      const comp = { ...component, key };\n      componentList.push(comp);\n      componentMap[key] = comp;\n    },\n  };\n}\n\n// 配置类型\nexport type VisualEditorConfig = ReturnType<typeof createVisualEditorConfig>;\n\nexport interface VisualEditorMarkLine {\n  x: { left: number; showLeft: number }[];\n  y: { top: number; showTop: number }[];\n}\n\nexport interface VisualDragEvent {\n  dragstart: {\n    on: (cb: () => void) => void;\n    off: (cb: () => void) => void;\n    emit: () => void;\n  };\n  dragend: {\n    on: (cb: () => void) => void;\n    off: (cb: () => void) => void;\n    emit: () => void;\n  };\n}\n\nexport const VisualDragProvider = (() => {\n  const VISUAL_DRAG_PROVIDER = \"@@VISUAL_DRAG_PROVIDER\";\n  return {\n    provide: (data: VisualDragEvent) => {\n      provide(VISUAL_DRAG_PROVIDER, data);\n    },\n    inject: () => {\n      return inject(VISUAL_DRAG_PROVIDER) as VisualDragEvent;\n    },\n  };\n})();\n","import {\n  VisualEditorBlockData,\n  VisualEditorComponent,\n  VisualEditorConfig,\n  VisualDragProvider,\n} from \"@/packages/visual-editor.utils\";\nimport { defineComponent, PropType } from \"vue\";\nimport \"./style.scss\";\n\nenum Direction {\n  start = \"start\",\n  center = \"center\",\n  end = \"end\",\n}\n\nexport const BlockResizer = defineComponent({\n  props: {\n    block: { type: Object as PropType<VisualEditorBlockData>, required: true },\n    component: {\n      type: Object as PropType<VisualEditorComponent>,\n      required: true,\n    },\n  },\n  emits: {\n    dragStart: () => true,\n    dragEnd: () => true,\n  },\n  setup(props) {\n    const { width, height } = props.component.resize || {};\n    const { dragstart, dragend } = VisualDragProvider.inject();\n\n    const onMousedown = (() => {\n      let data = {\n        startX: 0,\n        startY: 0,\n        startWidth: 0,\n        startHeight: 0,\n        startLeft: 0,\n        startTop: 0,\n        direction: {} as { horizontal: Direction; vertical: Direction },\n        dragging: false,\n      };\n\n      const mousemove = (e: MouseEvent) => {\n        const {\n          startX,\n          startY,\n          startWidth,\n          startHeight,\n          direction,\n          startLeft,\n          startTop,\n          dragging,\n        } = data;\n        if (!dragging) {\n          data.dragging = true;\n          dragstart.emit();\n        }\n\n        let { clientX: moveX, clientY: moveY } = e;\n        if (direction.horizontal === Direction.center) {\n          moveX = startX;\n        }\n        if (direction.vertical === Direction.center) {\n          moveY = startY;\n        }\n\n        let durX = moveX - startX;\n        let durY = moveY - startY;\n        const block = props.block as VisualEditorBlockData;\n\n        if (direction.vertical === Direction.start) {\n          durY = -durY;\n          block.top = startTop - durY;\n        }\n        if (direction.horizontal === Direction.start) {\n          durX = -durX;\n          block.left = startLeft - durX;\n        }\n\n        const width = startWidth + durX;\n        const height = startHeight + durY;\n\n        block.width = width;\n        block.height = height;\n        block.hasResize = true;\n      };\n\n      const mouseup = (e: MouseEvent) => {\n        console.log(e);\n        document.body.removeEventListener(\"mousemove\", mousemove);\n        document.body.removeEventListener(\"mouseup\", mouseup);\n        if (data.dragging) {\n          dragend.emit();\n        }\n      };\n\n      const mousedown = (\n        e: MouseEvent,\n        direction: { horizontal: Direction; vertical: Direction }\n      ) => {\n        e.stopPropagation();\n        document.body.addEventListener(\"mousemove\", mousemove);\n        document.body.addEventListener(\"mouseup\", mouseup);\n        data = {\n          startX: e.clientX,\n          startY: e.clientY,\n          direction,\n          startWidth: props.block.width,\n          startHeight: props.block.height,\n          startLeft: props.block.left,\n          startTop: props.block.top,\n          dragging: false,\n        };\n      };\n\n      return mousedown;\n    })();\n\n    return () => (\n      <>\n        {height && (\n          <>\n            <div\n              class=\"block-resize block-resize-top\"\n              onMousedown={(e) =>\n                onMousedown(e, {\n                  horizontal: Direction.center,\n                  vertical: Direction.start,\n                })\n              }\n            ></div>\n            <div\n              class=\"block-resize block-resize-bottom\"\n              onMousedown={(e) =>\n                onMousedown(e, {\n                  horizontal: Direction.center,\n                  vertical: Direction.end,\n                })\n              }\n            ></div>\n          </>\n        )}\n\n        {width && (\n          <>\n            <div\n              class=\"block-resize block-resize-left\"\n              onMousedown={(e) =>\n                onMousedown(e, {\n                  horizontal: Direction.start,\n                  vertical: Direction.center,\n                })\n              }\n            ></div>\n            <div\n              class=\"block-resize block-resize-right\"\n              onMousedown={(e) =>\n                onMousedown(e, {\n                  horizontal: Direction.end,\n                  vertical: Direction.center,\n                })\n              }\n            ></div>\n          </>\n        )}\n\n        {width && height && (\n          <>\n            <div\n              class=\"block-resize block-resize-top-left\"\n              onMousedown={(e) =>\n                onMousedown(e, {\n                  horizontal: Direction.start,\n                  vertical: Direction.start,\n                })\n              }\n            ></div>\n            <div\n              class=\"block-resize block-resize-top-right\"\n              onMousedown={(e) =>\n                onMousedown(e, {\n                  horizontal: Direction.end,\n                  vertical: Direction.start,\n                })\n              }\n            ></div>\n\n            <div\n              class=\"block-resize block-resize-bottom-left\"\n              onMousedown={(e) =>\n                onMousedown(e, {\n                  horizontal: Direction.start,\n                  vertical: Direction.end,\n                })\n              }\n            ></div>\n            <div\n              class=\"block-resize block-resize-bottom-right\"\n              onMousedown={(e) =>\n                onMousedown(e, {\n                  horizontal: Direction.end,\n                  vertical: Direction.end,\n                })\n              }\n            ></div>\n          </>\n        )}\n      </>\n    );\n  },\n});\n","export enum VisualEditorPropsType {\n  input = \"input\",\n  color = \"color\",\n  select = \"select\",\n  table = \"table\",\n}\n\nexport interface VisualEditorProps {\n  type: VisualEditorPropsType;\n  label: string;\n  options?: VisualEditorSelectOptions;\n  table?: VisualEditorTableOptions;\n}\n\n/** ------input------- */\n\nexport function createEditorInputProps(label: string): VisualEditorProps {\n  return {\n    type: VisualEditorPropsType.input,\n    label,\n  };\n}\n\n/** ------color------- */\n\nexport function createEditorColorProps(label: string): VisualEditorProps {\n  return {\n    type: VisualEditorPropsType.color,\n    label,\n  };\n}\n\n/** ------select------- */\n\nexport type VisualEditorSelectOptions = {\n  label: string;\n  val: string;\n}[];\n\nexport function createEditorSelectProps(\n  label: string,\n  options: VisualEditorSelectOptions\n): VisualEditorProps {\n  return {\n    type: VisualEditorPropsType.select,\n    label,\n    options,\n  };\n}\n\n/** ------table------- */\n\nexport type VisualEditorTableOptions = {\n  options: {\n    label: string;\n    field: string; // 列绑定字段\n  }[];\n  showKey: string;\n};\n\nexport function createEditorTableProp(\n  label: string,\n  options: VisualEditorTableOptions\n) {\n  return {\n    type: VisualEditorPropsType.table,\n    label,\n    table: options,\n  };\n}\n","import { computed, defineComponent, onMounted, PropType, ref, Slot } from \"vue\";\nimport { BlockResizer } from \"./components/block-resizer\";\nimport {\n  VisualEditorBlockData,\n  VisualEditorConfig,\n} from \"./visual-editor.utils\";\n\nexport const VisualEditorBlock = defineComponent({\n  props: {\n    block: {\n      type: Object as PropType<VisualEditorBlockData>,\n    },\n    config: {\n      type: Object as PropType<VisualEditorConfig>,\n    },\n    formData: { type: Object as PropType<Record<string, any>>, required: true },\n    slots: {\n      type: Object as PropType<Record<string, Slot | undefined>>,\n      required: true,\n    },\n    customProps: { type: Object as PropType<Record<string, any>> },\n  },\n  setup(props) {\n    const el = ref({} as HTMLDivElement);\n    const styles = computed(() => ({\n      top: `${props.block?.top}px`,\n      left: `${props.block?.left}px`,\n      zIndex: props.block?.zIndex,\n    }));\n\n    const classes = computed(() => [\n      \"visual-editor-block\",\n      {\n        \"visual-editor-block-focus\": props.block?.focus,\n      },\n    ]);\n\n    onMounted(() => {\n      // 放置block时，让组件居中，对准鼠标点\n      const block = props.block;\n      if (block?.adjustPosition) {\n        const { offsetWidth, offsetHeight } = el.value;\n        block.left -= offsetWidth / 2;\n        block.top -= offsetHeight / 2;\n        block.height = offsetHeight;\n        block.width = offsetWidth;\n        block.adjustPosition = false;\n      }\n    });\n\n    return () => {\n      const component = props.config?.componentMap[props.block!.componentKey];\n      const formData = props.formData as Record<string, any>;\n      let render: any;\n\n      if (props.block?.slotName && props.slots[props.block.slotName]) {\n        render = props.slots[props.block.slotName]!();\n      } else {\n        render = component?.render({\n          size: props.block?.hasResize\n            ? {\n                width: props.block.width,\n                height: props.block.height,\n              }\n            : {},\n          props: props.block?.props || {},\n          /**@ts-ignore */\n          model: Object.keys(component.model || {}).reduce((prev, propName) => {\n            const modelName = !props.block?.model\n              ? null\n              : props.block?.model[propName];\n            prev[propName] = {\n              [propName === \"default\" ? \"modelValue\" : propName]: props\n                .formData[modelName],\n              [propName === \"default\" ? \"onUpdate:modelValue\" : \"onChange\"]: (\n                val: any\n              ) => (formData[modelName] = val),\n            };\n            return prev;\n          }, {} as Record<string, any>),\n          custom:\n            !props.block?.slotName || !props.customProps\n              ? {}\n              : props.customProps[props.block?.slotName] || {},\n        });\n      }\n\n      const { width, height } = component?.resize || {};\n      return (\n        <div class={classes.value} style={styles.value} ref={el}>\n          {render}\n          {props.block?.focus && (width || height) && (\n            <BlockResizer\n              block={props.block!}\n              component={component!}\n            ></BlockResizer>\n          )}\n        </div>\n      );\n    };\n  },\n});\n","import {\n  computed,\n  createApp,\n  defineComponent,\n  getCurrentInstance,\n  inject,\n  onBeforeUnmount,\n  onMounted,\n  PropType,\n  provide,\n  reactive,\n  ref,\n} from \"vue\";\nimport { defer } from \"./defer\";\nimport \"./dropdown-service.scss\";\n\ninterface DropdownServiceOption {\n  reference: MouseEvent | HTMLElement;\n  content: () => JSX.Element;\n}\n\nconst DropdownServiceProvider = (() => {\n  const DROPDOWN_SERVICE_PROVIDER = \"@@DROPDOWN_SERVICE_PROVIDER\";\n  return {\n    provide: (handler: { onClick: () => void }) => {\n      provide(DROPDOWN_SERVICE_PROVIDER, handler);\n    },\n    inject: () => {\n      return inject(DROPDOWN_SERVICE_PROVIDER) as { onClick: () => void };\n    },\n  };\n})();\n\nconst SerivceComponent = defineComponent({\n  props: { option: { type: Object as PropType<DropdownServiceOption> } },\n\n  setup(props) {\n    const ctx = getCurrentInstance()!;\n    const el = ref({} as HTMLDivElement);\n\n    const state = reactive({\n      option: props.option,\n      showFlag: false,\n      top: 0,\n      left: 0,\n      mounted: (() => {\n        const dfd = defer();\n        onMounted(dfd.resolve);\n        return dfd.promise;\n      })(),\n    });\n\n    const methods = {\n      show: async () => {\n        await state.mounted;\n        state.showFlag = true;\n      },\n      hide: async () => {\n        state.showFlag = false;\n      },\n    };\n\n    const service = (option: DropdownServiceOption) => {\n      state.option = option;\n      state.showFlag = true;\n      if (\"addEventListener\" in option.reference) {\n        console.log(option.reference);\n        const { top, left, height } = option.reference.getBoundingClientRect();\n        state.top = top + height;\n        state.left = left;\n      } else {\n        const { clientX, clientY } = option.reference;\n        state.left = clientX;\n        state.top = clientY;\n      }\n      methods.show();\n    };\n\n    const classes = computed(() => [\n      \"dropdown-service\",\n      {\n        \"dropdown-service-show\": state.showFlag,\n      },\n    ]);\n    const style = computed(() => ({\n      top: `${state.top}px`,\n      left: `${state.left}px`,\n    }));\n\n    Object.assign(ctx.proxy, { service });\n\n    const onMousedownDocument = (e: MouseEvent) => {\n      if (!el.value.contains(e.target as HTMLElement)) {\n        methods.hide();\n      }\n    };\n    onMounted(() =>\n      document.body.addEventListener(\"mousedown\", onMousedownDocument, true)\n    );\n\n    onBeforeUnmount(() =>\n      document.body.removeEventListener(\"mousedown\", onMousedownDocument, true)\n    );\n\n    DropdownServiceProvider.provide({ onClick: methods.hide });\n\n    return () => (\n      <div class={classes.value} style={style.value} ref={el}>\n        {state.option?.content()}\n      </div>\n    );\n  },\n});\n\nexport const DropdownOption = defineComponent({\n  props: {\n    label: { type: String },\n    icon: { type: String },\n  },\n  emits: {\n    click: (e: MouseEvent) => true,\n  },\n  setup(props, ctx) {\n    const { onClick: dropdownClickHandler } = DropdownServiceProvider.inject();\n    const handler = {\n      onClick: (e: MouseEvent) => {\n        ctx.emit(\"click\", e);\n        dropdownClickHandler();\n      },\n    };\n    return () => (\n      <div class=\"dropdown-option\" onClick={handler.onClick}>\n        <i class={`iconfont ${props.icon}`}></i>\n        <span>{props.label}</span>\n      </div>\n    );\n  },\n});\n\nexport const $$dropdown = (() => {\n  let ins: any;\n  return (option: DropdownServiceOption) => {\n    if (!ins) {\n      const el = document.createElement(\"div\");\n      document.body.appendChild(el);\n      const app = createApp(SerivceComponent, { option });\n      ins = app.mount(el);\n    }\n    ins.service(option);\n  };\n})();\n","import { defer } from \"@/packages/utils/defer\";\nimport { VisualEditorProps } from \"@/packages/visual-editor.props\";\nimport deepcopy from \"deepcopy\";\nimport {\n  ElButton,\n  ElDialog,\n  ElTableColumn,\n  ElTable,\n  ElInput,\n} from \"element-plus\";\nimport {\n  createApp,\n  defineComponent,\n  getCurrentInstance,\n  onMounted,\n  PropType,\n  reactive,\n} from \"vue\";\n\nconst [Dialog, Table, TableColumn, Button]: any[] = [\n  ElDialog,\n  ElTable,\n  ElTableColumn,\n  ElButton,\n];\n\nexport interface TablePropEditorServiceOption {\n  data: any[];\n  config: VisualEditorProps;\n  onConfirm: (data: any) => void;\n}\n\nconst ServiceComponent = defineComponent({\n  props: {\n    option: {\n      type: Object as PropType<TablePropEditorServiceOption>,\n      required: true,\n    },\n  },\n\n  setup(props) {\n    const ctx = getCurrentInstance()!;\n    const state = reactive({\n      option: props.option,\n      showFlag: false,\n      mounted: (() => {\n        const dfd = defer();\n        onMounted(dfd.resolve);\n        return dfd.promise;\n      })(),\n      editorData: [] as any[],\n    });\n\n    const methods = {\n      service: (option: TablePropEditorServiceOption) => {\n        state.option = option;\n        state.editorData = deepcopy(option.data || []);\n        methods.show();\n      },\n      show: async () => {\n        await state.mounted;\n        state.showFlag = true;\n      },\n      hide: async () => {\n        state.showFlag = false;\n      },\n      add: () => {\n        state.editorData.push({});\n      },\n      reset: () => {\n        state.editorData = deepcopy(state.option.data);\n      },\n    };\n\n    const handler = {\n      onConfirm: () => {\n        state.option.onConfirm(state.editorData);\n        methods.hide();\n      },\n      onCancel: () => {\n        methods.hide();\n      },\n      onDelete: (index: number) => {\n        state.editorData.splice(index, 1);\n      },\n    };\n\n    Object.assign(ctx.proxy!, methods);\n\n    return () => (\n      <Dialog v-model={state.showFlag}>\n        {{\n          default: () => (\n            <div>\n              <div>\n                <Button onClick={methods.add}>添加</Button>\n                <Button onClick={methods.reset}>重置</Button>\n              </div>\n              <Table data={state.editorData}>\n                <TableColumn type=\"index\" />\n                {state.option.config.table?.options.map((item, index) => (\n                  <TableColumn label={item.label}>\n                    {{\n                      default: ({ row }: { row: any }) => (\n                        <ElInput v-model={row[item.field]} />\n                      ),\n                    }}\n                  </TableColumn>\n                ))}\n                <TableColumn label=\"操作栏\">\n                  {{\n                    default: ({ $index }: any) => (\n                      <Button\n                        type=\"danger\"\n                        onClick={() => handler.onDelete($index)}\n                      >\n                        删除\n                      </Button>\n                    ),\n                  }}\n                </TableColumn>\n              </Table>\n            </div>\n          ),\n          footer: () => (\n            <>\n              <Button onClick={handler.onCancel}> 取消</Button>\n              <Button onClick={handler.onConfirm} type=\"primary\">\n                确定\n              </Button>\n            </>\n          ),\n        }}\n      </Dialog>\n    );\n  },\n});\n\nexport const $$tablePropEditor = (() => {\n  let ins: any;\n  return (option: Omit<TablePropEditorServiceOption, \"onConfirm\">) => {\n    if (!ins) {\n      const el = document.createElement(\"div\");\n      document.body.appendChild(el);\n      const app = createApp(ServiceComponent, { option });\n      ins = app.mount(el);\n    }\n    const dfd = defer<any[]>();\n    ins.service({\n      ...option,\n      onConfirm: dfd.resolve,\n    });\n\n    return dfd.promise;\n  };\n})();\n","import { useModel } from \"@/packages/utils/useModel\";\nimport { VisualEditorProps } from \"@/packages/visual-editor.props\";\nimport { defineComponent, PropType } from \"vue\";\nimport { ElButton, ElTag as Tag } from \"element-plus\";\nimport \"./style.scss\";\nimport { $$tablePropEditor } from \"./service\";\n\nconst [Button, ElTag]: any[] = [ElButton, Tag];\n\nexport const TablePropEditor = defineComponent({\n  props: {\n    modelValue: { type: Array as PropType<any[]> },\n    propConfig: { type: Object as PropType<VisualEditorProps>, required: true },\n  },\n  emits: {\n    \"update:modelValue\": (val?: any[]) => true,\n  },\n  setup(props, ctx) {\n    const model = useModel(\n      () => props.modelValue,\n      (val) => ctx.emit(\"update:modelValue\", val)\n    );\n\n    const onClick = async () => {\n      const data = await $$tablePropEditor({\n        config: props.propConfig,\n        data: props.modelValue || [],\n      });\n      console.log(data);\n      model.value = data;\n      // 可以直接应用\n    };\n\n    return () => (\n      <div>\n        {(!model.value || model.value.length === 0) && (\n          <Button onClick={onClick} type=\"primary\">\n            添加\n          </Button>\n        )}\n        {(model.value || []).map((item) => (\n          <ElTag onClick={onClick}>\n            {item[props.propConfig.table?.showKey || \"\"]}\n          </ElTag>\n        ))}\n      </div>\n    );\n  },\n});\n","import deepcopy from \"deepcopy\";\nimport {\n  ElButton,\n  ElColorPicker,\n  ElForm,\n  ElFormItem,\n  ElInput,\n  ElInputNumber,\n  ElOption,\n  ElSelect,\n} from \"element-plus\";\nimport { defineComponent, PropType, reactive, watch } from \"vue\";\nimport { TablePropEditor } from \"./components/table-prop-editor\";\nimport {\n  VisualEditorProps,\n  VisualEditorPropsType,\n} from \"./visual-editor.props\";\nimport {\n  VisualEditorBlockData,\n  VisualEditorConfig,\n  VisualEditorModelValue,\n} from \"./visual-editor.utils\";\n\nexport const VisualOperatorEditor = defineComponent({\n  props: {\n    block: { type: Object as PropType<VisualEditorBlockData> },\n    config: { type: Object as PropType<VisualEditorConfig> },\n    dataModel: {\n      type: Object as PropType<VisualEditorModelValue>,\n      required: true,\n    },\n    updateBlock: {\n      type: Function as PropType<\n        (\n          newBlock: VisualEditorBlockData,\n          oldBlock: VisualEditorBlockData\n        ) => void\n      >,\n      required: true,\n    },\n    updateModelValue: {\n      type: Function as PropType<(...args: any[]) => void>,\n      required: true,\n    },\n  },\n\n  setup(props) {\n    const state = reactive({\n      editData: {} as any,\n    });\n\n    const methods = {\n      apply: () => {\n        if (!props.block) {\n          // 当前编辑容器属性\n          props.updateModelValue({\n            ...(props.dataModel as any).value,\n            container: state.editData,\n          });\n        } else {\n          // 当前编辑block数据属性\n          const newBlock = state.editData;\n          props.updateBlock(newBlock, props.block);\n        }\n      },\n      reset: () => {\n        if (!props.block) {\n          state.editData = deepcopy((props.dataModel as any).value.container);\n        } else {\n          state.editData = deepcopy(props.block);\n        }\n      },\n    };\n\n    watch(\n      () => props.block,\n      () => {\n        methods.reset();\n      },\n      {\n        immediate: true,\n      }\n    );\n\n    const renderEditor = (propName: string, propConfig: VisualEditorProps) => {\n      return {\n        [VisualEditorPropsType.input]: () => (\n          <ElInput v-model={state.editData.props[propName]} />\n        ),\n        [VisualEditorPropsType.color]: () => (\n          <ElColorPicker v-model={state.editData.props[propName]} />\n        ),\n        [VisualEditorPropsType.select]: () => (\n          <ElSelect\n            placeholder=\"请选择\"\n            v-model={state.editData.props[propName]}\n          >\n            {(() => {\n              return propConfig.options!.map((opt, i) => (\n                <ElOption key={i} label={opt.label} value={opt.val} />\n              ));\n            })()}\n          </ElSelect>\n        ),\n        [VisualEditorPropsType.table]: () => (\n          <TablePropEditor\n            v-model={state.editData.props[propName]}\n            propConfig={propConfig}\n          />\n        ),\n      }[propConfig.type]();\n    };\n\n    return () => {\n      let content: JSX.Element[] = [];\n      if (!props.block) {\n        content.push(\n          <>\n            <ElFormItem label=\"容器宽度\">\n              <ElInputNumber\n                v-model={state.editData.width}\n                {...{ step: 100 }}\n              />\n            </ElFormItem>\n            <ElFormItem label=\"容器高度\">\n              <ElInputNumber\n                v-model={state.editData.height}\n                {...{ step: 100 }}\n              />\n            </ElFormItem>\n          </>\n        );\n      } else {\n        const { componentKey } = props.block;\n        const component = props.config?.componentMap[componentKey];\n\n        if (component) {\n          content.push(\n            <ElFormItem label=\"组件标识\">\n              <ElInput v-model={state.editData.slotName} />\n            </ElFormItem>\n          );\n          if (component.props) {\n            content.push(\n              <>\n                {Object.entries(component.props).map(\n                  ([propName, propConfig]) => (\n                    <ElFormItem\n                      {...{ labelPosition: \"top\" }}\n                      label={propConfig.label}\n                      key={propName}\n                    >\n                      {renderEditor(propName, propConfig)}\n                    </ElFormItem>\n                  )\n                )}\n              </>\n            );\n          }\n          if (component.model) {\n            content.push(\n              <>\n                {Object.entries(component.model).map(\n                  ([modelName, label], i) => (\n                    <ElFormItem\n                      {...{ labelPosition: \"top\" }}\n                      label={label}\n                      key={i}\n                    >\n                      <ElInput v-model={state.editData.model[modelName]} />\n                    </ElFormItem>\n                  )\n                )}\n              </>\n            );\n          }\n        }\n      }\n      return (\n        <div class=\"operator\">\n          <ElForm>\n            {content.map((el) => el)}\n            <ElFormItem>\n              <ElButton type=\"primary\" {...({ onClick: methods.apply } as any)}>\n                应用\n              </ElButton>\n              <ElButton {...({ onClick: methods.reset } as any)}>重置</ElButton>\n            </ElFormItem>\n          </ElForm>\n        </div>\n      );\n    };\n  },\n});\n","import { computed, defineComponent, PropType, reactive, ref } from \"vue\";\nimport { createEvent } from \"./plugins/event\";\nimport { $$dialog } from \"./utils/dialog-service\";\nimport { useModel } from \"./utils/useModel\";\nimport { useVisualCommand } from \"./utils/visual.command\";\nimport { VisualEditorBlock } from \"./visual-editor-block\";\nimport { ElMessageBox } from \"element-plus\";\nimport \"./visual-editor.scss\";\nimport {\n  createNewBlock,\n  VisualEditorBlockData,\n  VisualEditorComponent,\n  VisualEditorConfig,\n  VisualEditorModelValue,\n  VisualEditorMarkLine,\n  VisualDragEvent,\n  VisualDragProvider,\n} from \"./visual-editor.utils\";\nimport {\n  $$dropdown,\n  DropdownOption as DPOption,\n} from \"./utils/dropdown-service\";\nimport { VisualOperatorEditor } from \"./visual-editor-operator\";\n\nconst DropdownOption = DPOption as any;\n\nexport const VisualEditor = defineComponent({\n  props: {\n    modelValue: {\n      type: Object as PropType<VisualEditorModelValue>,\n      require: true,\n    },\n    config: {\n      type: Object as PropType<VisualEditorConfig>,\n      require: true,\n    },\n    formData: { type: Object as PropType<Record<string, any>>, required: true },\n    // 自定义事件\n    customProps: { type: Object as PropType<Record<string, any>> },\n  },\n  emits: {\n    \"update:modelValue\": (val?: VisualEditorModelValue) => true,\n  },\n  setup(props, ctx) {\n    // 双向数据绑定\n    const dataModel = useModel(\n      () => props.modelValue,\n      (val) => ctx.emit(\"update:modelValue\", val)\n    );\n    // container样式\n    const containerStyles = computed(() => ({\n      width: `${props.modelValue?.container.width}px`,\n      height: `${props.modelValue?.container.height}px`,\n    }));\n    // container dom引用\n    const containerRef = ref({} as HTMLElement);\n\n    // 计算选中与未选中的block数据\n    const focusData = computed(() => {\n      const focus: VisualEditorBlockData[] =\n        dataModel.value?.blocks.filter((v) => v.focus) || [];\n      const unfocus: VisualEditorBlockData[] =\n        dataModel.value?.blocks.filter((v) => !v.focus) || [];\n      return {\n        focus, // 此时选中的数据\n        unfocus, // 此时未选中的数据\n      };\n    });\n\n    const selectIndex = ref(-1);\n    const state = reactive({\n      // selectBlock: undefined as undefined | VisualEditorBlockData, // 当前选中的block\n      selectBlock: computed(\n        () => (dataModel.value?.blocks || [])[selectIndex.value]\n      ),\n      preview: false,\n      editing: true,\n    });\n\n    let commander: ReturnType<typeof useVisualCommand>;\n\n    const classes = computed(() => [\n      \"visual-editor\",\n      {\n        editing: !state.preview,\n      },\n    ]);\n\n    const dragstart = createEvent();\n    const dragend = createEvent();\n\n    VisualDragProvider.provide({ dragstart, dragend });\n\n    // 对外暴露的一些方法\n    const methods = {\n      clearFocus: (block?: VisualEditorBlockData) => {\n        let blocks = dataModel.value?.blocks || [];\n        if (blocks.length === 0) return;\n\n        if (block) {\n          blocks = blocks.filter((v) => v !== block);\n        }\n        blocks.forEach((block) => (block.focus = false));\n      },\n      updateBlocks: (blocks: VisualEditorBlockData[]) => {\n        dataModel.value!.blocks = blocks;\n      },\n\n      importBlockData: async (block: VisualEditorBlockData) => {\n        const text = await $$dialog.textarea(\"\", {\n          title: \"请输入节点Json字符串\",\n        });\n        try {\n          const data = JSON.parse(text || \"\");\n          if (typeof data !== \"object\") {\n            throw new Error();\n          }\n          commander.updateBlock(data, block);\n        } catch (error) {\n          ElMessageBox.alert(\"解析json字符串出错\");\n        }\n      },\n      showBlockData: (block: VisualEditorBlockData) => {\n        $$dialog.textarea(JSON.stringify(block), { title: \"节点数据\" });\n      },\n      openEdit: () => {\n        state.editing = true;\n      },\n    };\n\n    // 处理菜单拖拽进容器\n    const menuDragger = (() => {\n      let component = null as null | VisualEditorComponent;\n\n      const containerHandler = {\n        /**\n         * 拖拽组件进入容器，设置鼠标可放置状态\n         */\n        dragenter: (e: DragEvent) => {\n          e.dataTransfer!.dropEffect = \"move\";\n        },\n        dragover: (e: DragEvent) => {\n          e.preventDefault();\n        },\n        /**\n         * 拖拽组件离开容器，设置鼠标禁用状态\n         */\n        dragleave: (e: DragEvent) => {\n          e.dataTransfer!.dropEffect = \"none\";\n        },\n        /**\n         * 在容器中放置组件\n         */\n        drop: (e: DragEvent) => {\n          console.log(\"drop\", component);\n          const blocks = dataModel.value?.blocks || [];\n          blocks.push(\n            createNewBlock({\n              component: component!,\n              top: e.offsetY,\n              left: e.offsetX,\n            })\n          );\n          console.log(\"x\", e.offsetX);\n          console.log(\"y\", e.offsetY);\n          dataModel.value = {\n            ...dataModel.value,\n            blocks,\n          } as VisualEditorModelValue;\n          dragend.emit();\n        },\n      };\n\n      const blockHandler = {\n        dragstart: (e: DragEvent, current: VisualEditorComponent) => {\n          containerRef.value.addEventListener(\n            \"dragenter\",\n            containerHandler.dragenter\n          );\n          containerRef.value.addEventListener(\n            \"dragover\",\n            containerHandler.dragover\n          );\n          containerRef.value.addEventListener(\n            \"dragleave\",\n            containerHandler.dragleave\n          );\n          containerRef.value.addEventListener(\"drop\", containerHandler.drop);\n          component = current;\n          dragstart.emit();\n        },\n        dragend: (e: DragEvent) => {\n          containerRef.value.removeEventListener(\n            \"dragenter\",\n            containerHandler.dragenter\n          );\n          containerRef.value.removeEventListener(\n            \"dragover\",\n            containerHandler.dragover\n          );\n          containerRef.value.removeEventListener(\n            \"dragleave\",\n            containerHandler.dragleave\n          );\n          containerRef.value.removeEventListener(\"drop\", containerHandler.drop);\n          component = null;\n        },\n      };\n\n      return blockHandler;\n    })();\n\n    // 处理组件在画布上他拖拽\n    const blockDragger = (() => {\n      const mark = reactive({\n        x: null as null | number,\n        y: null as null | number,\n      });\n      let dragState = {\n        startX: 0,\n        startY: 0,\n        startLeft: 0,\n        startTop: 0,\n        startPos: [] as { left: number; top: number }[],\n        dragging: false,\n        markLines: {} as VisualEditorMarkLine,\n      };\n\n      const mousemove = (e: MouseEvent) => {\n        if (!dragState.dragging) {\n          dragState.dragging = true;\n          dragstart.emit();\n        }\n\n        let { clientX: moveX, clientY: moveY } = e;\n\n        const { startX, startY } = dragState;\n\n        // 水平、垂直移动\n        if (e.shiftKey) {\n          if (Math.abs(e.clientX - startX) > Math.abs(e.clientY - startY)) {\n            moveY = startY;\n          } else {\n            moveX = startX;\n          }\n        }\n\n        const currentLeft = dragState.startLeft + moveX - startX;\n        const currentTop = dragState.startTop + moveY - startY;\n        const currentMark = {\n          x: null as null | number,\n          y: null as null | number,\n        };\n\n        for (let i = 0; i < dragState.markLines.y.length; i++) {\n          const { top, showTop } = dragState.markLines.y[i];\n          if (Math.abs(top - currentTop) < 5) {\n            moveY = top + startY - dragState.startTop;\n            currentMark.y = showTop;\n            break;\n          }\n        }\n\n        for (let i = 0; i < dragState.markLines.x.length; i++) {\n          const { left, showLeft } = dragState.markLines.x[i];\n          if (Math.abs(left - currentLeft) < 5) {\n            moveX = left + startX - dragState.startLeft;\n            currentMark.x = showLeft;\n            break;\n          }\n        }\n\n        const durY = moveY - startY;\n        const durX = moveX - startX;\n        focusData.value.focus.forEach((block, i) => {\n          block.top = dragState.startPos[i].top + durY;\n          block.left = dragState.startPos[i].left + durX;\n        });\n\n        mark.x = currentMark.x;\n        mark.y = currentMark.y;\n      };\n      const mouseup = (e: MouseEvent) => {\n        document.removeEventListener(\"mousemove\", mousemove);\n        document.removeEventListener(\"mouseup\", mouseup);\n        mark.x = null;\n        mark.y = null;\n        if (dragState.dragging) {\n          dragend.emit();\n        }\n      };\n\n      const mousedown = (e: MouseEvent) => {\n        dragState = {\n          startX: e.clientX,\n          startY: e.clientY,\n          startTop: state.selectBlock!.top,\n          startLeft: state.selectBlock!.left,\n          startPos: focusData.value.focus.map(({ top, left }) => ({\n            top,\n            left,\n          })),\n          dragging: false,\n          markLines: (() => {\n            const { focus, unfocus } = focusData.value;\n            // 当前选中的block\n            const { top, left, width, height } = state.selectBlock!;\n            const lines = { x: [], y: [] } as VisualEditorMarkLine;\n            [\n              ...unfocus,\n              {\n                top: 0,\n                left: 0,\n                width: dataModel.value!.container.width,\n                height: dataModel.value!.container.height,\n              },\n            ].forEach((block) => {\n              const { top: t, left: l, width: w, height: h } = block;\n              // y轴对齐方式\n              lines.y.push({ top: t, showTop: t }); // 顶对顶\n              lines.y.push({ top: t + h, showTop: t + h }); // 底对底\n              lines.y.push({ top: t + h / 2 - height / 2, showTop: t + h / 2 }); // 中对中\n              lines.y.push({ top: t - height, showTop: t }); // 顶对底\n              lines.y.push({ top: t + h - height, showTop: t + h }); //\n\n              // x轴对齐方式\n\n              lines.x.push({ left: l, showLeft: l }); // 顶对顶\n              lines.x.push({ left: l + w, showLeft: l + w }); // 底对底\n              lines.x.push({\n                left: l + w / 2 - width / 2,\n                showLeft: l + w / 2,\n              }); // 中对中\n              lines.x.push({ left: l - width, showLeft: l }); // 顶对底\n              lines.x.push({ left: l + w - width, showLeft: l + w }); // 中对中\n            });\n\n            return lines;\n          })(),\n        };\n        document.addEventListener(\"mousemove\", mousemove);\n        document.addEventListener(\"mouseup\", mouseup);\n      };\n\n      return { mousedown, mark };\n    })();\n\n    // 其他事件\n    const handler = {\n      onContextmenuBlock: (e: MouseEvent, block: VisualEditorBlockData) => {\n        if (state.preview) return;\n        e.preventDefault();\n        e.stopPropagation();\n\n        $$dropdown({\n          reference: e,\n          content: () => (\n            <>\n              <DropdownOption\n                label=\"置顶节点\"\n                icon=\"icon-place-top\"\n                onClick={commander.placeTop}\n              />\n              <DropdownOption\n                label=\"置底节点\"\n                icon=\"icon-place-bottom\"\n                onClick={commander.placeBottom}\n              />\n              <DropdownOption\n                label=\"删除节点\"\n                icon=\"icon-delete\"\n                onClick={commander.delete}\n              />\n              <DropdownOption\n                label=\"查看数据\"\n                icon=\"icon-browse\"\n                onClick={() => methods.showBlockData(block)}\n              />\n              <DropdownOption\n                label=\"导入节点\"\n                icon=\"icon-import\"\n                onClick={() => methods.importBlockData(block)}\n              />\n            </>\n          ),\n        });\n      },\n    };\n\n    // 处理组件的选中状态\n    const focusHandler = (() => {\n      return {\n        container: {\n          onMousedown: (e: MouseEvent) => {\n            state.editing && e.preventDefault();\n            if (e.currentTarget !== e.target) {\n              return;\n            }\n\n            methods.clearFocus();\n            // state.selectBlock = undefined;\n            selectIndex.value = -1;\n          },\n        },\n        block: {\n          onMousedown: (\n            e: MouseEvent,\n            block: VisualEditorBlockData,\n            index: number\n          ) => {\n            if (state.preview) return;\n\n            e && e.preventDefault();\n            // 只有元素未选中状态下， 才去处理\n            if (!block.focus) {\n              if (!e.shiftKey) {\n                block.focus = !block.focus;\n                methods.clearFocus(block);\n              } else {\n                block.focus = true;\n              }\n            }\n            // state.selectBlock = block;\n            selectIndex.value = index;\n            // 处理组件的选中移动\n            blockDragger.mousedown(e);\n          },\n        },\n      };\n    })();\n    commander = useVisualCommand({\n      focusData: focusData,\n      updateBlocks: methods.updateBlocks,\n      dataModel,\n      dragstart,\n      dragend,\n    });\n\n    const handleImport = async () => {\n      console.log(\"handleImport\");\n      const text = await $$dialog.textarea(\"\", {\n        title: \"请输入要导入的Json字符串\",\n      });\n      console.log(\"text\", text);\n      try {\n        const data = JSON.parse(text || \"\");\n        if (typeof data !== \"object\") {\n          throw new Error();\n        }\n        dataModel.value = data;\n      } catch (error) {\n        ElMessageBox.alert(\"解析json字符串出错\");\n      }\n    };\n\n    const handleExport = async () => {\n      console.log(\"handleImport\");\n      const text = await $$dialog.textarea(JSON.stringify(dataModel.value), {\n        title: \"导出内容\",\n      });\n      console.log(\"text\", text);\n    };\n\n    const buttons = [\n      {\n        label: \"撤销\",\n        icon: \"icon-back\",\n        handler: commander.undo,\n        tip: \"ctrl+z\",\n      },\n      {\n        label: \"重做\",\n        icon: \"icon-forward\",\n        handler: commander.redo,\n        tip: \"ctrl+y, ctrl+shift+z\",\n      },\n      {\n        label: () => (state.preview ? \"编辑\" : \"预览\"),\n        icon: () => (state.preview ? \"icon-edit\" : \"icon-browse\"),\n        handler: () => {\n          state.preview = !state.preview;\n          if (state.preview) {\n            methods.clearFocus();\n          }\n        },\n      },\n      {\n        label: \"导入\",\n        icon: \"icon-import\",\n        handler: handleImport,\n      },\n\n      {\n        label: \"导出\",\n        icon: \"icon-export\",\n        handler: handleExport,\n      },\n      {\n        label: \"置顶\",\n        icon: \"icon-place-top\",\n        handler: () => commander.placeTop(),\n      },\n      {\n        label: \"置低\",\n        icon: \"icon-place-bottom\",\n        handler: () => commander.placeBottom(),\n      },\n\n      {\n        label: \"删除\",\n        icon: \"icon-delete\",\n        handler: () => commander.delete(),\n        tip: \"ctrl+d, backspance, delete,\",\n      },\n      {\n        label: \"清空\",\n        icon: \"icon-reset\",\n        handler: () => commander.clear(),\n      },\n      {\n        label: \"关闭\",\n        icon: \"icon-close\",\n        handler: () => {\n          methods.clearFocus();\n          state.editing = false;\n        },\n      },\n    ];\n\n    const excuteFun = (fn: any) => {\n      return typeof fn === \"function\" ? fn() : fn;\n    };\n\n    return () => {\n      console.log(\"selectBlock\", state.selectBlock);\n      return (\n        <>\n          <div\n            class=\"visual-editor-container\"\n            style={containerStyles.value}\n            v-show={!state.editing}\n          >\n            {(dataModel.value?.blocks || []).map((block, index: number) => (\n              <VisualEditorBlock\n                block={block}\n                key={index}\n                config={props.config}\n                formData={props.formData}\n                slots={ctx.slots}\n                customProps={props.customProps}\n              />\n            ))}\n            <div class=\"container-edit-button\" onClick={methods.openEdit}>\n              <i class=\"iconfont icon-edit\"></i>\n              <span>编辑组件</span>\n            </div>\n          </div>\n\n          <div class={classes.value} v-show={state.editing}>\n            <div class=\"menu\">\n              {props.config?.componentList.map((component) => (\n                <div\n                  class=\"menu-item\"\n                  draggable\n                  onDragend={menuDragger.dragend}\n                  onDragstart={(e) => menuDragger.dragstart(e, component)}\n                >\n                  <span class=\"menu-item-label\">{component.label}</span>\n                  {component.preview()}\n                </div>\n              ))}\n            </div>\n            <div class=\"head\">\n              {buttons.map((btn, index) => {\n                const content = (\n                  <div key={index} class=\"head-btn\" onClick={btn.handler}>\n                    <i class={`iconfont ${excuteFun(btn.icon)}`}></i>\n                    <span>{excuteFun(btn.label)}</span>\n                  </div>\n                );\n                if (!btn.tip) return content;\n                return (\n                  <el-tooltip\n                    effect=\"dark\"\n                    content={btn.tip}\n                    placement=\"bottom\"\n                  >\n                    {content}\n                  </el-tooltip>\n                );\n              })}\n            </div>\n\n            <div class=\"body\">\n              <div class=\"content\">\n                <div\n                  class=\"visual-editor-container\"\n                  ref={containerRef}\n                  style={containerStyles.value}\n                  {...focusHandler.container}\n                >\n                  {(dataModel.value?.blocks || []).map(\n                    (block, index: number) => (\n                      <VisualEditorBlock\n                        block={block}\n                        key={index}\n                        config={props.config}\n                        formData={props.formData}\n                        slots={ctx.slots}\n                        customProps={props.customProps}\n                        {...{\n                          onMousedown: (e: MouseEvent) =>\n                            focusHandler.block.onMousedown(e, block, index),\n                          onContextmenu: (e: MouseEvent) =>\n                            handler.onContextmenuBlock(e, block),\n                        }}\n                      />\n                    )\n                  )}\n                  {blockDragger.mark.x && (\n                    <div\n                      class=\"mark-line-x\"\n                      style={{ left: `${blockDragger.mark.x}px` }}\n                    ></div>\n                  )}\n                  {blockDragger.mark.y && (\n                    <div\n                      class=\"mark-line-y\"\n                      style={{ top: `${blockDragger.mark.y}px` }}\n                    ></div>\n                  )}\n                </div>\n              </div>\n            </div>\n\n            <VisualOperatorEditor\n              block={state.selectBlock!}\n              config={props.config}\n              dataModel={dataModel as any}\n              updateBlock={commander.updateBlock}\n              updateModelValue={commander.updateModelValue}\n            />\n          </div>\n        </>\n      );\n    };\n  },\n});\n","import { useModel } from \"@/packages/utils/useModel\";\nimport { defineComponent } from \"vue\";\nimport \"./style.scss\";\nexport const NumberRange = defineComponent({\n  props: {\n    start: { type: String },\n    end: { type: String },\n  },\n  emits: {\n    \"update:start\": (val?: string) => true,\n    \"update:end\": (val?: string) => true,\n  },\n  setup(props, ctx) {\n    const startModel = useModel(\n      () => props.start,\n      (val) => ctx.emit(\"update:start\", val)\n    );\n    const endModel = useModel(\n      () => props.start,\n      (val) => ctx.emit(\"update:end\", val)\n    );\n\n    return () => (\n      <div class=\"number-range\">\n        <div>\n          <input type=\"text\" v-model={startModel.value} />\n        </div>\n\n        <span>~</span>\n        <div>\n          <input type=\"text\" v-model={endModel.value} />\n        </div>\n      </div>\n    );\n  },\n});\n","import { createVisualEditorConfig } from \"./visual-editor.utils\";\nimport { ElButton, ElInput as Input, ElOption, ElSelect } from \"element-plus\";\nimport {\n  createEditorColorProps,\n  createEditorInputProps,\n  createEditorSelectProps,\n  createEditorTableProp,\n} from \"./visual-editor.props\";\nimport { NumberRange } from \"./components/number-range\";\nimport \"../visual.config.scss\";\n\nconst [ElInput]: any[] = [Input];\n\nconst visualConfig = createVisualEditorConfig();\n\nvisualConfig.registry(\"text\", {\n  label: \"文本\",\n  preview: () => \"预览文本\",\n  render: ({ props }) => (\n    <span style={{ color: props.color, fontSize: props.size }}>\n      {props.text || \"默认文本\"}\n    </span>\n  ),\n  props: {\n    text: createEditorInputProps(\"显示文本\"),\n    color: createEditorColorProps(\"字体颜色\"),\n    size: createEditorSelectProps(\"字体大小\", [\n      { label: \"14px\", val: \"14px\" },\n      { label: \"18px\", val: \"18px\" },\n      { label: \"24px\", val: \"24px\" },\n    ]),\n  },\n});\n\nvisualConfig.registry(\"button\", {\n  label: \"按钮\",\n  preview: () => <ElButton>按钮</ElButton>,\n  render: ({ props, size, custom }) => (\n    <ElButton\n      {...custom}\n      type={props.type}\n      size={props.size}\n      style={{\n        width: size.width ? `${size.width}px` : undefined,\n        height: size.height ? `${size.height}px` : undefined,\n      }}\n    >\n      {props.text || \"按钮\"}\n    </ElButton>\n  ),\n  resize: { width: true, height: true },\n  props: {\n    text: createEditorInputProps(\"显示文本\"),\n    type: createEditorSelectProps(\"按钮类型\", [\n      { label: \"基础\", val: \"primary\" },\n      { label: \"成功\", val: \"success\" },\n      { label: \"警告\", val: \"warning\" },\n      { label: \"危险\", val: \"danger\" },\n      { label: \"提示\", val: \"info\" },\n      { label: \"文本\", val: \"text\" },\n    ]),\n    size: createEditorSelectProps(\"按钮大小\", [\n      { label: \"默认\", val: \"\" },\n      { label: \"中等\", val: \"medium\" },\n      { label: \"小\", val: \"small\" },\n      { label: \"极小\", val: \"mini\" },\n    ]),\n  },\n});\n\nvisualConfig.registry(\"input\", {\n  label: \"输入框\",\n  preview: () => <ElInput modelValue={\"\"} />,\n  render: ({ model, size, custom }) => {\n    return (\n      <ElInput\n        {...custom}\n        {...model.default}\n        style={{ width: size.width ? `${size.width}px` : undefined }}\n      />\n    );\n  },\n  resize: { width: true },\n  model: {\n    default: \"绑定字段\",\n  },\n  props: {\n    size: createEditorSelectProps(\"输入框大小\", [\n      { label: \"默认\", val: \"\" },\n      { label: \"中等\", val: \"medium\" },\n      { label: \"小\", val: \"small\" },\n      { label: \"极小\", val: \"mini\" },\n    ]),\n  },\n});\n\nvisualConfig.registry(\"select\", {\n  label: \"下拉框\",\n  preview: () => <ElSelect></ElSelect>,\n  render: ({ props, model, custom }) => (\n    <ElSelect key={Math.random()} {...custom} {...model.default}>\n      {(props.options || []).map(\n        (\n          opt: {\n            label: string;\n            value: string;\n          },\n          index: number\n        ) => (\n          <ElOption label={opt.label} value={opt.value} key={index}></ElOption>\n        )\n      )}\n    </ElSelect>\n  ),\n  props: {\n    options: createEditorTableProp(\"下拉选项\", {\n      options: [\n        { label: \"显示值\", field: \"label\" },\n        { label: \"绑定值\", field: \"value\" },\n        { label: \"备注\", field: \"remark\" },\n      ],\n      showKey: \"label\",\n    }),\n  },\n  model: {\n    default: \"绑定字段\",\n  },\n});\n\nvisualConfig.registry(\"number-range\", {\n  label: \"数字范围输入框\",\n  resize: { width: true },\n  preview: () => <NumberRange />,\n  render: ({ model, size }) => (\n    <NumberRange\n      style={{ width: size.width ? `${size.width}px` : undefined }}\n      {...{\n        start: model.start.value,\n        \"onUpdate:start\": model.start.onChange,\n        end: model.end.value,\n        \"onUpdate:end\": model.end.onChange,\n      }}\n    />\n  ),\n\n  model: {\n    start: \"起始绑定字段\",\n    end: \"结束绑定字段\",\n  },\n});\n\nvisualConfig.registry(\"image\", {\n  label: \"图片\",\n  resize: { width: true, height: true },\n  preview: () => (\n    <div style=\"text-align:center\">\n      <div style=\"font-size:20px;background-color:#f2f2f2;color:#ccc;display:inline-flex;width:100%;\">\n        <i class=\"el-icon-picture\"></i>\n      </div>\n    </div>\n  ),\n  render: ({ props, size }) => (\n    <div\n      style={{\n        height: size.height ? `${size.height}px` : undefined,\n        width: size.width ? `${size.width}px` : undefined,\n      }}\n      class=\"visual-block-image\"\n    >\n      <img src={props.url || \"https://cn.vuejs.org/images/logo.png\"} />\n    </div>\n  ),\n  props: {\n    url: createEditorInputProps(\"地址\"),\n  },\n});\n\nexport default visualConfig;\n","\nimport { defineComponent } from \"vue\";\nimport { VisualEditor } from \"../src/packages/visual-editor\";\n// import { TestUseModel } from \"../src/packages/utils/useModel\";\nimport visualConfig from \"./packages/visual.config\";\nimport jsonData from \"./jsonData.json\";\n\nexport default defineComponent({\n  name: \"App\",\n  components: { VisualEditor },\n  data() {\n    return {\n      visualConfig,\n      jsonData: jsonData,\n      formData: {\n        username: \"admin\",\n      },\n      customProps: {\n        // subBtn是组件标识\n        subBtn: {\n          onClick: () => {\n            this.$notify({ message: \"执行表单数据校验及提交服务器的动作\" });\n          },\n        },\n        mySelect: {\n          onChange: (val: string) => {\n            this.$notify({ message: `食物发生变化: ${val}` });\n          },\n        },\n      },\n    };\n  },\n});\n","import { render } from \"./App.vue?vue&type=template&id=17b8bfe6\"\nimport script from \"./App.vue?vue&type=script&lang=ts\"\nexport * from \"./App.vue?vue&type=script&lang=ts\"\n\nimport \"./App.vue?vue&type=style&index=0&id=17b8bfe6&lang=scss\"\nscript.render = render\n\nexport default script","import { createApp } from \"vue\";\nimport App from \"./App.vue\";\nimport ElementPlus from \"element-plus\";\nimport \"element-plus/lib/theme-chalk/index.css\";\n\nconst app = createApp(App);\napp.use(ElementPlus);\napp.mount(\"#app\");\n"],"sourceRoot":""}
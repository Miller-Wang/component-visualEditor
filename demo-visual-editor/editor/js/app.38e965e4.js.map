{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/App.vue?c472","webpack:///./src/App.vue","webpack:///./src/packages/plugins/event.ts","webpack:///./src/packages/utils/defer.ts","webpack:///./src/packages/utils/dialog-service.tsx","webpack:///./src/packages/utils/useModel.tsx","webpack:///./src/packages/plugins/keyboard-code.ts","webpack:///./src/packages/plugins/command.plugin.ts","webpack:///./src/packages/utils/visual.command.tsx","webpack:///./src/packages/components/block-resizer/index.tsx","webpack:///./src/packages/visual-editor-block.tsx","webpack:///./src/packages/visual-editor.utils.ts","webpack:///./src/packages/utils/dropdown-service.tsx","webpack:///./src/packages/visual-editor.props.tsx","webpack:///./src/packages/components/table-prop-editor/service.tsx","webpack:///./src/packages/components/table-prop-editor/index.tsx","webpack:///./src/packages/visual-editor-operator.tsx","webpack:///./src/packages/visual-editor.tsx","webpack:///./src/packages/components/number-range/index.tsx","webpack:///./src/packages/visual.config.tsx","webpack:///./src/App.vue?1d14","webpack:///./src/App.vue?97f5","webpack:///./src/main.ts"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","class","style","jsonData","config","visualConfig","formData","JSON","stringify","createEvent","listeners","on","cb","off","index","indexOf","emit","args","forEach","item","DialogServiceEditType","defer","dfd","promise","Promise","resolve","reject","Dialog","keyGenerator","count","ServiceComponent","props","option","type","required","setup","ctx","state","editValue","showFlag","methods","service","show","hide","handler","onConfirm","onCancel","assign","proxy","title","default","editType","textarea","rows","footer","onClick","DialogService","ins","el","document","createElement","body","append","mount","$$dialog","input","initValue","opt","useModel","emitter","val","modelValue","String","emits","model","KeyboardCode","16","17","18","8","9","13","27","32","37","38","39","40","46","189","187","48","49","50","51","52","53","54","55","56","57","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","112","113","114","115","116","117","118","119","120","121","122","123","useCommander","current","queue","commands","destroyList","commandArray","registry","command","execute","undo","redo","followQueue","keyboardEvent","onKeydown","e","activeElement","keyCode","shiftKey","altKey","ctrlKey","metaKey","keyStr","keyNames","join","keyboard","keys","Array","isArray","includes","stopPropagation","preventDefault","init","addEventListener","removeEventListener","queueItem","console","log","useVisualCommand","focusData","updateBlocks","dataModel","dragstart","dragend","commander","before","blocks","after","unfocus","this","drag","focus","maxZIndex","reduce","prev","block","Math","max","zIndex","Infinity","minZIndex","min","abs","newVal","oldVal","delete","clear","placeTop","placeBottom","updateBlock","updateModelValue","Direction","BlockResizer","component","resize","width","height","startX","startY","startWidth","startHeight","startLeft","startTop","direction","mousemove","moveX","clientX","moveY","clientY","horizontal","center","vertical","durX","durY","start","top","left","hasResize","mouseup","mousedown","end","VisualEditorBlock","slots","styles","classes","adjustPosition","offsetWidth","offsetHeight","render","componentMap","componentKey","slotName","size","propName","modelName","createNewBlock","createVisualEditorConfig","componentList","comp","DropdownServiceProvider","DROPDOWN_SERVICE_PROVIDER","provide","inject","SerivceComponent","mounted","reference","getBoundingClientRect","onMousedownDocument","contains","target","content","DropdownOption","label","icon","click","dropdownClickHandler","$$dropdown","appendChild","app","VisualEditorPropsType","Table","TableColumn","Button","editorData","add","reset","onDelete","table","options","map","row","field","$$tablePropEditor","TablePropEditor","propConfig","showKey","createEditorInputProps","createEditorColorProps","color","createEditorSelectProps","select","createEditorTableProp","VisualOperatorEditor","Function","editData","container","immediate","entries","labelPosition","step","VisualEditor","require","containerStyles","containerRef","filter","v","selectIndex","selectBlock","preview","editing","clearFocus","importBlockData","text","parse","Error","alert","showBlockData","openEdit","menuDragger","containerHandler","dragenter","dataTransfer","dropEffect","dragover","dragleave","drop","offsetY","offsetX","blockHandler","blockDragger","mark","x","y","dragState","startPos","dragging","markLines","currentLeft","currentTop","currentMark","showTop","showLeft","lines","w","h","onContextmenuBlock","focusHandler","onMousedown","currentTarget","handleImport","handleExport","buttons","tip","excuteFun","fn","onContextmenu","btn","NumberRange","startModel","endModel","ElInput","fontSize","random","onChange","components","username","App","use"],"mappings":"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","file":"js/app.38e965e4.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/zhufeng-vue-drops-2101/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./App.vue?vue&type=style&index=0&id=4d25d09b&lang=scss\"","<template>\n  <div class=\"app\">\n    <visual-editor\n      v-model=\"jsonData\"\n      :config=\"visualConfig\"\n      :formData=\"formData\"\n    />\n    <div style=\"text-align: center\">\n      {{ JSON.stringify(formData) }}\n    </div>\n  </div>\n</template>\n<script lang=\"ts\">\nimport { defineComponent } from \"vue\";\nimport { VisualEditor } from \"../src/packages/visual-editor\";\n// import { TestUseModel } from \"../src/packages/utils/useModel\";\nimport visualConfig from \"./packages/visual.config\";\nimport jsonData from \"./jsonData.json\";\n\nexport default defineComponent({\n  name: \"App\",\n  components: { VisualEditor },\n  data() {\n    return {\n      visualConfig,\n      jsonData: jsonData,\n      formData: {\n        username: \"admin\",\n      },\n    };\n  },\n});\n</script>\n\n<style lang=\"scss\">\nhtml,\nbody {\n  margin: 0;\n  padding: 0;\n}\n.app {\n}\n</style>\n","type SimplyListener = (...args: any[]) => void;\nexport function createEvent() {\n  const listeners: SimplyListener[] = [];\n  return {\n    on: (cb: SimplyListener) => {\n      listeners.push(cb);\n    },\n    off: (cb: SimplyListener) => {\n      const index = listeners.indexOf(cb);\n      if (index > -1) {\n        listeners.slice(index, 1);\n      }\n    },\n    emit: (...args: any[]) => {\n      listeners.forEach((item) => item(...args));\n    },\n  };\n}\n","interface Defer {\n  (): {\n    resolve: () => void;\n    reject: () => void;\n    promise: Promise<void>;\n  };\n  <T>(): {\n    resolve: (val: T) => void;\n    reject: () => void;\n    promise: Promise<T>;\n  };\n}\n\nexport const defer: Defer = () => {\n  const dfd = {} as any;\n  dfd.promise = new Promise((resolve, reject) => {\n    dfd.resolve = resolve as any;\n    dfd.reject = reject;\n  });\n  return dfd;\n};\n","import {\n  defineComponent,\n  PropType,\n  reactive,\n  createApp,\n  getCurrentInstance,\n} from \"vue\";\nimport { defer } from \"./defer\";\nimport { ElDialog, ElButton, ElInput } from \"element-plus\";\n\nconst Dialog = ElDialog as any;\n\nenum DialogServiceEditType {\n  textarea = \"textarea\",\n  input = \"input\",\n}\n\ninterface DialogServiceOption {\n  title?: string;\n  editType?: DialogServiceEditType;\n  editReadonly?: boolean;\n  editValue?: string | null;\n  onConfirm?: (val?: string | null) => void;\n}\n\nconst keyGenerator = (() => {\n  let count = 0;\n  return () => `auto_key_${count++}`;\n})();\n\nconst ServiceComponent = defineComponent({\n  props: {\n    option: { type: Object as PropType<DialogServiceOption>, required: true },\n  },\n  setup(props) {\n    const ctx = getCurrentInstance()!;\n    const state = reactive({\n      option: props.option,\n      editValue: null as undefined | null | string,\n      showFlag: false,\n      key: keyGenerator(),\n    });\n    const methods = {\n      service: (option: DialogServiceOption) => {\n        state.option = option;\n        state.editValue = option.editValue;\n        state.key = keyGenerator();\n        methods.show();\n      },\n      show: () => (state.showFlag = true),\n      hide: () => (state.showFlag = false),\n    };\n\n    const handler = {\n      onConfirm: () => {\n        state.option.onConfirm!(state.editValue);\n        methods.hide();\n      },\n      onCancel: () => {\n        methods.hide();\n      },\n    };\n\n    // 很重要 把methods给组件的实例\n    Object.assign(ctx.proxy, methods);\n\n    return () => (\n      <Dialog\n        v-model={state.showFlag}\n        title={state.option.title}\n        key={state.key}\n      >\n        {{\n          default: () => (\n            <div>\n              {state.option.editType === DialogServiceEditType.textarea ? (\n                <ElInput\n                  type=\"textarea\"\n                  {...{ rows: 10 }}\n                  v-model={state.editValue}\n                />\n              ) : (\n                <ElInput v-model={state.editValue} />\n              )}\n            </div>\n          ),\n          footer: () => (\n            <div>\n              <ElButton {...({ onClick: handler.onCancel } as any)}>\n                取消\n              </ElButton>\n              <ElButton {...({ onClick: handler.onConfirm } as any)}>\n                确定\n              </ElButton>\n            </div>\n          ),\n        }}\n      </Dialog>\n    );\n  },\n});\n\nconst DialogService = (() => {\n  let ins: any;\n  return (option: DialogServiceOption) => {\n    if (!ins) {\n      const el = document.createElement(\"div\");\n      document.body.append(el);\n      ins = createApp(ServiceComponent, { option }).mount(el);\n    }\n    ins.service(option);\n  };\n})();\n\nexport const $$dialog = Object.assign(DialogService, {\n  input: (initValue?: string, option?: DialogServiceOption) => {\n    const dfd = defer<string | undefined | null>();\n    const opt: DialogServiceOption = {\n      ...option!,\n      editType: DialogServiceEditType.input,\n      onConfirm: dfd.resolve,\n      editValue: initValue,\n    };\n    DialogService(opt);\n    return dfd.promise;\n  },\n  textarea: (initValue?: string, option?: DialogServiceOption) => {\n    const dfd = defer<string | undefined | null>();\n    const opt: DialogServiceOption = {\n      ...option,\n      editType: DialogServiceEditType.textarea,\n      onConfirm: dfd.resolve,\n      editValue: initValue,\n    };\n    DialogService(opt);\n    return dfd.promise;\n  },\n});\n","import { computed, defineComponent, ref, watch } from \"vue\";\n\n// 用jsx封装组件的时候，实现双向数据绑定\nexport function useModel<T>(getter: () => T, emitter: (val: T) => void) {\n  const state = ref(getter()) as { value: T };\n\n  watch(getter, (val) => {\n    if (val !== state.value) {\n      state.value = val;\n    }\n  });\n\n  return {\n    get value() {\n      return state.value;\n    },\n    set value(val: T) {\n      if (state.value !== val) {\n        state.value = val;\n        emitter(val);\n      }\n    },\n  };\n}\n\n// modelValue 外部可以用v-model绑定\nexport const TestUseModel = defineComponent({\n  props: {\n    modelValue: { type: String },\n  },\n  emits: {\n    \"update:modelValue\": (val?: string) => true,\n  },\n  setup(props, ctx) {\n    const model = useModel(\n      () => props.modelValue,\n      (val) => ctx.emit(\"update:modelValue\", val)\n    );\n    return () => (\n      <div>\n        自定义输入框\n        <input type=\"text\" v-model={model.value} />\n      </div>\n    );\n  },\n});\n","export const KeyboardCode = {\n    16: 'shift',\n    17: 'ctrl',\n    18: 'alt',\n\n    8: 'backspace',\n    9: 'tab',\n    13: 'enter',\n    27: 'esc',\n    32: 'space',\n\n    37: 'left',\n    38: 'up',\n    39: 'right',\n    40: 'down',\n    46: 'delete',\n    189: '-',\n    187: '=',\n\n    48: '0',\n    49: '1',\n    50: '2',\n    51: '3',\n    52: '4',\n    53: '5',\n    54: '6',\n    55: '7',\n    56: '8',\n    57: '9',\n\n    65: 'a',\n    66: 'b',\n    67: 'c',\n    68: 'd',\n    69: 'e',\n    70: 'f',\n    71: 'g',\n    72: 'h',\n    73: 'i',\n    74: 'j',\n    75: 'k',\n\n    76: 'l',\n    77: 'm',\n    78: 'n',\n    79: 'o',\n    80: 'p',\n    81: 'q',\n    82: 'r',\n    83: 's',\n    84: 't',\n    85: 'u',\n    86: 'v',\n    87: 'w',\n    88: 'x',\n    89: 'y',\n    90: 'z',\n\n    112: 'F1',\n    113: 'F2',\n    114: 'F3',\n    115: 'F4',\n    116: 'F5',\n    117: 'F6',\n    118: 'F7',\n    119: 'F8',\n    120: 'F9',\n    121: 'F10',\n    122: 'F11',\n    123: 'F12',\n} as Record<number, string>","import { reactive } from \"vue\";\nimport { KeyboardCode } from \"./keyboard-code\";\nexport interface CommondExecute {\n  undo: () => void;\n  redo: () => void;\n}\n\nexport interface Command {\n  name: string; // 命令唯一标识\n  keyboard?: string | string[]; // 命令监听的快捷键\n  execute: (...args: any[]) => CommondExecute; // 命令被执行的时候，做的内容\n  followQueue?: boolean; // 命令执行完之后，是否将命令执行得到的undo, redo存入命令队列\n  init?: () => () => void | undefined;\n  data?: any;\n}\n\nexport interface CommandManager {\n  queue: CommondExecute[];\n  current: number;\n}\n\nexport function useCommander() {\n  const state = reactive({\n    current: -1,\n    queue: [] as CommondExecute[],\n    commands: {} as Record<string, (...args: any[]) => void>,\n    destroyList: [] as (() => void | undefined)[],\n    commandArray: [] as Command[],\n  });\n  const registry = (command: Command) => {\n    // state.commandArray.push(command);\n    // state.commands[command.name] = (...args) => {\n    //   const { undo, redo } = command.execute(...args);\n    //   if (command.followQueue !== false) {\n    //     state.queue.push({ undo, redo });\n    //     state.current += 1;\n    //   }\n    //   redo();\n    // };\n\n    state.commandArray.push(command);\n    state.commands[command.name] = (...args) => {\n      const { undo, redo } = command.execute(...args);\n      redo();\n      /*如果命令执行之后，不需要进入命令队列，则直接结束*/\n      if (command.followQueue === false) {\n        return;\n      }\n      /*否则，将命令队列中剩余的命令去除，保留current及其之前的命令*/\n      let { queue } = state;\n      const { current } = state;\n      if (queue.length > 0) {\n        queue = queue.slice(0, current + 1);\n        state.queue = queue;\n      }\n      /*设置命令队列中最后一个命令为当前执行的命令*/\n      queue.push({ undo, redo });\n      /*索引+1，指向队列中的最后一个命令*/\n      state.current = current + 1;\n    };\n  };\n\n  const keyboardEvent = (() => {\n    const onKeydown = (e: KeyboardEvent) => {\n      if (document.activeElement !== document.body) {\n        return;\n      }\n      const { keyCode, shiftKey, altKey, ctrlKey, metaKey } = e;\n      const keyStr: string[] = [];\n      if (ctrlKey || metaKey) {\n        keyStr.push(\"ctrl\");\n      }\n      if (shiftKey) keyStr.push(\"shift\");\n      if (altKey) keyStr.push(\"alt\");\n      keyStr.push(KeyboardCode[keyCode]);\n      const keyNames = keyStr.join(\"+\");\n      state.commandArray.forEach(({ keyboard, name }) => {\n        if (!keyboard) return;\n        const keys = !Array.isArray(keyboard) ? [keyboard] : keyboard;\n        if (keys.includes(keyNames)) {\n          // 执行命令\n          state.commands[name]();\n          e.stopPropagation();\n          e.preventDefault();\n        }\n      });\n    };\n\n    const init = () => {\n      window.addEventListener(\"keydown\", onKeydown);\n      return () => {\n        window.removeEventListener(\"keydown\", onKeydown);\n      };\n    };\n    return init;\n  })();\n\n  const init = () => {\n    // const onKeydown = (e: KeyboardEvent) => {\n    //   console.log(\"监听到键盘事件\");\n    // };\n    // window.addEventListener(\"keydown\", onKeydown);\n    state.commandArray.forEach(\n      (command) => !!command.init && state.destroyList.push(command.init())\n    );\n    state.destroyList.push(keyboardEvent());\n    // state.destroyList.push(() =>\n    //   window.removeEventListener(\"keydown\", onKeydown)\n    // );\n  };\n\n  // const destory = () => {};\n\n  registry({\n    name: \"undo\",\n    keyboard: \"ctrl+z\",\n    followQueue: false,\n    execute: () => {\n      // 命令被执行的时候，要做的事情\n      return {\n        redo: () => {\n          // 重新做一遍，要做的事情\n          const { current } = state;\n          if (current === -1) return;\n          const queueItem = state.queue[current];\n          if (queueItem) {\n            queueItem.undo && queueItem.undo();\n            state.current--;\n          }\n        },\n        undo: () => {\n          // 将做的事情还原\n        },\n      };\n    },\n  });\n\n  registry({\n    name: \"redo\",\n    keyboard: [\"ctrl+y\", \"ctrl+shift+z\"],\n    followQueue: false,\n    execute: () => {\n      return {\n        redo: () => {\n          const queueItem = state.queue[state.current + 1];\n          if (queueItem) {\n            queueItem.redo();\n            state.current++;\n          }\n        },\n        undo: () => {\n          console.log(\"undo\");\n        },\n      };\n    },\n  });\n\n  return {\n    state,\n    registry,\n    init,\n  };\n}\n","import { useCommander } from \"../plugins/command.plugin\";\nimport {\n  VisualEditorBlockData,\n  VisualEditorModelValue,\n} from \"../visual-editor.utils\";\nimport deepcopy from \"deepcopy\";\n\nexport function useVisualCommand({\n  focusData,\n  updateBlocks,\n  dataModel,\n  dragstart,\n  dragend,\n}: {\n  focusData: {\n    value: { focus: VisualEditorBlockData[]; unfocus: VisualEditorBlockData[] };\n  };\n  updateBlocks: (blocks: VisualEditorBlockData[]) => void;\n  dataModel: { value: VisualEditorModelValue | undefined };\n  dragstart: { on: (cb: () => void) => void; off: (cb: () => void) => void };\n  dragend: { on: (cb: () => void) => void; off: (cb: () => void) => void };\n}) {\n  const commander = useCommander();\n\n  // 删除命令\n  commander.registry({\n    name: \"delete\",\n    keyboard: [\"backspace\", \"delete\", \"ctrl+d\"],\n    execute: () => {\n      console.log(\"执行删除命令\");\n      const data = {\n        before: dataModel.value?.blocks || [],\n        after: focusData.value.unfocus,\n      };\n      return {\n        redo: () => {\n          console.log(\"重做删除命令\");\n          updateBlocks(data.after);\n        },\n        undo: () => {\n          console.log(\"撤回删除命令\");\n          updateBlocks(data.before);\n        },\n      };\n    },\n  });\n\n  commander.registry({\n    name: \"updateBlocks\",\n    execute: (blocks: VisualEditorBlockData[]) => {\n      console.log(\"执行删除命令\");\n      const data = {\n        before: dataModel.value?.blocks || [],\n        after: focusData.value.unfocus,\n      };\n      return {\n        redo: () => {\n          console.log(\"重做删除命令\");\n          updateBlocks(data.after);\n        },\n        undo: () => {\n          console.log(\"撤回删除命令\");\n          updateBlocks(data.before);\n        },\n      };\n    },\n  });\n\n  /**\n   * 拖拽命令\n   * - 从菜单拖拽组件到容器画布；\n   * - 在容器中拖拽组件调整位置\n   * - 拖拽调整组件的宽度和高度；\n   */\n  commander.registry({\n    name: \"drag\",\n    init() {\n      this.data = {\n        before: null as null | VisualEditorBlockData[],\n      };\n      const handler = {\n        dragstart: () => {\n          this.data.before = deepcopy(dataModel.value?.blocks || []);\n        },\n        dragend: () => {\n          commander.state.commands.drag();\n        },\n      };\n      dragstart.on(handler.dragstart);\n      dragend.on(handler.dragend);\n\n      return () => {\n        dragstart.off(handler.dragstart);\n        dragend.off(handler.dragend);\n      };\n    },\n    execute() {\n      const before = this.data.before;\n      const after = deepcopy(dataModel.value?.blocks || []);\n      return {\n        redo: () => {\n          updateBlocks(deepcopy(after));\n        },\n        undo: () => {\n          updateBlocks(deepcopy(before));\n        },\n      };\n    },\n  });\n\n  commander.registry({\n    name: \"clear\",\n    execute: () => {\n      const data = {\n        before: deepcopy(dataModel.value?.blocks),\n        after: deepcopy([]),\n      };\n      return {\n        redo: () => {\n          updateBlocks(deepcopy(data.after));\n        },\n        undo: () => {\n          updateBlocks(deepcopy(data.before || []));\n        },\n      };\n    },\n  });\n\n  commander.registry({\n    name: \"placeTop\",\n    keyboard: \"ctrl+up\",\n    execute: () => {\n      const data = {\n        before: deepcopy(dataModel.value?.blocks),\n        after: deepcopy(\n          (() => {\n            const { focus, unfocus } = focusData.value;\n            const maxZIndex = unfocus.reduce((prev, block) => {\n              return Math.max(prev, block.zIndex);\n            }, -Infinity);\n            focus.forEach((block) => (block.zIndex = maxZIndex + 1));\n            return deepcopy(dataModel.value?.blocks);\n          })()\n        ),\n      };\n      return {\n        redo: () => {\n          updateBlocks(deepcopy(data.after || []));\n        },\n        undo: () => {\n          updateBlocks(deepcopy(data.before || []));\n        },\n      };\n    },\n  });\n\n  commander.registry({\n    name: \"placeBottom\",\n    keyboard: \"ctrl+down\",\n    execute: () => {\n      const data = {\n        before: deepcopy(dataModel.value?.blocks),\n        after: deepcopy(\n          (() => {\n            const { focus, unfocus } = focusData.value;\n            let minZIndex = unfocus.reduce((prev, block) => {\n              return Math.min(prev, block.zIndex);\n            }, Infinity);\n\n            if (minZIndex <= 0) {\n              unfocus.forEach(\n                (block) =>\n                  (block.zIndex = 1 + block.zIndex + Math.abs(minZIndex))\n              );\n              minZIndex = 1;\n            }\n            focus.forEach((block) => (block.zIndex = minZIndex - 1));\n            return deepcopy(dataModel.value?.blocks);\n          })()\n        ),\n      };\n      return {\n        redo: () => {\n          updateBlocks(deepcopy(data.after || []));\n        },\n        undo: () => {\n          updateBlocks(deepcopy(data.before || []));\n        },\n      };\n    },\n  });\n\n  commander.registry({\n    name: \"updateBlock\",\n    execute: (newVal: VisualEditorBlockData, oldVal: VisualEditorBlockData) => {\n      let blocks = deepcopy(dataModel.value?.blocks || []);\n      let data = {\n        before: deepcopy(dataModel.value?.blocks),\n        after: (() => {\n          blocks = [...blocks];\n          const index = dataModel.value!.blocks.indexOf(oldVal);\n          if (index > -1) {\n            blocks.splice(index, 1, newVal);\n          }\n          return deepcopy(blocks);\n        })(),\n      };\n      return {\n        redo: () => {\n          updateBlocks(deepcopy(data.after || []));\n        },\n        undo: () => {\n          updateBlocks(deepcopy(data.before || []));\n        },\n      };\n    },\n  });\n\n  commander.registry({\n    name: \"updateModelValue\",\n    execute: (val: VisualEditorModelValue) => {\n      const data = {\n        before: deepcopy(dataModel.value),\n        after: deepcopy(val),\n      };\n      return {\n        redo: () => {\n          dataModel.value = data.after;\n        },\n        undo: () => {\n          dataModel.value = data.before;\n        },\n      };\n    },\n  });\n\n  commander.init();\n\n  return {\n    undo: () => commander.state.commands.undo(),\n    redo: () => commander.state.commands.redo(),\n    delete: () => commander.state.commands.delete(),\n    clear: () => commander.state.commands.clear(),\n    placeTop: () => commander.state.commands.placeTop(),\n    placeBottom: () => commander.state.commands.placeBottom(),\n    updateBlock: (\n      newVal: VisualEditorBlockData,\n      oldVal: VisualEditorBlockData\n    ) => commander.state.commands.updateBlock(newVal, oldVal),\n    updateModelValue: (val: VisualEditorModelValue) =>\n      commander.state.commands.updateModelValue(val),\n  };\n}\n","import {\n  VisualEditorBlockData,\n  VisualEditorComponent,\n  VisualEditorConfig,\n} from \"@/packages/visual-editor.utils\";\nimport { defineComponent, PropType } from \"vue\";\nimport \"./style.scss\";\n\nenum Direction {\n  start = \"start\",\n  center = \"center\",\n  end = \"end\",\n}\n\nexport const BlockResizer = defineComponent({\n  props: {\n    block: { type: Object as PropType<VisualEditorBlockData>, required: true },\n    component: {\n      type: Object as PropType<VisualEditorComponent>,\n      required: true,\n    },\n  },\n  setup(props) {\n    const { width, height } = props.component.resize || {};\n\n    const onMousedown = (() => {\n      let data = {\n        startX: 0,\n        startY: 0,\n        startWidth: 0,\n        startHeight: 0,\n        startLeft: 0,\n        startTop: 0,\n        direction: {} as { horizontal: Direction; vertical: Direction },\n      };\n\n      const mousemove = (e: MouseEvent) => {\n        const {\n          startX,\n          startY,\n          startWidth,\n          startHeight,\n          direction,\n          startLeft,\n          startTop,\n        } = data;\n        let { clientX: moveX, clientY: moveY } = e;\n        if (direction.horizontal === Direction.center) {\n          moveX = startX;\n        }\n        if (direction.vertical === Direction.center) {\n          moveY = startY;\n        }\n\n        let durX = moveX - startX;\n        let durY = moveY - startY;\n        const block = props.block as VisualEditorBlockData;\n\n        if (direction.vertical === Direction.start) {\n          durY = -durY;\n          block.top = startTop - durY;\n        }\n        if (direction.horizontal === Direction.start) {\n          durX = -durX;\n          block.left = startLeft - durX;\n        }\n\n        const width = startWidth + durX;\n        const height = startHeight + durY;\n\n        block.width = width;\n        block.height = height;\n        block.hasResize = true;\n      };\n\n      const mouseup = (e: MouseEvent) => {\n        console.log(e);\n        document.body.removeEventListener(\"mousemove\", mousemove);\n        document.body.removeEventListener(\"mouseup\", mouseup);\n      };\n      const mousedown = (\n        e: MouseEvent,\n        direction: { horizontal: Direction; vertical: Direction }\n      ) => {\n        e.stopPropagation();\n        document.body.addEventListener(\"mousemove\", mousemove);\n        document.body.addEventListener(\"mouseup\", mouseup);\n        data = {\n          startX: e.clientX,\n          startY: e.clientY,\n          direction,\n          startWidth: props.block.width,\n          startHeight: props.block.height,\n          startLeft: props.block.left,\n          startTop: props.block.top,\n        };\n      };\n\n      return mousedown;\n    })();\n\n    return () => (\n      <>\n        {height && (\n          <>\n            <div\n              class=\"block-resize block-resize-top\"\n              onMousedown={(e) =>\n                onMousedown(e, {\n                  horizontal: Direction.center,\n                  vertical: Direction.start,\n                })\n              }\n            ></div>\n            <div\n              class=\"block-resize block-resize-bottom\"\n              onMousedown={(e) =>\n                onMousedown(e, {\n                  horizontal: Direction.center,\n                  vertical: Direction.end,\n                })\n              }\n            ></div>\n          </>\n        )}\n\n        {width && (\n          <>\n            <div\n              class=\"block-resize block-resize-left\"\n              onMousedown={(e) =>\n                onMousedown(e, {\n                  horizontal: Direction.start,\n                  vertical: Direction.center,\n                })\n              }\n            ></div>\n            <div\n              class=\"block-resize block-resize-right\"\n              onMousedown={(e) =>\n                onMousedown(e, {\n                  horizontal: Direction.end,\n                  vertical: Direction.center,\n                })\n              }\n            ></div>\n          </>\n        )}\n\n        {width && height && (\n          <>\n            <div\n              class=\"block-resize block-resize-top-left\"\n              onMousedown={(e) =>\n                onMousedown(e, {\n                  horizontal: Direction.start,\n                  vertical: Direction.start,\n                })\n              }\n            ></div>\n            <div\n              class=\"block-resize block-resize-top-right\"\n              onMousedown={(e) =>\n                onMousedown(e, {\n                  horizontal: Direction.end,\n                  vertical: Direction.start,\n                })\n              }\n            ></div>\n\n            <div\n              class=\"block-resize block-resize-bottom-left\"\n              onMousedown={(e) =>\n                onMousedown(e, {\n                  horizontal: Direction.start,\n                  vertical: Direction.end,\n                })\n              }\n            ></div>\n            <div\n              class=\"block-resize block-resize-bottom-right\"\n              onMousedown={(e) =>\n                onMousedown(e, {\n                  horizontal: Direction.end,\n                  vertical: Direction.end,\n                })\n              }\n            ></div>\n          </>\n        )}\n      </>\n    );\n  },\n});\n","import { computed, defineComponent, onMounted, PropType, ref, Slot } from \"vue\";\nimport { BlockResizer } from \"./components/block-resizer\";\nimport {\n  VisualEditorBlockData,\n  VisualEditorConfig,\n} from \"./visual-editor.utils\";\n\nexport const VisualEditorBlock = defineComponent({\n  props: {\n    block: {\n      type: Object as PropType<VisualEditorBlockData>,\n    },\n    config: {\n      type: Object as PropType<VisualEditorConfig>,\n    },\n    formData: { type: Object as PropType<Record<string, any>>, required: true },\n    slots: {\n      type: Object as PropType<Record<string, Slot | undefined>>,\n      required: true,\n    },\n  },\n  setup(props) {\n    const el = ref({} as HTMLDivElement);\n    const styles = computed(() => ({\n      top: `${props.block?.top}px`,\n      left: `${props.block?.left}px`,\n      zIndex: props.block?.zIndex,\n    }));\n\n    const classes = computed(() => [\n      \"visual-editor-block\",\n      {\n        \"visual-editor-block-focus\": props.block?.focus,\n      },\n    ]);\n\n    onMounted(() => {\n      // 放置block时，让组件居中，对准鼠标点\n      const block = props.block;\n      if (block?.adjustPosition) {\n        const { offsetWidth, offsetHeight } = el.value;\n        block.left -= offsetWidth / 2;\n        block.top -= offsetHeight / 2;\n        block.height = offsetHeight;\n        block.width = offsetWidth;\n        block.adjustPosition = false;\n      }\n    });\n\n    return () => {\n      const component = props.config?.componentMap[props.block!.componentKey];\n      const formData = props.formData as Record<string, any>;\n      let render: any;\n\n      if (props.block?.slotName && props.slots[props.block.slotName]) {\n        render = props.slots[props.block.slotName]!();\n      } else {\n        render = component?.render({\n          size: props.block?.hasResize\n            ? {\n                width: props.block.width,\n                height: props.block.height,\n              }\n            : {},\n          props: props.block?.props || {},\n          /**@ts-ignore */\n          model: Object.keys(component.model || {}).reduce((prev, propName) => {\n            const modelName = !props.block?.model\n              ? null\n              : props.block?.model[propName];\n            prev[propName] = {\n              [propName === \"default\" ? \"modelValue\" : propName]: props\n                .formData[modelName],\n              [modelName === \"default\" ? \"onUpdate:modelValue\" : \"onChange\"]: (\n                val: any\n              ) => modelName && (formData[modelName] = val),\n            };\n            return prev;\n          }, {} as Record<string, any>),\n        });\n      }\n\n      const { width, height } = component?.resize || {};\n      return (\n        <div class={classes.value} style={styles.value} ref={el}>\n          {render}\n          {props.block?.focus && (width || height) && (\n            <BlockResizer\n              block={props.block!}\n              component={component!}\n            ></BlockResizer>\n          )}\n        </div>\n      );\n    };\n  },\n});\n","import { VisualEditorProps } from \"./visual-editor.props\";\n\nexport interface VisualEditorBlockData {\n  top: number;\n  left: number;\n  componentKey: string;\n  adjustPosition: boolean; // 是否需要调整位置\n  focus: boolean; // 是否是选中状态\n  zIndex: number; // z-index值\n  width: number;\n  height: number;\n  hasResize: boolean; // 是否调整过宽高\n  props?: Record<string, any>; // 组件的设计属性\n  model?: Record<string, any>; // 绑定的字段\n  slotName?: string; // 组件唯一标识\n}\n\nexport interface VisualEditorModelValue {\n  container: {\n    width: number;\n    height: number;\n  };\n  blocks: VisualEditorBlockData[];\n}\n\nexport interface VisualEditorComponent {\n  key: string;\n  label: string;\n  preview: () => JSX.Element;\n  render: (data: {\n    props: any;\n    model: any;\n    size: { width?: number; height?: number };\n  }) => JSX.Element;\n  props?: Record<string, VisualEditorProps>;\n  model?: Record<string, string>; // 绑定的字段\n  resize?: { width?: boolean; height?: boolean };\n}\n\nexport function createNewBlock(data: {\n  component: VisualEditorComponent;\n  top: number;\n  left: number;\n}): VisualEditorBlockData {\n  return {\n    componentKey: data.component!.key,\n    top: data.top,\n    left: data.left,\n    adjustPosition: true,\n    focus: false,\n    zIndex: 0,\n    width: 0,\n    height: 0,\n    hasResize: false,\n  };\n}\n\nexport function createVisualEditorConfig() {\n  const componentList: VisualEditorComponent[] = [];\n  const componentMap: Record<string, VisualEditorComponent> = {};\n\n  return {\n    componentList,\n    componentMap,\n    registry: <\n      Props extends Record<string, VisualEditorProps>,\n      Model extends Record<string, string> = {}\n    >(\n      key: string,\n      component: {\n        label: string;\n        preview: () => JSX.Element;\n        render: (data: {\n          props: { [k in keyof Props]: any };\n          model: Partial<{ [key in keyof Model]: any }>;\n          size: { width?: number; height?: number };\n        }) => JSX.Element;\n        props?: Props;\n        model?: Model;\n        resize?: { width?: boolean; height?: boolean };\n      }\n    ) => {\n      const comp = { ...component, key };\n      componentList.push(comp);\n      componentMap[key] = comp;\n    },\n  };\n}\n\n// 配置类型\nexport type VisualEditorConfig = ReturnType<typeof createVisualEditorConfig>;\n\nexport interface VisualEditorMarkLine {\n  x: { left: number; showLeft: number }[];\n  y: { top: number; showTop: number }[];\n}\n","import {\n  computed,\n  createApp,\n  defineComponent,\n  getCurrentInstance,\n  inject,\n  onBeforeUnmount,\n  onMounted,\n  PropType,\n  provide,\n  reactive,\n  ref,\n} from \"vue\";\nimport { defer } from \"./defer\";\nimport \"./dropdown-service.scss\";\n\ninterface DropdownServiceOption {\n  reference: MouseEvent | HTMLElement;\n  content: () => JSX.Element;\n}\n\nconst DropdownServiceProvider = (() => {\n  const DROPDOWN_SERVICE_PROVIDER = \"@@DROPDOWN_SERVICE_PROVIDER\";\n  return {\n    provide: (handler: { onClick: () => void }) => {\n      provide(DROPDOWN_SERVICE_PROVIDER, handler);\n    },\n    inject: () => {\n      return inject(DROPDOWN_SERVICE_PROVIDER) as { onClick: () => void };\n    },\n  };\n})();\n\nconst SerivceComponent = defineComponent({\n  props: { option: { type: Object as PropType<DropdownServiceOption> } },\n\n  setup(props) {\n    const ctx = getCurrentInstance()!;\n    const el = ref({} as HTMLDivElement);\n\n    const state = reactive({\n      option: props.option,\n      showFlag: false,\n      top: 0,\n      left: 0,\n      mounted: (() => {\n        const dfd = defer();\n        onMounted(dfd.resolve);\n        return dfd.promise;\n      })(),\n    });\n\n    const methods = {\n      show: async () => {\n        await state.mounted;\n        state.showFlag = true;\n      },\n      hide: async () => {\n        state.showFlag = false;\n      },\n    };\n\n    const service = (option: DropdownServiceOption) => {\n      state.option = option;\n      state.showFlag = true;\n      if (\"addEventListener\" in option.reference) {\n        console.log(option.reference);\n        const { top, left, height } = option.reference.getBoundingClientRect();\n        state.top = top + height;\n        state.left = left;\n      } else {\n        const { clientX, clientY } = option.reference;\n        state.left = clientX;\n        state.top = clientY;\n      }\n      methods.show();\n    };\n\n    const classes = computed(() => [\n      \"dropdown-service\",\n      {\n        \"dropdown-service-show\": state.showFlag,\n      },\n    ]);\n    const style = computed(() => ({\n      top: `${state.top}px`,\n      left: `${state.left}px`,\n    }));\n\n    Object.assign(ctx.proxy, { service });\n\n    const onMousedownDocument = (e: MouseEvent) => {\n      if (!el.value.contains(e.target as HTMLElement)) {\n        methods.hide();\n      }\n    };\n    onMounted(() =>\n      document.body.addEventListener(\"mousedown\", onMousedownDocument, true)\n    );\n\n    onBeforeUnmount(() =>\n      document.body.removeEventListener(\"mousedown\", onMousedownDocument, true)\n    );\n\n    DropdownServiceProvider.provide({ onClick: methods.hide });\n\n    return () => (\n      <div class={classes.value} style={style.value} ref={el}>\n        {state.option?.content()}\n      </div>\n    );\n  },\n});\n\nexport const DropdownOption = defineComponent({\n  props: {\n    label: { type: String },\n    icon: { type: String },\n  },\n  emits: {\n    click: (e: MouseEvent) => true,\n  },\n  setup(props, ctx) {\n    const { onClick: dropdownClickHandler } = DropdownServiceProvider.inject();\n    const handler = {\n      onClick: (e: MouseEvent) => {\n        ctx.emit(\"click\", e);\n        dropdownClickHandler();\n      },\n    };\n    return () => (\n      <div class=\"dropdown-option\" onClick={handler.onClick}>\n        <i class={`iconfont ${props.icon}`}></i>\n        <span>{props.label}</span>\n      </div>\n    );\n  },\n});\n\nexport const $$dropdown = (() => {\n  let ins: any;\n  return (option: DropdownServiceOption) => {\n    if (!ins) {\n      const el = document.createElement(\"div\");\n      document.body.appendChild(el);\n      const app = createApp(SerivceComponent, { option });\n      ins = app.mount(el);\n    }\n    ins.service(option);\n  };\n})();\n","export enum VisualEditorPropsType {\n  input = \"input\",\n  color = \"color\",\n  select = \"select\",\n  table = \"table\",\n}\n\nexport interface VisualEditorProps {\n  type: VisualEditorPropsType;\n  label: string;\n  options?: VisualEditorSelectOptions;\n  table?: VisualEditorTableOptions;\n}\n\n/** ------input------- */\n\nexport function createEditorInputProps(label: string): VisualEditorProps {\n  return {\n    type: VisualEditorPropsType.input,\n    label,\n  };\n}\n\n/** ------color------- */\n\nexport function createEditorColorProps(label: string): VisualEditorProps {\n  return {\n    type: VisualEditorPropsType.color,\n    label,\n  };\n}\n\n/** ------select------- */\n\nexport type VisualEditorSelectOptions = {\n  label: string;\n  val: string;\n}[];\n\nexport function createEditorSelectProps(\n  label: string,\n  options: VisualEditorSelectOptions\n): VisualEditorProps {\n  return {\n    type: VisualEditorPropsType.select,\n    label,\n    options,\n  };\n}\n\n/** ------table------- */\n\nexport type VisualEditorTableOptions = {\n  options: {\n    label: string;\n    field: string; // 列绑定字段\n  }[];\n  showKey: string;\n};\n\nexport function createEditorTableProp(\n  label: string,\n  options: VisualEditorTableOptions\n) {\n  return {\n    type: VisualEditorPropsType.table,\n    label,\n    table: options,\n  };\n}\n","import { defer } from \"@/packages/utils/defer\";\nimport { VisualEditorProps } from \"@/packages/visual-editor.props\";\nimport deepcopy from \"deepcopy\";\nimport {\n  ElButton,\n  ElDialog,\n  ElTableColumn,\n  ElTable,\n  ElInput,\n} from \"element-plus\";\nimport {\n  createApp,\n  defineComponent,\n  getCurrentInstance,\n  onMounted,\n  PropType,\n  reactive,\n} from \"vue\";\n\nconst [Dialog, Table, TableColumn, Button]: any[] = [\n  ElDialog,\n  ElTable,\n  ElTableColumn,\n  ElButton,\n];\n\nexport interface TablePropEditorServiceOption {\n  data: any[];\n  config: VisualEditorProps;\n  onConfirm: (data: any) => void;\n}\n\nconst ServiceComponent = defineComponent({\n  props: {\n    option: {\n      type: Object as PropType<TablePropEditorServiceOption>,\n      required: true,\n    },\n  },\n\n  setup(props) {\n    const ctx = getCurrentInstance()!;\n    const state = reactive({\n      option: props.option,\n      showFlag: false,\n      mounted: (() => {\n        const dfd = defer();\n        onMounted(dfd.resolve);\n        return dfd.promise;\n      })(),\n      editorData: [] as any[],\n    });\n\n    const methods = {\n      service: (option: TablePropEditorServiceOption) => {\n        state.option = option;\n        state.editorData = deepcopy(option.data || []);\n        debugger;\n        methods.show();\n      },\n      show: async () => {\n        await state.mounted;\n        state.showFlag = true;\n      },\n      hide: async () => {\n        state.showFlag = false;\n      },\n      add: () => {\n        state.editorData.push({});\n      },\n      reset: () => {\n        state.editorData = deepcopy(state.option.data);\n      },\n    };\n\n    const handler = {\n      onConfirm: () => {\n        state.option.onConfirm(state.editorData);\n        methods.hide();\n      },\n      onCancel: () => {\n        methods.hide();\n      },\n      onDelete: () => {},\n    };\n\n    Object.assign(ctx.proxy!, methods);\n\n    return () => (\n      <Dialog v-model={state.showFlag}>\n        {{\n          default: () => (\n            <div>\n              <div>\n                <Button onClick={methods.add}>添加</Button>\n                <Button onClick={methods.reset}>重置</Button>\n              </div>\n              <Table data={state.editorData}>\n                <TableColumn type=\"index\" />\n                {state.option.config.table?.options.map((item, index) => (\n                  <TableColumn label={item.label}>\n                    {{\n                      default: ({ row }: { row: any }) => (\n                        <ElInput v-model={row[item.field]} />\n                      ),\n                    }}\n                  </TableColumn>\n                ))}\n                <TableColumn label=\"操作栏\">\n                  <Button type=\"text\" onClick={handler.onDelete}>\n                    删除\n                  </Button>\n                </TableColumn>\n              </Table>\n            </div>\n          ),\n          footer: () => (\n            <>\n              <Button onClick={handler.onCancel}> 取消</Button>\n              <Button onClick={handler.onConfirm} type=\"primary\">\n                确定\n              </Button>\n            </>\n          ),\n        }}\n      </Dialog>\n    );\n  },\n});\n\nexport const $$tablePropEditor = (() => {\n  let ins: any;\n  return (option: Omit<TablePropEditorServiceOption, \"onConfirm\">) => {\n    if (!ins) {\n      const el = document.createElement(\"div\");\n      document.body.appendChild(el);\n      const app = createApp(ServiceComponent, { option });\n      ins = app.mount(el);\n    }\n    const dfd = defer<any[]>();\n    ins.service({\n      ...option,\n      onConfirm: dfd.resolve,\n    });\n\n    return dfd.promise;\n  };\n})();\n","import { useModel } from \"@/packages/utils/useModel\";\nimport { VisualEditorProps } from \"@/packages/visual-editor.props\";\nimport { defineComponent, PropType } from \"vue\";\nimport { ElButton, ElTag } from \"element-plus\";\nimport \"./style.scss\";\nimport { $$tablePropEditor } from \"./service\";\n\nconst Button = ElButton as any;\n\nexport const TablePropEditor = defineComponent({\n  props: {\n    modelValue: { type: Array as PropType<any[]> },\n    propConfig: { type: Object as PropType<VisualEditorProps>, required: true },\n  },\n  emits: {\n    \"update:modelValue\": (val?: any[]) => true,\n  },\n  setup(props, ctx) {\n    const model = useModel(\n      () => props.modelValue,\n      (val) => ctx.emit(\"update:modelValue\", val)\n    );\n\n    const onClick = async () => {\n      const data = await $$tablePropEditor({\n        config: props.propConfig,\n        data: props.modelValue || [],\n      });\n      console.log(data);\n      model.value = data;\n    };\n\n    return () => (\n      <div>\n        {(!model.value || model.value.length === 0) && (\n          <Button onClick={onClick} type=\"primary\">\n            添加\n          </Button>\n        )}\n        {(model.value || []).map((item) => (\n          <ElTag>{item[props.propConfig.table?.showKey || \"\"]}</ElTag>\n        ))}\n      </div>\n    );\n  },\n});\n","import deepcopy from \"deepcopy\";\nimport {\n  ElButton,\n  ElColorPicker,\n  ElForm,\n  ElFormItem,\n  ElInput,\n  ElInputNumber,\n  ElOption,\n  ElSelect,\n} from \"element-plus\";\nimport { defineComponent, PropType, reactive, watch } from \"vue\";\nimport { TablePropEditor } from \"./components/table-prop-editor\";\nimport { VisualEditorPropsType } from \"./visual-editor.props\";\nimport {\n  VisualEditorBlockData,\n  VisualEditorConfig,\n  VisualEditorModelValue,\n} from \"./visual-editor.utils\";\n\nexport const VisualOperatorEditor = defineComponent({\n  props: {\n    block: { type: Object as PropType<VisualEditorBlockData> },\n    config: { type: Object as PropType<VisualEditorConfig> },\n    dataModel: {\n      type: Object as PropType<VisualEditorModelValue>,\n      required: true,\n    },\n    updateBlock: {\n      type: Function as PropType<\n        (\n          newBlock: VisualEditorBlockData,\n          oldBlock: VisualEditorBlockData\n        ) => void\n      >,\n      required: true,\n    },\n    updateModelValue: {\n      type: Function as PropType<(...args: any[]) => void>,\n      required: true,\n    },\n  },\n\n  setup(props) {\n    let content: JSX.Element;\n\n    const state = reactive({\n      editData: {} as any,\n    });\n\n    const methods = {\n      apply: () => {\n        if (!props.block) {\n          // 当前编辑容器属性\n          props.updateModelValue({\n            ...(props.dataModel as any).value,\n            container: state.editData,\n          });\n        } else {\n          // 当前编辑block数据属性\n          props.updateBlock(\n            {\n              ...props.block,\n              props: state.editData,\n            },\n            props.block\n          );\n        }\n      },\n      reset: () => {\n        if (!props.block) {\n          state.editData = deepcopy((props.dataModel as any).value.container);\n        } else {\n          state.editData = deepcopy(props.block.props || {});\n        }\n      },\n    };\n\n    watch(\n      () => props.block,\n      () => {\n        methods.reset();\n      },\n      {\n        immediate: true,\n      }\n    );\n\n    // const renderComponent = (props: Record<string, VisualEditorProps>) => {};\n\n    return () => {\n      if (!props.block) {\n        content = (\n          <>\n            <ElFormItem label=\"容器宽度\">\n              <ElInputNumber\n                v-model={state.editData.width}\n                {...{ step: 100 }}\n              />\n            </ElFormItem>\n            <ElFormItem label=\"容器高度\">\n              <ElInputNumber\n                v-model={state.editData.height}\n                {...{ step: 100 }}\n              />\n            </ElFormItem>\n          </>\n        );\n      } else {\n        const { componentKey } = props.block;\n        const component = props.config?.componentMap[componentKey];\n\n        if (!!component && component.props) {\n          content = (\n            <>\n              {Object.entries(component.props).map(([propName, propConfig]) => {\n                let item: JSX.Element;\n\n                switch (propConfig.type) {\n                  case VisualEditorPropsType.input:\n                    item = <ElInput v-model={state.editData[propName]} />;\n                    break;\n                  case VisualEditorPropsType.color:\n                    item = <ElColorPicker v-model={state.editData[propName]} />;\n                    break;\n                  case VisualEditorPropsType.select:\n                    item = (\n                      <ElSelect\n                        placeholder=\"请选择\"\n                        v-model={state.editData[propName]}\n                      >\n                        {propConfig.options?.map((opt, i) => (\n                          <ElOption key={i} label={opt.label} value={opt.val}>\n                            {opt.label}\n                          </ElOption>\n                        ))}\n                      </ElSelect>\n                    );\n                    break;\n                  case VisualEditorPropsType.table:\n                    item = (\n                      <TablePropEditor\n                        v-model={state.editData[propName]}\n                        propConfig={propConfig}\n                      />\n                    );\n                    break;\n\n                  default:\n                    item = <></>;\n                    break;\n                }\n\n                return (\n                  <ElFormItem\n                    {...{ labelPosition: \"top\" }}\n                    label={propConfig.label}\n                    key={propName}\n                  >\n                    {item}\n                  </ElFormItem>\n                );\n              })}\n            </>\n          );\n        }\n      }\n      return (\n        <div class=\"operator\">\n          <ElForm>\n            {content}\n            <ElFormItem>\n              <ElButton {...({ onClick: methods.apply } as any)}>应用</ElButton>\n              <ElButton {...({ onClick: methods.reset } as any)}>重置</ElButton>\n            </ElFormItem>\n          </ElForm>\n        </div>\n      );\n    };\n  },\n});\n","import { computed, defineComponent, PropType, reactive, ref } from \"vue\";\nimport { createEvent } from \"./plugins/event\";\nimport { $$dialog } from \"./utils/dialog-service\";\nimport { useModel } from \"./utils/useModel\";\nimport { useVisualCommand } from \"./utils/visual.command\";\nimport { VisualEditorBlock } from \"./visual-editor-block\";\nimport { ElMessageBox } from \"element-plus\";\nimport \"./visual-editor.scss\";\nimport {\n  createNewBlock,\n  VisualEditorBlockData,\n  VisualEditorComponent,\n  VisualEditorConfig,\n  VisualEditorModelValue,\n  VisualEditorMarkLine,\n} from \"./visual-editor.utils\";\nimport {\n  $$dropdown,\n  DropdownOption as DPOption,\n} from \"./utils/dropdown-service\";\nimport { VisualOperatorEditor } from \"./visual-editor-operator\";\n\nconst DropdownOption = DPOption as any;\n\nexport const VisualEditor = defineComponent({\n  props: {\n    modelValue: {\n      type: Object as PropType<VisualEditorModelValue>,\n      require: true,\n    },\n    config: {\n      type: Object as PropType<VisualEditorConfig>,\n      require: true,\n    },\n    formData: { type: Object as PropType<Record<string, any>>, required: true },\n  },\n  emits: {\n    \"update:modelValue\": (val?: VisualEditorModelValue) => true,\n  },\n  setup(props, ctx) {\n    // 双向数据绑定\n    const dataModel = useModel(\n      () => props.modelValue,\n      (val) => ctx.emit(\"update:modelValue\", val)\n    );\n    // container样式\n    const containerStyles = computed(() => ({\n      width: `${props.modelValue?.container.width}px`,\n      height: `${props.modelValue?.container.height}px`,\n    }));\n    // container dom引用\n    const containerRef = ref({} as HTMLElement);\n\n    // 计算选中与未选中的block数据\n    const focusData = computed(() => {\n      const focus: VisualEditorBlockData[] =\n        dataModel.value?.blocks.filter((v) => v.focus) || [];\n      const unfocus: VisualEditorBlockData[] =\n        dataModel.value?.blocks.filter((v) => !v.focus) || [];\n      return {\n        focus, // 此时选中的数据\n        unfocus, // 此时未选中的数据\n      };\n    });\n\n    const selectIndex = ref(-1);\n    const state = reactive({\n      // selectBlock: undefined as undefined | VisualEditorBlockData, // 当前选中的block\n      selectBlock: computed(\n        () => (dataModel.value?.blocks || [])[selectIndex.value]\n      ),\n      preview: false,\n      editing: true,\n    });\n\n    let commander: ReturnType<typeof useVisualCommand>;\n\n    const classes = computed(() => [\n      \"visual-editor\",\n      {\n        editing: !state.preview,\n      },\n    ]);\n\n    const dragstart = createEvent();\n    const dragend = createEvent();\n\n    // 对外暴露的一些方法\n    const methods = {\n      clearFocus: (block?: VisualEditorBlockData) => {\n        let blocks = dataModel.value?.blocks || [];\n        if (blocks.length === 0) return;\n\n        if (block) {\n          blocks = blocks.filter((v) => v !== block);\n        }\n        blocks.forEach((block) => (block.focus = false));\n      },\n      updateBlocks: (blocks: VisualEditorBlockData[]) => {\n        dataModel.value!.blocks = blocks;\n      },\n\n      importBlockData: async (block: VisualEditorBlockData) => {\n        const text = await $$dialog.textarea(\"\", {\n          title: \"请输入节点Json字符串\",\n        });\n        try {\n          const data = JSON.parse(text || \"\");\n          if (typeof data !== \"object\") {\n            throw new Error();\n          }\n          commander.updateBlock(data, block);\n        } catch (error) {\n          ElMessageBox.alert(\"解析json字符串出错\");\n        }\n      },\n      showBlockData: (block: VisualEditorBlockData) => {\n        $$dialog.textarea(JSON.stringify(block), { title: \"节点数据\" });\n      },\n      openEdit: () => {\n        state.editing = true;\n      },\n    };\n\n    // 处理菜单拖拽进容器\n    const menuDragger = (() => {\n      let component = null as null | VisualEditorComponent;\n\n      const containerHandler = {\n        /**\n         * 拖拽组件进入容器，设置鼠标可放置状态\n         */\n        dragenter: (e: DragEvent) => {\n          e.dataTransfer!.dropEffect = \"move\";\n        },\n        dragover: (e: DragEvent) => {\n          e.preventDefault();\n        },\n        /**\n         * 拖拽组件离开容器，设置鼠标禁用状态\n         */\n        dragleave: (e: DragEvent) => {\n          e.dataTransfer!.dropEffect = \"none\";\n        },\n        /**\n         * 在容器中放置组件\n         */\n        drop: (e: DragEvent) => {\n          console.log(\"drop\", component);\n          const blocks = dataModel.value?.blocks || [];\n          blocks.push(\n            createNewBlock({\n              component: component!,\n              top: e.offsetY,\n              left: e.offsetX,\n            })\n          );\n          console.log(\"x\", e.offsetX);\n          console.log(\"y\", e.offsetY);\n          dataModel.value = {\n            ...dataModel.value,\n            blocks,\n          } as VisualEditorModelValue;\n          dragend.emit();\n        },\n      };\n\n      const blockHandler = {\n        dragstart: (e: DragEvent, current: VisualEditorComponent) => {\n          containerRef.value.addEventListener(\n            \"dragenter\",\n            containerHandler.dragenter\n          );\n          containerRef.value.addEventListener(\n            \"dragover\",\n            containerHandler.dragover\n          );\n          containerRef.value.addEventListener(\n            \"dragleave\",\n            containerHandler.dragleave\n          );\n          containerRef.value.addEventListener(\"drop\", containerHandler.drop);\n          component = current;\n          dragstart.emit();\n        },\n        dragend: (e: DragEvent) => {\n          containerRef.value.removeEventListener(\n            \"dragenter\",\n            containerHandler.dragenter\n          );\n          containerRef.value.removeEventListener(\n            \"dragover\",\n            containerHandler.dragover\n          );\n          containerRef.value.removeEventListener(\n            \"dragleave\",\n            containerHandler.dragleave\n          );\n          containerRef.value.removeEventListener(\"drop\", containerHandler.drop);\n          component = null;\n        },\n      };\n\n      return blockHandler;\n    })();\n\n    // 处理组件在画布上他拖拽\n    const blockDragger = (() => {\n      const mark = reactive({\n        x: null as null | number,\n        y: null as null | number,\n      });\n      let dragState = {\n        startX: 0,\n        startY: 0,\n        startLeft: 0,\n        startTop: 0,\n        startPos: [] as { left: number; top: number }[],\n        dragging: false,\n        markLines: {} as VisualEditorMarkLine,\n      };\n\n      const mousemove = (e: MouseEvent) => {\n        if (!dragState.dragging) {\n          dragState.dragging = true;\n          dragstart.emit();\n        }\n\n        let { clientX: moveX, clientY: moveY } = e;\n\n        const { startX, startY } = dragState;\n\n        // 水平、垂直移动\n        if (e.shiftKey) {\n          if (Math.abs(e.clientX - startX) > Math.abs(e.clientY - startY)) {\n            moveY = startY;\n          } else {\n            moveX = startX;\n          }\n        }\n\n        const currentLeft = dragState.startLeft + moveX - startX;\n        const currentTop = dragState.startTop + moveY - startY;\n        const currentMark = {\n          x: null as null | number,\n          y: null as null | number,\n        };\n\n        for (let i = 0; i < dragState.markLines.y.length; i++) {\n          const { top, showTop } = dragState.markLines.y[i];\n          if (Math.abs(top - currentTop) < 5) {\n            moveY = top + startY - dragState.startTop;\n            currentMark.y = showTop;\n            break;\n          }\n        }\n\n        for (let i = 0; i < dragState.markLines.x.length; i++) {\n          const { left, showLeft } = dragState.markLines.x[i];\n          if (Math.abs(left - currentLeft) < 5) {\n            moveX = left + startX - dragState.startLeft;\n            currentMark.x = showLeft;\n            break;\n          }\n        }\n\n        const durY = moveY - startY;\n        const durX = moveX - startX;\n        focusData.value.focus.forEach((block, i) => {\n          block.top = dragState.startPos[i].top + durY;\n          block.left = dragState.startPos[i].left + durX;\n        });\n\n        mark.x = currentMark.x;\n        mark.y = currentMark.y;\n      };\n      const mouseup = (e: MouseEvent) => {\n        document.removeEventListener(\"mousemove\", mousemove);\n        document.removeEventListener(\"mouseup\", mouseup);\n        mark.x = null;\n        mark.y = null;\n        if (dragState.dragging) {\n          dragend.emit();\n        }\n      };\n\n      const mousedown = (e: MouseEvent) => {\n        dragState = {\n          startX: e.clientX,\n          startY: e.clientY,\n          startTop: state.selectBlock!.top,\n          startLeft: state.selectBlock!.left,\n          startPos: focusData.value.focus.map(({ top, left }) => ({\n            top,\n            left,\n          })),\n          dragging: false,\n          markLines: (() => {\n            const { focus, unfocus } = focusData.value;\n            // 当前选中的block\n            const { top, left, width, height } = state.selectBlock!;\n            const lines = { x: [], y: [] } as VisualEditorMarkLine;\n            [\n              ...unfocus,\n              {\n                top: 0,\n                left: 0,\n                width: dataModel.value!.container.width,\n                height: dataModel.value!.container.height,\n              },\n            ].forEach((block) => {\n              const { top: t, left: l, width: w, height: h } = block;\n              // y轴对齐方式\n              lines.y.push({ top: t, showTop: t }); // 顶对顶\n              lines.y.push({ top: t + h, showTop: t + h }); // 底对底\n              lines.y.push({ top: t + h / 2 - height / 2, showTop: t + h / 2 }); // 中对中\n              lines.y.push({ top: t - height, showTop: t }); // 顶对底\n              lines.y.push({ top: t + h - height, showTop: t + h }); //\n\n              // x轴对齐方式\n\n              lines.x.push({ left: l, showLeft: l }); // 顶对顶\n              lines.x.push({ left: l + w, showLeft: l + w }); // 底对底\n              lines.x.push({\n                left: l + w / 2 - width / 2,\n                showLeft: l + w / 2,\n              }); // 中对中\n              lines.x.push({ left: l - width, showLeft: l }); // 顶对底\n              lines.x.push({ left: l + w - width, showLeft: l + w }); // 中对中\n            });\n\n            return lines;\n          })(),\n        };\n        document.addEventListener(\"mousemove\", mousemove);\n        document.addEventListener(\"mouseup\", mouseup);\n      };\n\n      return { mousedown, mark };\n    })();\n\n    // 其他事件\n    const handler = {\n      onContextmenuBlock: (e: MouseEvent, block: VisualEditorBlockData) => {\n        if (state.preview) return;\n        e.preventDefault();\n        e.stopPropagation();\n\n        $$dropdown({\n          reference: e,\n          content: () => (\n            <>\n              <DropdownOption\n                label=\"置顶节点\"\n                icon=\"icon-place-top\"\n                onClick={commander.placeTop}\n              />\n              <DropdownOption\n                label=\"置底节点\"\n                icon=\"icon-place-bottom\"\n                onClick={commander.placeBottom}\n              />\n              <DropdownOption\n                label=\"删除节点\"\n                icon=\"icon-delete\"\n                onClick={commander.delete}\n              />\n              <DropdownOption\n                label=\"查看数据\"\n                icon=\"icon-browse\"\n                onClick={() => methods.showBlockData(block)}\n              />\n              <DropdownOption\n                label=\"导入节点\"\n                icon=\"icon-import\"\n                onClick={() => methods.importBlockData(block)}\n              />\n            </>\n          ),\n        });\n      },\n    };\n\n    // 处理组件的选中状态\n    const focusHandler = (() => {\n      return {\n        container: {\n          onMousedown: (e: MouseEvent) => {\n            e.preventDefault();\n            if (e.currentTarget !== e.target) {\n              return;\n            }\n\n            methods.clearFocus();\n            // state.selectBlock = undefined;\n            selectIndex.value = -1;\n          },\n        },\n        block: {\n          onMousedown: (\n            e: MouseEvent,\n            block: VisualEditorBlockData,\n            index: number\n          ) => {\n            if (state.preview) return;\n\n            e && e.preventDefault();\n            // 只有元素未选中状态下， 才去处理\n            if (!block.focus) {\n              if (!e.shiftKey) {\n                block.focus = !block.focus;\n                methods.clearFocus(block);\n              } else {\n                block.focus = true;\n              }\n            }\n            // state.selectBlock = block;\n            selectIndex.value = index;\n            // 处理组件的选中移动\n            blockDragger.mousedown(e);\n          },\n        },\n      };\n    })();\n    commander = useVisualCommand({\n      focusData: focusData,\n      updateBlocks: methods.updateBlocks,\n      dataModel,\n      dragstart,\n      dragend,\n    });\n\n    const handleImport = async () => {\n      console.log(\"handleImport\");\n      const text = await $$dialog.textarea(\"\", {\n        title: \"请输入要导入的Json字符串\",\n      });\n      console.log(\"text\", text);\n      try {\n        const data = JSON.parse(text || \"\");\n        if (typeof data !== \"object\") {\n          throw new Error();\n        }\n        dataModel.value = data;\n      } catch (error) {\n        ElMessageBox.alert(\"解析json字符串出错\");\n      }\n    };\n\n    const handleExport = async () => {\n      console.log(\"handleImport\");\n      const text = await $$dialog.textarea(JSON.stringify(dataModel.value), {\n        title: \"导出内容\",\n      });\n      console.log(\"text\", text);\n    };\n\n    const buttons = [\n      {\n        label: \"撤销\",\n        icon: \"icon-back\",\n        handler: commander.undo,\n        tip: \"ctrl+z\",\n      },\n      {\n        label: \"重做\",\n        icon: \"icon-forward\",\n        handler: commander.redo,\n        tip: \"ctrl+y, ctrl+shift+z\",\n      },\n      {\n        label: () => (state.preview ? \"编辑\" : \"预览\"),\n        icon: () => (state.preview ? \"icon-edit\" : \"icon-browse\"),\n        handler: () => {\n          state.preview = !state.preview;\n          if (state.preview) {\n            methods.clearFocus();\n          }\n        },\n      },\n      {\n        label: \"导入\",\n        icon: \"icon-import\",\n        handler: handleImport,\n      },\n\n      {\n        label: \"导出\",\n        icon: \"icon-export\",\n        handler: handleExport,\n      },\n      {\n        label: \"置顶\",\n        icon: \"icon-place-top\",\n        handler: () => commander.placeTop(),\n      },\n      {\n        label: \"置低\",\n        icon: \"icon-place-bottom\",\n        handler: () => commander.placeBottom(),\n      },\n\n      {\n        label: \"删除\",\n        icon: \"icon-delete\",\n        handler: () => commander.delete(),\n        tip: \"ctrl+d, backspance, delete,\",\n      },\n      {\n        label: \"清空\",\n        icon: \"icon-reset\",\n        handler: () => commander.clear(),\n      },\n      {\n        label: \"关闭\",\n        icon: \"icon-close\",\n        handler: () => {\n          methods.clearFocus();\n          state.editing = false;\n        },\n      },\n    ];\n\n    const excuteFun = (fn: any) => {\n      return typeof fn === \"function\" ? fn() : fn;\n    };\n\n    return () => {\n      console.log(\"selectBlock\", state.selectBlock);\n      return (\n        <>\n          <div\n            class=\"visual-editor-container\"\n            ref={containerRef}\n            style={containerStyles.value}\n            {...focusHandler.container}\n            v-show={!state.editing}\n          >\n            {(dataModel.value?.blocks || []).map((block, index: number) => (\n              <VisualEditorBlock\n                block={block}\n                key={index}\n                config={props.config}\n                formData={props.formData}\n                slots={ctx.slots}\n                {...{\n                  onMousedown: (e: MouseEvent) =>\n                    focusHandler.block.onMousedown(e, block, index),\n                  onContextmenu: (e: MouseEvent) =>\n                    handler.onContextmenuBlock(e, block),\n                }}\n              />\n            ))}\n            <div class=\"container-edit-button\" onClick={methods.openEdit}>\n              <i class=\"iconfont icon-edit\"></i>\n              <span>编辑组件</span>\n            </div>\n          </div>\n\n          <div class={classes.value} v-show={state.editing}>\n            <div class=\"menu\">\n              {props.config?.componentList.map((component) => (\n                <div\n                  class=\"menu-item\"\n                  draggable\n                  onDragend={menuDragger.dragend}\n                  onDragstart={(e) => menuDragger.dragstart(e, component)}\n                >\n                  <span class=\"menu-item-label\">{component.label}</span>\n                  {component.preview()}\n                </div>\n              ))}\n            </div>\n            <div class=\"head\">\n              {buttons.map((btn, index) => {\n                const content = (\n                  <div key={index} class=\"head-btn\" onClick={btn.handler}>\n                    <i class={`iconfont ${excuteFun(btn.icon)}`}></i>\n                    <span>{excuteFun(btn.label)}</span>\n                  </div>\n                );\n                if (!btn.tip) return content;\n                return (\n                  <el-tooltip\n                    effect=\"dark\"\n                    content={btn.tip}\n                    placement=\"bottom\"\n                  >\n                    {content}\n                  </el-tooltip>\n                );\n              })}\n            </div>\n\n            <div class=\"body\">\n              <div class=\"content\">\n                <div\n                  class=\"visual-editor-container\"\n                  ref={containerRef}\n                  style={containerStyles.value}\n                  {...focusHandler.container}\n                >\n                  {(dataModel.value?.blocks || []).map(\n                    (block, index: number) => (\n                      <VisualEditorBlock\n                        block={block}\n                        key={index}\n                        config={props.config}\n                        formData={props.formData}\n                        slots={ctx.slots}\n                        {...{\n                          onMousedown: (e: MouseEvent) =>\n                            focusHandler.block.onMousedown(e, block, index),\n                          onContextmenu: (e: MouseEvent) =>\n                            handler.onContextmenuBlock(e, block),\n                        }}\n                      />\n                    )\n                  )}\n                  {blockDragger.mark.x && (\n                    <div\n                      class=\"mark-line-x\"\n                      style={{ left: `${blockDragger.mark.x}px` }}\n                    ></div>\n                  )}\n                  {blockDragger.mark.y && (\n                    <div\n                      class=\"mark-line-y\"\n                      style={{ top: `${blockDragger.mark.y}px` }}\n                    ></div>\n                  )}\n                </div>\n              </div>\n            </div>\n\n            <VisualOperatorEditor\n              block={state.selectBlock!}\n              config={props.config}\n              dataModel={dataModel as any}\n              updateBlock={commander.updateBlock}\n              updateModelValue={commander.updateModelValue}\n            />\n          </div>\n        </>\n      );\n    };\n  },\n});\n","import { useModel } from \"@/packages/utils/useModel\";\nimport { defineComponent } from \"vue\";\nimport \"./style.scss\";\nexport const NumberRange = defineComponent({\n  props: {\n    start: { type: String },\n    end: { type: String },\n  },\n  emits: {\n    \"update:start\": (val?: string) => true,\n    \"update:end\": (val?: string) => true,\n  },\n  setup(props, ctx) {\n    const startModel = useModel(\n      () => props.start,\n      (val) => ctx.emit(\"update:start\", val)\n    );\n    const endModel = useModel(\n      () => props.start,\n      (val) => ctx.emit(\"update:end\", val)\n    );\n\n    return () => (\n      <div class=\"number-range\">\n        <input type=\"text\" v-model={startModel.value} />\n        <span>~</span>\n        <input type=\"text\" v-model={endModel.value} />\n      </div>\n    );\n  },\n});\n","import { createVisualEditorConfig } from \"./visual-editor.utils\";\nimport { ElButton, ElInput as Input, ElOption, ElSelect } from \"element-plus\";\nimport {\n  createEditorColorProps,\n  createEditorInputProps,\n  createEditorSelectProps,\n  createEditorTableProp,\n} from \"./visual-editor.props\";\nimport { NumberRange } from \"./components/number-range\";\nimport \"../visual.config.scss\";\n\nconst [ElInput]: any[] = [Input];\n\nconst visualConfig = createVisualEditorConfig();\n\nvisualConfig.registry(\"text\", {\n  label: \"文本\",\n  preview: () => \"预览文本\",\n  render: ({ props }) => (\n    <span style={{ color: props.color, fontSize: props.size }}>\n      {props.text || \"默认文本\"}\n    </span>\n  ),\n  props: {\n    text: createEditorInputProps(\"显示文本\"),\n    color: createEditorColorProps(\"字体颜色\"),\n    size: createEditorSelectProps(\"字体大小\", [\n      { label: \"14px\", val: \"14px\" },\n      { label: \"18px\", val: \"18px\" },\n      { label: \"24px\", val: \"24px\" },\n    ]),\n  },\n});\n\nvisualConfig.registry(\"button\", {\n  label: \"按钮\",\n  preview: () => <ElButton>按钮</ElButton>,\n  render: ({ props, size }) => (\n    <ElButton\n      type={props.type}\n      size={props.size}\n      style={{ width: `${size.width}px`, height: `${size.height}px` }}\n    >\n      {props.text || \"按钮\"}\n    </ElButton>\n  ),\n  resize: { width: true, height: true },\n  props: {\n    text: createEditorInputProps(\"显示文本\"),\n    type: createEditorSelectProps(\"按钮类型\", [\n      { label: \"基础\", val: \"primary\" },\n      { label: \"成功\", val: \"success\" },\n      { label: \"警告\", val: \"warning\" },\n      { label: \"危险\", val: \"danger\" },\n      { label: \"提示\", val: \"info\" },\n      { label: \"文本\", val: \"text\" },\n    ]),\n    size: createEditorSelectProps(\"按钮大小\", [\n      { label: \"默认\", val: \"\" },\n      { label: \"中等\", val: \"medium\" },\n      { label: \"小\", val: \"small\" },\n      { label: \"极小\", val: \"mini\" },\n    ]),\n  },\n});\n\nvisualConfig.registry(\"input\", {\n  label: \"输入框\",\n  preview: () => <ElInput />,\n  render: ({ model, size }) => {\n    return <ElInput {...model.default} style={{ width: `${size.width}px` }} />;\n  },\n  resize: { width: true },\n  model: {\n    default: \"绑定字段\",\n  },\n  props: {\n    size: createEditorSelectProps(\"输入框大小\", [\n      { label: \"默认\", val: \"\" },\n      { label: \"中等\", val: \"medium\" },\n      { label: \"小\", val: \"small\" },\n      { label: \"极小\", val: \"mini\" },\n    ]),\n  },\n});\n\nvisualConfig.registry(\"select\", {\n  label: \"下拉框\",\n  preview: () => <ElSelect></ElSelect>,\n  render: ({ props }) => (\n    <ElSelect key={Math.random()}>\n      {(props.options || []).map(\n        (\n          opt: {\n            label: string;\n            value: string;\n          },\n          index: number\n        ) => (\n          <ElOption label={opt.label} value={opt.value} key={index}></ElOption>\n        )\n      )}\n    </ElSelect>\n  ),\n  props: {\n    options: createEditorTableProp(\"下拉选项\", {\n      options: [\n        { label: \"显示值\", field: \"label\" },\n        { label: \"绑定值\", field: \"value\" },\n      ],\n      showKey: \"label\",\n    }),\n  },\n});\n\nvisualConfig.registry(\"number-range\", {\n  label: \"数字范围输入框\",\n  resize: { width: true },\n  preview: () => <NumberRange style={{ width: \"100%\" }} />,\n  render: ({ model, size }) => (\n    <NumberRange\n      style={{ width: `${size.width}px` }}\n      {...{\n        start: model.start.value,\n        \"onUpdate:start\": model.start.onChange,\n        end: model.end.value,\n        \"onUpdate:end\": model.end.onChange,\n      }}\n    />\n  ),\n\n  model: {\n    start: \"起始绑定字段\",\n    end: \"结束绑定字段\",\n  },\n});\n\nexport default visualConfig;\n","\nimport { defineComponent } from \"vue\";\nimport { VisualEditor } from \"../src/packages/visual-editor\";\n// import { TestUseModel } from \"../src/packages/utils/useModel\";\nimport visualConfig from \"./packages/visual.config\";\nimport jsonData from \"./jsonData.json\";\n\nexport default defineComponent({\n  name: \"App\",\n  components: { VisualEditor },\n  data() {\n    return {\n      visualConfig,\n      jsonData: jsonData,\n      formData: {\n        username: \"admin\",\n      },\n    };\n  },\n});\n","import { render } from \"./App.vue?vue&type=template&id=4d25d09b\"\nimport script from \"./App.vue?vue&type=script&lang=ts\"\nexport * from \"./App.vue?vue&type=script&lang=ts\"\n\nimport \"./App.vue?vue&type=style&index=0&id=4d25d09b&lang=scss\"\nscript.render = render\n\nexport default script","import { createApp } from \"vue\";\nimport App from \"./App.vue\";\nimport ElementPlus from \"element-plus\";\nimport \"element-plus/lib/theme-chalk/index.css\";\n\nconst app = createApp(App);\napp.use(ElementPlus);\napp.mount(\"#app\");\n"],"sourceRoot":""}